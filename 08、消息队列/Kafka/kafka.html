
<!DOCTYPE html>
<html>
  <head>
    <title>no title</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
    .markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}/**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}.emoji {
  height: 0.8em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}
    /* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

    </style>
    
  </head>
  <body for="html-export">
    <div class="mume markdown-preview">
    <html><head></head><body><div><h1 class="mume-header" id="kafka%E7%9A%84%E7%AE%80%E4%BB%8B" ebook-toc-level-1 heading="kafka&amp;#x7684;&amp;#x7B80;&amp;#x4ECB;">kafka&#x7684;&#x7B80;&#x4ECB;</h1>

<h2 class="mume-header" id="%E4%B8%80-%E7%AE%80%E4%BB%8B" ebook-toc-level-2 heading="&amp;#x4E00;&amp;#x3001;&amp;#x7B80;&amp;#x4ECB;">&#x4E00;&#x3001;&#x7B80;&#x4ECB;</h2>

<h3 class="mume-header" id="11-%E6%A6%82%E8%BF%B0" ebook-toc-level-3 heading="1.1&amp;#x3000;&amp;#x6982;&amp;#x8FF0;">1.1&#x3000;&#x6982;&#x8FF0;</h3>

<p>Kafka&#x662F;&#x6700;&#x521D;&#x7531;Linkedin&#x516C;&#x53F8;&#x5F00;&#x53D1;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x5206;&#x5E03;&#x5F0F;&#x3001;&#x5206;&#x533A;&#x7684;&#x3001;&#x591A;&#x526F;&#x672C;&#x7684;&#x3001;&#x591A;&#x8BA2;&#x9605;&#x8005;&#xFF0C;&#x57FA;&#x4E8E;zookeeper&#x534F;&#x8C03;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x65E5;&#x5FD7;&#x7CFB;&#x7EDF;&#xFF08;&#x4E5F;&#x53EF;&#x4EE5;&#x5F53;&#x505A;MQ&#x7CFB;&#x7EDF;&#xFF09;&#xFF0C;&#x5E38;&#x89C1;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;web/nginx&#x65E5;&#x5FD7;&#x3001;&#x8BBF;&#x95EE;&#x65E5;&#x5FD7;&#xFF0C;&#x6D88;&#x606F;&#x670D;&#x52A1;&#x7B49;&#x7B49;&#xFF0C;Linkedin&#x4E8E;2010&#x5E74;&#x8D21;&#x732E;&#x7ED9;&#x4E86;Apache&#x57FA;&#x91D1;&#x4F1A;&#x5E76;&#x6210;&#x4E3A;&#x9876;&#x7EA7;&#x5F00;&#x6E90;&#x9879;&#x76EE;&#x3002;</p>
<p>&#x4E3B;&#x8981;&#x5E94;&#x7528;&#x573A;&#x666F;&#x662F;&#xFF1A;&#x65E5;&#x5FD7;&#x6536;&#x96C6;&#x7CFB;&#x7EDF;&#x548C;&#x6D88;&#x606F;&#x7CFB;&#x7EDF;&#x3002;</p>
<p>Kafka&#x4E3B;&#x8981;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x4EE5;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;O(1)&#x7684;&#x65B9;&#x5F0F;&#x63D0;&#x4F9B;&#x6D88;&#x606F;&#x6301;&#x4E45;&#x5316;&#x80FD;&#x529B;&#xFF0C;&#x5373;&#x4F7F;&#x5BF9;TB&#x7EA7;&#x4EE5;&#x4E0A;&#x6570;&#x636E;&#x4E5F;&#x80FD;&#x4FDD;&#x8BC1;&#x5E38;&#x6570;&#x65F6;&#x95F4;&#x7684;&#x8BBF;&#x95EE;&#x6027;&#x80FD;&#x3002;</li>
<li>&#x9AD8;&#x541E;&#x5410;&#x7387;&#x3002;&#x5373;&#x4F7F;&#x5728;&#x975E;&#x5E38;&#x5EC9;&#x4EF7;&#x7684;&#x5546;&#x7528;&#x673A;&#x5668;&#x4E0A;&#x4E5F;&#x80FD;&#x505A;&#x5230;&#x5355;&#x673A;&#x652F;&#x6301;&#x6BCF;&#x79D2;100K&#x6761;&#x6D88;&#x606F;&#x7684;&#x4F20;&#x8F93;&#x3002;</li>
<li>&#x652F;&#x6301;Kafka Server&#x95F4;&#x7684;&#x6D88;&#x606F;&#x5206;&#x533A;&#xFF0C;&#x53CA;&#x5206;&#x5E03;&#x5F0F;&#x6D88;&#x8D39;&#xFF0C;&#x540C;&#x65F6;&#x4FDD;&#x8BC1;&#x6BCF;&#x4E2A;partition&#x5185;&#x7684;&#x6D88;&#x606F;&#x987A;&#x5E8F;&#x4F20;&#x8F93;&#x3002;</li>
<li>&#x540C;&#x65F6;&#x652F;&#x6301;&#x79BB;&#x7EBF;&#x6570;&#x636E;&#x5904;&#x7406;&#x548C;&#x5B9E;&#x65F6;&#x6570;&#x636E;&#x5904;&#x7406;&#x3002;</li>
<li>Scale out:&#x652F;&#x6301;&#x5728;&#x7EBF;&#x6C34;&#x5E73;&#x6269;&#x5C55;</li>
</ul>
<h3 class="mume-header" id="12-%E6%B6%88%E6%81%AF%E7%B3%BB%E7%BB%9F%E4%BB%8B%E7%BB%8D" ebook-toc-level-3 heading="1.2&amp;#x3000;&amp;#x6D88;&amp;#x606F;&amp;#x7CFB;&amp;#x7EDF;&amp;#x4ECB;&amp;#x7ECD;">1.2&#x3000;&#x6D88;&#x606F;&#x7CFB;&#x7EDF;&#x4ECB;&#x7ECD;</h3>

<p>&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#x7CFB;&#x7EDF;&#x8D1F;&#x8D23;&#x5C06;&#x6570;&#x636E;&#x4ECE;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x4F20;&#x9012;&#x5230;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#xFF0C;&#x5E94;&#x7528;&#x53EA;&#x9700;&#x5173;&#x6CE8;&#x4E8E;&#x6570;&#x636E;&#xFF0C;&#x65E0;&#x9700;&#x5173;&#x6CE8;&#x6570;&#x636E;&#x5728;&#x4E24;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x5E94;&#x7528;&#x95F4;&#x662F;&#x5982;&#x4F55;&#x4F20;&#x9012;&#x7684;&#x3002;&#x5206;&#x5E03;&#x5F0F;&#x6D88;&#x606F;&#x4F20;&#x9012;&#x57FA;&#x4E8E;&#x53EF;&#x9760;&#x7684;&#x6D88;&#x606F;&#x961F;&#x5217;&#xFF0C;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x5E94;&#x7528;&#x548C;&#x6D88;&#x606F;&#x7CFB;&#x7EDF;&#x4E4B;&#x95F4;&#x5F02;&#x6B65;&#x4F20;&#x9012;&#x6D88;&#x606F;&#x3002;&#x6709;&#x4E24;&#x79CD;&#x4E3B;&#x8981;&#x7684;&#x6D88;&#x606F;&#x4F20;&#x9012;&#x6A21;&#x5F0F;&#xFF1A;<strong>&#x70B9;&#x5BF9;&#x70B9;&#x4F20;&#x9012;&#x6A21;&#x5F0F;&#x3001;&#x53D1;&#x5E03;-&#x8BA2;&#x9605;&#x6A21;&#x5F0F;</strong>&#x3002;&#x5927;&#x90E8;&#x5206;&#x7684;&#x6D88;&#x606F;&#x7CFB;&#x7EDF;&#x9009;&#x7528;&#x53D1;&#x5E03;-&#x8BA2;&#x9605;&#x6A21;&#x5F0F;&#x3002;<strong>Kafka&#x5C31;&#x662F;&#x4E00;&#x79CD;&#x53D1;&#x5E03;-&#x8BA2;&#x9605;&#x6A21;&#x5F0F;</strong>&#x3002;</p>
<h3 class="mume-header" id="13-%E7%82%B9%E5%AF%B9%E7%82%B9%E6%B6%88%E6%81%AF%E4%BC%A0%E9%80%92%E6%A8%A1%E5%BC%8F" ebook-toc-level-3 heading="1.3&amp;#x3000;&amp;#x70B9;&amp;#x5BF9;&amp;#x70B9;&amp;#x6D88;&amp;#x606F;&amp;#x4F20;&amp;#x9012;&amp;#x6A21;&amp;#x5F0F;">1.3&#x3000;&#x70B9;&#x5BF9;&#x70B9;&#x6D88;&#x606F;&#x4F20;&#x9012;&#x6A21;&#x5F0F;</h3>

<p>&#x5728;&#x70B9;&#x5BF9;&#x70B9;&#x6D88;&#x606F;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x6D88;&#x606F;&#x6301;&#x4E45;&#x5316;&#x5230;&#x4E00;&#x4E2A;&#x961F;&#x5217;&#x4E2D;&#x3002;&#x6B64;&#x65F6;&#xFF0C;&#x5C06;&#x6709;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x6D88;&#x8D39;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x3002;&#x4F46;&#x662F;&#x4E00;&#x6761;&#x6D88;&#x606F;&#x53EA;&#x80FD;&#x88AB;&#x6D88;&#x8D39;&#x4E00;&#x6B21;&#x3002;&#x5F53;&#x4E00;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x6D88;&#x8D39;&#x4E86;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x67D0;&#x6761;&#x6570;&#x636E;&#x4E4B;&#x540E;&#xFF0C;&#x8BE5;&#x6761;&#x6570;&#x636E;&#x5219;&#x4ECE;&#x6D88;&#x606F;&#x961F;&#x5217;&#x4E2D;&#x5220;&#x9664;&#x3002;&#x8BE5;&#x6A21;&#x5F0F;&#x5373;&#x4F7F;&#x6709;&#x591A;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x540C;&#x65F6;&#x6D88;&#x8D39;&#x6570;&#x636E;&#xFF0C;&#x4E5F;&#x80FD;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x5904;&#x7406;&#x7684;&#x987A;&#x5E8F;&#x3002;&#x8FD9;&#x79CD;&#x67B6;&#x6784;&#x63CF;&#x8FF0;&#x793A;&#x610F;&#x56FE;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164211.png" alt="img"></p>
<p><strong>&#x751F;&#x4EA7;&#x8005;&#x53D1;&#x9001;&#x4E00;&#x6761;&#x6D88;&#x606F;&#x5230;queue&#xFF0C;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x80FD;&#x6536;&#x5230;</strong>&#x3002;</p>
<h3 class="mume-header" id="14-%E5%8F%91%E5%B8%83-%E8%AE%A2%E9%98%85%E6%B6%88%E6%81%AF%E4%BC%A0%E9%80%92%E6%A8%A1%E5%BC%8F" ebook-toc-level-3 heading="1.4&amp;#x3000;&amp;#x53D1;&amp;#x5E03;-&amp;#x8BA2;&amp;#x9605;&amp;#x6D88;&amp;#x606F;&amp;#x4F20;&amp;#x9012;&amp;#x6A21;&amp;#x5F0F;">1.4&#x3000;&#x53D1;&#x5E03;-&#x8BA2;&#x9605;&#x6D88;&#x606F;&#x4F20;&#x9012;&#x6A21;&#x5F0F;</h3>

<p>&#x5728;&#x53D1;&#x5E03;-&#x8BA2;&#x9605;&#x6D88;&#x606F;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x6D88;&#x606F;&#x88AB;&#x6301;&#x4E45;&#x5316;&#x5230;&#x4E00;&#x4E2A;topic&#x4E2D;&#x3002;&#x4E0E;&#x70B9;&#x5BF9;&#x70B9;&#x6D88;&#x606F;&#x7CFB;&#x7EDF;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x6D88;&#x8D39;&#x8005;&#x53EF;&#x4EE5;&#x8BA2;&#x9605;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;topic&#xFF0C;&#x6D88;&#x8D39;&#x8005;&#x53EF;&#x4EE5;&#x6D88;&#x8D39;&#x8BE5;topic&#x4E2D;&#x6240;&#x6709;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x540C;&#x4E00;&#x6761;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x88AB;&#x591A;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x6D88;&#x8D39;&#xFF0C;&#x6570;&#x636E;&#x88AB;&#x6D88;&#x8D39;&#x540E;&#x4E0D;&#x4F1A;&#x7ACB;&#x9A6C;&#x5220;&#x9664;&#x3002;&#x5728;&#x53D1;&#x5E03;-&#x8BA2;&#x9605;&#x6D88;&#x606F;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x6D88;&#x606F;&#x7684;&#x751F;&#x4EA7;&#x8005;&#x79F0;&#x4E3A;&#x53D1;&#x5E03;&#x8005;&#xFF0C;&#x6D88;&#x8D39;&#x8005;&#x79F0;&#x4E3A;&#x8BA2;&#x9605;&#x8005;&#x3002;&#x8BE5;&#x6A21;&#x5F0F;&#x7684;&#x793A;&#x4F8B;&#x56FE;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164217.png" alt="img"></p>
<p><strong>&#x53D1;&#x5E03;&#x8005;&#x53D1;&#x9001;&#x5230;topic&#x7684;&#x6D88;&#x606F;&#xFF0C;&#x53EA;&#x6709;&#x8BA2;&#x9605;&#x4E86;topic&#x7684;&#x8BA2;&#x9605;&#x8005;&#x624D;&#x4F1A;&#x6536;&#x5230;&#x6D88;&#x606F;</strong>&#x3002;</p>
<h2 class="mume-header" id="%E4%BA%8C-kafka%E7%9A%84%E4%BC%98%E7%82%B9" ebook-toc-level-2 heading="&amp;#x4E8C;&amp;#x3001;Kafka&amp;#x7684;&amp;#x4F18;&amp;#x70B9;">&#x4E8C;&#x3001;Kafka&#x7684;&#x4F18;&#x70B9;</h2>

<h3 class="mume-header" id="21-%E8%A7%A3%E8%80%A6" ebook-toc-level-3 heading="2.1&amp;#x3000;&amp;#x89E3;&amp;#x8026;">2.1&#x3000;&#x89E3;&#x8026;</h3>

<p>&#x5728;&#x9879;&#x76EE;&#x542F;&#x52A8;&#x4E4B;&#x521D;&#x6765;&#x9884;&#x6D4B;&#x5C06;&#x6765;&#x9879;&#x76EE;&#x4F1A;&#x78B0;&#x5230;&#x4EC0;&#x4E48;&#x9700;&#x6C42;&#xFF0C;&#x662F;&#x6781;&#x5176;&#x56F0;&#x96BE;&#x7684;&#x3002;&#x6D88;&#x606F;&#x7CFB;&#x7EDF;&#x5728;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#x4E2D;&#x95F4;&#x63D2;&#x5165;&#x4E86;&#x4E00;&#x4E2A;&#x9690;&#x542B;&#x7684;&#x3001;&#x57FA;&#x4E8E;&#x6570;&#x636E;&#x7684;&#x63A5;&#x53E3;&#x5C42;&#xFF0C;&#x4E24;&#x8FB9;&#x7684;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#x90FD;&#x8981;&#x5B9E;&#x73B0;&#x8FD9;&#x4E00;&#x63A5;&#x53E3;&#x3002;&#x8FD9;&#x5141;&#x8BB8;&#x4F60;&#x72EC;&#x7ACB;&#x7684;&#x6269;&#x5C55;&#x6216;&#x4FEE;&#x6539;&#x4E24;&#x8FB9;&#x7684;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#xFF0C;&#x53EA;&#x8981;&#x786E;&#x4FDD;&#x5B83;&#x4EEC;&#x9075;&#x5B88;&#x540C;&#x6837;&#x7684;&#x63A5;&#x53E3;&#x7EA6;&#x675F;&#x3002;</p>
<h3 class="mume-header" id="22-%E5%86%97%E4%BD%99%E5%89%AF%E6%9C%AC" ebook-toc-level-3 heading="2.2&amp;#x3000;&amp;#x5197;&amp;#x4F59;&amp;#xFF08;&amp;#x526F;&amp;#x672C;&amp;#xFF09;">2.2&#x3000;&#x5197;&#x4F59;&#xFF08;&#x526F;&#x672C;&#xFF09;</h3>

<p>&#x6709;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5904;&#x7406;&#x6570;&#x636E;&#x7684;&#x8FC7;&#x7A0B;&#x4F1A;&#x5931;&#x8D25;&#x3002;&#x9664;&#x975E;&#x6570;&#x636E;&#x88AB;&#x6301;&#x4E45;&#x5316;&#xFF0C;&#x5426;&#x5219;&#x5C06;&#x9020;&#x6210;&#x4E22;&#x5931;&#x3002;&#x6D88;&#x606F;&#x961F;&#x5217;&#x628A;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x6301;&#x4E45;&#x5316;&#x76F4;&#x5230;&#x5B83;&#x4EEC;&#x5DF2;&#x7ECF;&#x88AB;&#x5B8C;&#x5168;&#x5904;&#x7406;&#xFF0C;&#x901A;&#x8FC7;&#x8FD9;&#x4E00;&#x65B9;&#x5F0F;&#x89C4;&#x907F;&#x4E86;&#x6570;&#x636E;&#x4E22;&#x5931;&#x98CE;&#x9669;&#x3002;&#x8BB8;&#x591A;&#x6D88;&#x606F;&#x961F;&#x5217;&#x6240;&#x91C7;&#x7528;&#x7684;&quot;&#x63D2;&#x5165;-&#x83B7;&#x53D6;-&#x5220;&#x9664;&quot;&#x8303;&#x5F0F;&#x4E2D;&#xFF0C;&#x5728;&#x628A;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#x4ECE;&#x961F;&#x5217;&#x4E2D;&#x5220;&#x9664;&#x4E4B;&#x524D;&#xFF0C;&#x9700;&#x8981;&#x4F60;&#x7684;&#x5904;&#x7406;&#x7CFB;&#x7EDF;&#x660E;&#x786E;&#x7684;&#x6307;&#x51FA;&#x8BE5;&#x6D88;&#x606F;&#x5DF2;&#x7ECF;&#x88AB;&#x5904;&#x7406;&#x5B8C;&#x6BD5;&#xFF0C;&#x4ECE;&#x800C;&#x786E;&#x4FDD;&#x4F60;&#x7684;&#x6570;&#x636E;&#x88AB;&#x5B89;&#x5168;&#x7684;&#x4FDD;&#x5B58;&#x76F4;&#x5230;&#x4F60;&#x4F7F;&#x7528;&#x5B8C;&#x6BD5;&#x3002;</p>
<h3 class="mume-header" id="23-%E6%89%A9%E5%B1%95%E6%80%A7" ebook-toc-level-3 heading="2.3&amp;#x3000;&amp;#x6269;&amp;#x5C55;&amp;#x6027;">2.3&#x3000;&#x6269;&#x5C55;&#x6027;</h3>

<p>&#x56E0;&#x4E3A;&#x6D88;&#x606F;&#x961F;&#x5217;&#x89E3;&#x8026;&#x4E86;&#x4F60;&#x7684;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#xFF0C;&#x6240;&#x4EE5;&#x589E;&#x5927;&#x6D88;&#x606F;&#x5165;&#x961F;&#x548C;&#x5904;&#x7406;&#x7684;&#x9891;&#x7387;&#x662F;&#x5F88;&#x5BB9;&#x6613;&#x7684;&#xFF0C;&#x53EA;&#x8981;&#x53E6;&#x5916;&#x589E;&#x52A0;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#x5373;&#x53EF;&#x3002;&#x4E0D;&#x9700;&#x8981;&#x6539;&#x53D8;&#x4EE3;&#x7801;&#x3001;&#x4E0D;&#x9700;&#x8981;&#x8C03;&#x8282;&#x53C2;&#x6570;&#x3002;&#x6269;&#x5C55;&#x5C31;&#x50CF;&#x8C03;&#x5927;&#x7535;&#x529B;&#x6309;&#x94AE;&#x4E00;&#x6837;&#x7B80;&#x5355;&#x3002;</p>
<h3 class="mume-header" id="24-%E7%81%B5%E6%B4%BB%E6%80%A7%E5%B3%B0%E5%80%BC%E5%A4%84%E7%90%86%E8%83%BD%E5%8A%9B" ebook-toc-level-3 heading="2.4&amp;#x3000;&amp;#x7075;&amp;#x6D3B;&amp;#x6027;&amp;amp;&amp;#x5CF0;&amp;#x503C;&amp;#x5904;&amp;#x7406;&amp;#x80FD;&amp;#x529B;">2.4&#x3000;&#x7075;&#x6D3B;&#x6027;&amp;&#x5CF0;&#x503C;&#x5904;&#x7406;&#x80FD;&#x529B;</h3>

<p>&#x5728;&#x8BBF;&#x95EE;&#x91CF;&#x5267;&#x589E;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5E94;&#x7528;&#x4ECD;&#x7136;&#x9700;&#x8981;&#x7EE7;&#x7EED;&#x53D1;&#x6325;&#x4F5C;&#x7528;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x6837;&#x7684;&#x7A81;&#x53D1;&#x6D41;&#x91CF;&#x5E76;&#x4E0D;&#x5E38;&#x89C1;&#xFF1B;&#x5982;&#x679C;&#x4E3A;&#x4EE5;&#x80FD;&#x5904;&#x7406;&#x8FD9;&#x7C7B;&#x5CF0;&#x503C;&#x8BBF;&#x95EE;&#x4E3A;&#x6807;&#x51C6;&#x6765;&#x6295;&#x5165;&#x8D44;&#x6E90;&#x968F;&#x65F6;&#x5F85;&#x547D;&#x65E0;&#x7591;&#x662F;&#x5DE8;&#x5927;&#x7684;&#x6D6A;&#x8D39;&#x3002;&#x4F7F;&#x7528;&#x6D88;&#x606F;&#x961F;&#x5217;&#x80FD;&#x591F;&#x4F7F;&#x5173;&#x952E;&#x7EC4;&#x4EF6;&#x9876;&#x4F4F;&#x7A81;&#x53D1;&#x7684;&#x8BBF;&#x95EE;&#x538B;&#x529B;&#xFF0C;&#x800C;&#x4E0D;&#x4F1A;&#x56E0;&#x4E3A;&#x7A81;&#x53D1;&#x7684;&#x8D85;&#x8D1F;&#x8377;&#x7684;&#x8BF7;&#x6C42;&#x800C;&#x5B8C;&#x5168;&#x5D29;&#x6E83;&#x3002;</p>
<h3 class="mume-header" id="25-%E5%8F%AF%E6%81%A2%E5%A4%8D%E6%80%A7" ebook-toc-level-3 heading="2.5&amp;#x3000;&amp;#x53EF;&amp;#x6062;&amp;#x590D;&amp;#x6027;">2.5&#x3000;&#x53EF;&#x6062;&#x590D;&#x6027;</h3>

<p>&#x7CFB;&#x7EDF;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x7EC4;&#x4EF6;&#x5931;&#x6548;&#x65F6;&#xFF0C;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x5230;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#x3002;&#x6D88;&#x606F;&#x961F;&#x5217;&#x964D;&#x4F4E;&#x4E86;&#x8FDB;&#x7A0B;&#x95F4;&#x7684;&#x8026;&#x5408;&#x5EA6;&#xFF0C;&#x6240;&#x4EE5;&#x5373;&#x4F7F;&#x4E00;&#x4E2A;&#x5904;&#x7406;&#x6D88;&#x606F;&#x7684;&#x8FDB;&#x7A0B;&#x6302;&#x6389;&#xFF0C;&#x52A0;&#x5165;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x6D88;&#x606F;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x5728;&#x7CFB;&#x7EDF;&#x6062;&#x590D;&#x540E;&#x88AB;&#x5904;&#x7406;&#x3002;</p>
<h3 class="mume-header" id="26-%E9%A1%BA%E5%BA%8F%E4%BF%9D%E8%AF%81" ebook-toc-level-3 heading="2.6&amp;#x3000;&amp;#x987A;&amp;#x5E8F;&amp;#x4FDD;&amp;#x8BC1;">2.6&#x3000;&#x987A;&#x5E8F;&#x4FDD;&#x8BC1;</h3>

<p>&#x5728;&#x5927;&#x591A;&#x4F7F;&#x7528;&#x573A;&#x666F;&#x4E0B;&#xFF0C;&#x6570;&#x636E;&#x5904;&#x7406;&#x7684;&#x987A;&#x5E8F;&#x90FD;&#x5F88;&#x91CD;&#x8981;&#x3002;&#x5927;&#x90E8;&#x5206;&#x6D88;&#x606F;&#x961F;&#x5217;&#x672C;&#x6765;&#x5C31;&#x662F;&#x6392;&#x5E8F;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x80FD;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x4F1A;&#x6309;&#x7167;&#x7279;&#x5B9A;&#x7684;&#x987A;&#x5E8F;&#x6765;&#x5904;&#x7406;&#x3002;Kafka&#x4FDD;&#x8BC1;&#x4E00;&#x4E2A;Partition&#x5185;&#x7684;&#x6D88;&#x606F;&#x7684;&#x6709;&#x5E8F;&#x6027;&#x3002;</p>
<h3 class="mume-header" id="27-%E7%BC%93%E5%86%B2" ebook-toc-level-3 heading="2.7&amp;#x3000;&amp;#x7F13;&amp;#x51B2;">2.7&#x3000;&#x7F13;&#x51B2;</h3>

<p>&#x5728;&#x4EFB;&#x4F55;&#x91CD;&#x8981;&#x7684;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x90FD;&#x4F1A;&#x6709;&#x9700;&#x8981;&#x4E0D;&#x540C;&#x7684;&#x5904;&#x7406;&#x65F6;&#x95F4;&#x7684;&#x5143;&#x7D20;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x52A0;&#x8F7D;&#x4E00;&#x5F20;&#x56FE;&#x7247;&#x6BD4;&#x5E94;&#x7528;&#x8FC7;&#x6EE4;&#x5668;&#x82B1;&#x8D39;&#x66F4;&#x5C11;&#x7684;&#x65F6;&#x95F4;&#x3002;&#x6D88;&#x606F;&#x961F;&#x5217;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x7F13;&#x51B2;&#x5C42;&#x6765;&#x5E2E;&#x52A9;&#x4EFB;&#x52A1;&#x6700;&#x9AD8;&#x6548;&#x7387;&#x7684;&#x6267;&#x884C;&#x2014;&#x2014;&#x2014;&#x5199;&#x5165;&#x961F;&#x5217;&#x7684;&#x5904;&#x7406;&#x4F1A;&#x5C3D;&#x53EF;&#x80FD;&#x7684;&#x5FEB;&#x901F;&#x3002;&#x8BE5;&#x7F13;&#x51B2;&#x6709;&#x52A9;&#x4E8E;&#x63A7;&#x5236;&#x548C;&#x4F18;&#x5316;&#x6570;&#x636E;&#x6D41;&#x7ECF;&#x8FC7;&#x7CFB;&#x7EDF;&#x7684;&#x901F;&#x5EA6;&#x3002;</p>
<h3 class="mume-header" id="28-%E5%BC%82%E6%AD%A5%E9%80%9A%E4%BF%A1" ebook-toc-level-3 heading="2.8&amp;#x3000;&amp;#x5F02;&amp;#x6B65;&amp;#x901A;&amp;#x4FE1;">2.8&#x3000;&#x5F02;&#x6B65;&#x901A;&#x4FE1;</h3>

<p>&#x5F88;&#x591A;&#x65F6;&#x5019;&#xFF0C;&#x7528;&#x6237;&#x4E0D;&#x60F3;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x7ACB;&#x5373;&#x5904;&#x7406;&#x6D88;&#x606F;&#x3002;&#x6D88;&#x606F;&#x961F;&#x5217;&#x63D0;&#x4F9B;&#x4E86;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x673A;&#x5236;&#xFF0C;&#x5141;&#x8BB8;&#x7528;&#x6237;&#x628A;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#x653E;&#x5165;&#x961F;&#x5217;&#xFF0C;&#x4F46;&#x5E76;&#x4E0D;&#x7ACB;&#x5373;&#x5904;&#x7406;&#x5B83;&#x3002;&#x60F3;&#x5411;&#x961F;&#x5217;&#x4E2D;&#x653E;&#x5165;&#x591A;&#x5C11;&#x6D88;&#x606F;&#x5C31;&#x653E;&#x591A;&#x5C11;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x9700;&#x8981;&#x7684;&#x65F6;&#x5019;&#x518D;&#x53BB;&#x5904;&#x7406;&#x5B83;&#x4EEC;&#x3002;</p>
<h2 class="mume-header" id="%E4%B8%89-%E5%B8%B8%E7%94%A8message-queue%E5%AF%B9%E6%AF%94" ebook-toc-level-2 heading="&amp;#x4E09;&amp;#x3001;&amp;#x5E38;&amp;#x7528;Message Queue&amp;#x5BF9;&amp;#x6BD4;">&#x4E09;&#x3001;&#x5E38;&#x7528;Message Queue&#x5BF9;&#x6BD4;</h2>

<h3 class="mume-header" id="31-rabbitmq" ebook-toc-level-3 heading="3.1&amp;#x3000;RabbitMQ">3.1&#x3000;RabbitMQ</h3>

<p>RabbitMQ&#x662F;&#x4F7F;&#x7528;Erlang&#x7F16;&#x5199;&#x7684;&#x4E00;&#x4E2A;&#x5F00;&#x6E90;&#x7684;&#x6D88;&#x606F;&#x961F;&#x5217;&#xFF0C;&#x672C;&#x8EAB;&#x652F;&#x6301;&#x5F88;&#x591A;&#x7684;&#x534F;&#x8BAE;&#xFF1A;AMQP&#xFF0C;XMPP, SMTP, STOMP&#xFF0C;&#x4E5F;&#x6B63;&#x56E0;&#x5982;&#x6B64;&#xFF0C;&#x5B83;&#x975E;&#x5E38;&#x91CD;&#x91CF;&#x7EA7;&#xFF0C;&#x66F4;&#x9002;&#x5408;&#x4E8E;&#x4F01;&#x4E1A;&#x7EA7;&#x7684;&#x5F00;&#x53D1;&#x3002;&#x540C;&#x65F6;&#x5B9E;&#x73B0;&#x4E86;Broker&#x6784;&#x67B6;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x6D88;&#x606F;&#x5728;&#x53D1;&#x9001;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#x65F6;&#x5148;&#x5728;&#x4E2D;&#x5FC3;&#x961F;&#x5217;&#x6392;&#x961F;&#x3002;&#x5BF9;&#x8DEF;&#x7531;&#xFF0C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x6216;&#x8005;&#x6570;&#x636E;&#x6301;&#x4E45;&#x5316;&#x90FD;&#x6709;&#x5F88;&#x597D;&#x7684;&#x652F;&#x6301;&#x3002;</p>
<h3 class="mume-header" id="32-redis" ebook-toc-level-3 heading="3.2&amp;#x3000;Redis">3.2&#x3000;Redis</h3>

<p>Redis&#x662F;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;Key-Value&#x5BF9;&#x7684;NoSQL&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5F00;&#x53D1;&#x7EF4;&#x62A4;&#x5F88;&#x6D3B;&#x8DC3;&#x3002;&#x867D;&#x7136;&#x5B83;&#x662F;&#x4E00;&#x4E2A;Key-Value&#x6570;&#x636E;&#x5E93;&#x5B58;&#x50A8;&#x7CFB;&#x7EDF;&#xFF0C;&#x4F46;&#x5B83;&#x672C;&#x8EAB;&#x652F;&#x6301;MQ&#x529F;&#x80FD;&#xFF0C;&#x6240;&#x4EE5;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x5F53;&#x505A;&#x4E00;&#x4E2A;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;&#x961F;&#x5217;&#x670D;&#x52A1;&#x6765;&#x4F7F;&#x7528;&#x3002;&#x5BF9;&#x4E8E;RabbitMQ&#x548C;Redis&#x7684;&#x5165;&#x961F;&#x548C;&#x51FA;&#x961F;&#x64CD;&#x4F5C;&#xFF0C;&#x5404;&#x6267;&#x884C;100&#x4E07;&#x6B21;&#xFF0C;&#x6BCF;10&#x4E07;&#x6B21;&#x8BB0;&#x5F55;&#x4E00;&#x6B21;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x3002;&#x6D4B;&#x8BD5;&#x6570;&#x636E;&#x5206;&#x4E3A;128Bytes&#x3001;512Bytes&#x3001;1K&#x548C;10K&#x56DB;&#x4E2A;&#x4E0D;&#x540C;&#x5927;&#x5C0F;&#x7684;&#x6570;&#x636E;&#x3002;&#x5B9E;&#x9A8C;&#x8868;&#x660E;&#xFF1A;&#x5165;&#x961F;&#x65F6;&#xFF0C;&#x5F53;&#x6570;&#x636E;&#x6BD4;&#x8F83;&#x5C0F;&#x65F6;Redis&#x7684;&#x6027;&#x80FD;&#x8981;&#x9AD8;&#x4E8E;RabbitMQ&#xFF0C;&#x800C;&#x5982;&#x679C;&#x6570;&#x636E;&#x5927;&#x5C0F;&#x8D85;&#x8FC7;&#x4E86;10K&#xFF0C;Redis&#x5219;&#x6162;&#x7684;&#x65E0;&#x6CD5;&#x5FCD;&#x53D7;&#xFF1B;&#x51FA;&#x961F;&#x65F6;&#xFF0C;&#x65E0;&#x8BBA;&#x6570;&#x636E;&#x5927;&#x5C0F;&#xFF0C;Redis&#x90FD;&#x8868;&#x73B0;&#x51FA;&#x975E;&#x5E38;&#x597D;&#x7684;&#x6027;&#x80FD;&#xFF0C;&#x800C;RabbitMQ&#x7684;&#x51FA;&#x961F;&#x6027;&#x80FD;&#x5219;&#x8FDC;&#x4F4E;&#x4E8E;Redis&#x3002;</p>
<h3 class="mume-header" id="33-zeromq" ebook-toc-level-3 heading="3.3&amp;#x3000;ZeroMQ">3.3&#x3000;ZeroMQ</h3>

<p>ZeroMQ&#x53F7;&#x79F0;&#x6700;&#x5FEB;&#x7684;&#x6D88;&#x606F;&#x961F;&#x5217;&#x7CFB;&#x7EDF;&#xFF0C;&#x5C24;&#x5176;&#x9488;&#x5BF9;&#x5927;&#x541E;&#x5410;&#x91CF;&#x7684;&#x9700;&#x6C42;&#x573A;&#x666F;&#x3002;ZeroMQ&#x80FD;&#x591F;&#x5B9E;&#x73B0;RabbitMQ&#x4E0D;&#x64C5;&#x957F;&#x7684;&#x9AD8;&#x7EA7;/&#x590D;&#x6742;&#x7684;&#x961F;&#x5217;&#xFF0C;&#x4F46;&#x662F;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x7EC4;&#x5408;&#x591A;&#x79CD;&#x6280;&#x672F;&#x6846;&#x67B6;&#xFF0C;&#x6280;&#x672F;&#x4E0A;&#x7684;&#x590D;&#x6742;&#x5EA6;&#x662F;&#x5BF9;&#x8FD9;MQ&#x80FD;&#x591F;&#x5E94;&#x7528;&#x6210;&#x529F;&#x7684;&#x6311;&#x6218;&#x3002;ZeroMQ&#x5177;&#x6709;&#x4E00;&#x4E2A;&#x72EC;&#x7279;&#x7684;&#x975E;&#x4E2D;&#x95F4;&#x4EF6;&#x7684;&#x6A21;&#x5F0F;&#xFF0C;&#x4F60;&#x4E0D;&#x9700;&#x8981;&#x5B89;&#x88C5;&#x548C;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#x670D;&#x52A1;&#x5668;&#x6216;&#x4E2D;&#x95F4;&#x4EF6;&#xFF0C;&#x56E0;&#x4E3A;&#x4F60;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5C06;&#x626E;&#x6F14;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x89D2;&#x8272;&#x3002;&#x4F60;&#x53EA;&#x9700;&#x8981;&#x7B80;&#x5355;&#x7684;&#x5F15;&#x7528;ZeroMQ&#x7A0B;&#x5E8F;&#x5E93;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;NuGet&#x5B89;&#x88C5;&#xFF0C;&#x7136;&#x540E;&#x4F60;&#x5C31;&#x53EF;&#x4EE5;&#x6109;&#x5FEB;&#x7684;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E4B;&#x95F4;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x4E86;&#x3002;&#x4F46;&#x662F;ZeroMQ&#x4EC5;&#x63D0;&#x4F9B;&#x975E;&#x6301;&#x4E45;&#x6027;&#x7684;&#x961F;&#x5217;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x5982;&#x679C;&#x5B95;&#x673A;&#xFF0C;&#x6570;&#x636E;&#x5C06;&#x4F1A;&#x4E22;&#x5931;&#x3002;&#x5176;&#x4E2D;&#xFF0C;Twitter&#x7684;Storm 0.9.0&#x4EE5;&#x524D;&#x7684;&#x7248;&#x672C;&#x4E2D;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;ZeroMQ&#x4F5C;&#x4E3A;&#x6570;&#x636E;&#x6D41;&#x7684;&#x4F20;&#x8F93;&#xFF08;Storm&#x4ECE;0.9&#x7248;&#x672C;&#x5F00;&#x59CB;&#x540C;&#x65F6;&#x652F;&#x6301;ZeroMQ&#x548C;Netty&#x4F5C;&#x4E3A;&#x4F20;&#x8F93;&#x6A21;&#x5757;&#xFF09;&#x3002;</p>
<h3 class="mume-header" id="34-activemq" ebook-toc-level-3 heading="3.4&amp;#x3000;ActiveMQ">3.4&#x3000;ActiveMQ</h3>

<p>ActiveMQ&#x662F;Apache&#x4E0B;&#x7684;&#x4E00;&#x4E2A;&#x5B50;&#x9879;&#x76EE;&#x3002; &#x7C7B;&#x4F3C;&#x4E8E;ZeroMQ&#xFF0C;&#x5B83;&#x80FD;&#x591F;&#x4EE5;&#x4EE3;&#x7406;&#x4EBA;&#x548C;&#x70B9;&#x5BF9;&#x70B9;&#x7684;&#x6280;&#x672F;&#x5B9E;&#x73B0;&#x961F;&#x5217;&#x3002;&#x540C;&#x65F6;&#x7C7B;&#x4F3C;&#x4E8E;RabbitMQ&#xFF0C;&#x5B83;&#x5C11;&#x91CF;&#x4EE3;&#x7801;&#x5C31;&#x53EF;&#x4EE5;&#x9AD8;&#x6548;&#x5730;&#x5B9E;&#x73B0;&#x9AD8;&#x7EA7;&#x5E94;&#x7528;&#x573A;&#x666F;&#x3002;</p>
<h3 class="mume-header" id="35-kafkajafka" ebook-toc-level-3 heading="3.5&amp;#x3000;Kafka/Jafka">3.5&#x3000;Kafka/Jafka</h3>

<p>Kafka&#x662F;Apache&#x4E0B;&#x7684;&#x4E00;&#x4E2A;&#x5B50;&#x9879;&#x76EE;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x9AD8;&#x6027;&#x80FD;&#x8DE8;&#x8BED;&#x8A00;&#x5206;&#x5E03;&#x5F0F;&#x53D1;&#x5E03;/&#x8BA2;&#x9605;&#x6D88;&#x606F;&#x961F;&#x5217;&#x7CFB;&#x7EDF;&#xFF0C;&#x800C;Jafka&#x662F;&#x5728;Kafka&#x4E4B;&#x4E0A;&#x5B75;&#x5316;&#x800C;&#x6765;&#x7684;&#xFF0C;&#x5373;Kafka&#x7684;&#x4E00;&#x4E2A;&#x5347;&#x7EA7;&#x7248;&#x3002;&#x5177;&#x6709;&#x4EE5;&#x4E0B;&#x7279;&#x6027;&#xFF1A;&#x5FEB;&#x901F;&#x6301;&#x4E45;&#x5316;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;O(1)&#x7684;&#x7CFB;&#x7EDF;&#x5F00;&#x9500;&#x4E0B;&#x8FDB;&#x884C;&#x6D88;&#x606F;&#x6301;&#x4E45;&#x5316;&#xFF1B;&#x9AD8;&#x541E;&#x5410;&#xFF0C;&#x5728;&#x4E00;&#x53F0;&#x666E;&#x901A;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x65E2;&#x53EF;&#x4EE5;&#x8FBE;&#x5230;10W/s&#x7684;&#x541E;&#x5410;&#x901F;&#x7387;&#xFF1B;&#x5B8C;&#x5168;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#xFF0C;Broker&#x3001;Producer&#x3001;Consumer&#x90FD;&#x539F;&#x751F;&#x81EA;&#x52A8;&#x652F;&#x6301;&#x5206;&#x5E03;&#x5F0F;&#xFF0C;&#x81EA;&#x52A8;&#x5B9E;&#x73B0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF1B;&#x652F;&#x6301;Hadoop&#x6570;&#x636E;&#x5E76;&#x884C;&#x52A0;&#x8F7D;&#xFF0C;&#x5BF9;&#x4E8E;&#x50CF;Hadoop&#x7684;&#x4E00;&#x6837;&#x7684;&#x65E5;&#x5FD7;&#x6570;&#x636E;&#x548C;&#x79BB;&#x7EBF;&#x5206;&#x6790;&#x7CFB;&#x7EDF;&#xFF0C;&#x4F46;&#x53C8;&#x8981;&#x6C42;&#x5B9E;&#x65F6;&#x5904;&#x7406;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x53EF;&#x884C;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;Kafka&#x901A;&#x8FC7;Hadoop&#x7684;&#x5E76;&#x884C;&#x52A0;&#x8F7D;&#x673A;&#x5236;&#x7EDF;&#x4E00;&#x4E86;&#x5728;&#x7EBF;&#x548C;&#x79BB;&#x7EBF;&#x7684;&#x6D88;&#x606F;&#x5904;&#x7406;&#x3002;Apache Kafka&#x76F8;&#x5BF9;&#x4E8E;ActiveMQ&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;&#x6D88;&#x606F;&#x7CFB;&#x7EDF;&#xFF0C;&#x9664;&#x4E86;&#x6027;&#x80FD;&#x975E;&#x5E38;&#x597D;&#x4E4B;&#x5916;&#xFF0C;&#x8FD8;&#x662F;&#x4E00;&#x4E2A;&#x5DE5;&#x4F5C;&#x826F;&#x597D;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x3002;</p>
<h2 class="mume-header" id="%E5%9B%9B-kafka%E4%B8%AD%E7%9A%84%E6%9C%AF%E8%AF%AD%E8%A7%A3%E9%87%8A" ebook-toc-level-2 heading="&amp;#x56DB;&amp;#x3001;Kafka&amp;#x4E2D;&amp;#x7684;&amp;#x672F;&amp;#x8BED;&amp;#x89E3;&amp;#x91CA;">&#x56DB;&#x3001;Kafka&#x4E2D;&#x7684;&#x672F;&#x8BED;&#x89E3;&#x91CA;</h2>

<h3 class="mume-header" id="41-%E6%A6%82%E8%BF%B0" ebook-toc-level-3 heading="4.1&amp;#x3000;&amp;#x6982;&amp;#x8FF0;">4.1&#x3000;&#x6982;&#x8FF0;</h3>

<p>&#x5728;&#x6DF1;&#x5165;&#x7406;&#x89E3;Kafka&#x4E4B;&#x524D;&#xFF0C;&#x5148;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;Kafka&#x4E2D;&#x7684;&#x672F;&#x8BED;&#x3002;&#x4E0B;&#x56FE;&#x5C55;&#x793A;&#x4E86;Kafka&#x7684;&#x76F8;&#x5173;&#x672F;&#x8BED;&#x4EE5;&#x53CA;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#xFF1A;</p>
<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164224.png" alt="img"></p>
<p>&#x4E0A;&#x56FE;&#x4E2D;&#x4E00;&#x4E2A;topic&#x914D;&#x7F6E;&#x4E86;3&#x4E2A;partition&#x3002;Partition1&#x6709;&#x4E24;&#x4E2A;offset&#xFF1A;0&#x548C;1&#x3002;Partition2&#x6709;4&#x4E2A;offset&#x3002;Partition3&#x6709;1&#x4E2A;offset&#x3002;&#x526F;&#x672C;&#x7684;id&#x548C;&#x526F;&#x672C;&#x6240;&#x5728;&#x7684;&#x673A;&#x5668;&#x7684;id&#x6070;&#x597D;&#x76F8;&#x540C;&#x3002;</p>
<p>&#x5982;&#x679C;&#x4E00;&#x4E2A;topic&#x7684;&#x526F;&#x672C;&#x6570;&#x4E3A;3&#xFF0C;&#x90A3;&#x4E48;Kafka&#x5C06;&#x5728;&#x96C6;&#x7FA4;&#x4E2D;&#x4E3A;&#x6BCF;&#x4E2A;partition&#x521B;&#x5EFA;3&#x4E2A;&#x76F8;&#x540C;&#x7684;&#x526F;&#x672C;&#x3002;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;broker&#x5B58;&#x50A8;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;partition&#x3002;&#x591A;&#x4E2A;producer&#x548C;consumer&#x53EF;&#x540C;&#x65F6;&#x751F;&#x4EA7;&#x548C;&#x6D88;&#x8D39;&#x6570;&#x636E;&#x3002;</p>
<h3 class="mume-header" id="42-broker" ebook-toc-level-3 heading="4.2&amp;#x3000;broker">4.2&#x3000;broker</h3>

<p>Kafka &#x96C6;&#x7FA4;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x8282;&#x70B9;&#x79F0;&#x4E3A;broker&#x3002;</p>
<p>broker&#x5B58;&#x50A8;topic&#x7684;&#x6570;&#x636E;&#x3002;&#x5982;&#x679C;&#x67D0;topic&#x6709;N&#x4E2A;partition&#xFF0C;&#x96C6;&#x7FA4;&#x6709;N&#x4E2A;broker&#xFF0C;&#x90A3;&#x4E48;&#x6BCF;&#x4E2A;broker&#x5B58;&#x50A8;&#x8BE5;topic&#x7684;&#x4E00;&#x4E2A;partition&#x3002;</p>
<p>&#x5982;&#x679C;&#x67D0;topic&#x6709;N&#x4E2A;partition&#xFF0C;&#x96C6;&#x7FA4;&#x6709;(N+M)&#x4E2A;broker&#xFF0C;&#x90A3;&#x4E48;&#x5176;&#x4E2D;&#x6709;N&#x4E2A;broker&#x5B58;&#x50A8;&#x8BE5;topic&#x7684;&#x4E00;&#x4E2A;partition&#xFF0C;&#x5269;&#x4E0B;&#x7684;M&#x4E2A;broker&#x4E0D;&#x5B58;&#x50A8;&#x8BE5;topic&#x7684;partition&#x6570;&#x636E;&#x3002;</p>
<p>&#x5982;&#x679C;&#x67D0;topic&#x6709;N&#x4E2A;partition&#xFF0C;&#x96C6;&#x7FA4;&#x4E2D;broker&#x6570;&#x76EE;&#x5C11;&#x4E8E;N&#x4E2A;&#xFF0C;&#x90A3;&#x4E48;&#x4E00;&#x4E2A;broker&#x5B58;&#x50A8;&#x8BE5;topic&#x7684;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;partition&#x3002;&#x5728;&#x5B9E;&#x9645;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x5C3D;&#x91CF;&#x907F;&#x514D;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x7684;&#x53D1;&#x751F;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x5BB9;&#x6613;&#x5BFC;&#x81F4;Kafka&#x96C6;&#x7FA4;&#x6570;&#x636E;&#x4E0D;&#x5747;&#x8861;&#x3002;</p>
<h3 class="mume-header" id="43-topic" ebook-toc-level-3 heading="4.3&amp;#x3000;Topic">4.3&#x3000;Topic</h3>

<p>&#x6BCF;&#x6761;&#x53D1;&#x5E03;&#x5230;Kafka&#x96C6;&#x7FA4;&#x7684;&#x6D88;&#x606F;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x7C7B;&#x522B;&#xFF0C;&#x8FD9;&#x4E2A;&#x7C7B;&#x522B;&#x88AB;&#x79F0;&#x4E3A;Topic&#x3002;&#xFF08;&#x7269;&#x7406;&#x4E0A;&#x4E0D;&#x540C;Topic&#x7684;&#x6D88;&#x606F;&#x5206;&#x5F00;&#x5B58;&#x50A8;&#xFF0C;&#x903B;&#x8F91;&#x4E0A;&#x4E00;&#x4E2A;Topic&#x7684;&#x6D88;&#x606F;&#x867D;&#x7136;&#x4FDD;&#x5B58;&#x4E8E;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;broker&#x4E0A;&#x4F46;&#x7528;&#x6237;&#x53EA;&#x9700;&#x6307;&#x5B9A;&#x6D88;&#x606F;&#x7684;Topic&#x5373;&#x53EF;&#x751F;&#x4EA7;&#x6216;&#x6D88;&#x8D39;&#x6570;&#x636E;&#x800C;&#x4E0D;&#x5FC5;&#x5173;&#x5FC3;&#x6570;&#x636E;&#x5B58;&#x4E8E;&#x4F55;&#x5904;&#xFF09;</p>
<p>&#x7C7B;&#x4F3C;&#x4E8E;&#x6570;&#x636E;&#x5E93;&#x7684;&#x8868;&#x540D;</p>
<h3 class="mume-header" id="43-partition" ebook-toc-level-3 heading="4.3&amp;#x3000;&lt;strong&gt;Partition&lt;/strong&gt;">4.3&#x3000;<strong>Partition</strong></h3>

<p>topic&#x4E2D;&#x7684;&#x6570;&#x636E;&#x5206;&#x5272;&#x4E3A;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;partition&#x3002;&#x6BCF;&#x4E2A;topic&#x81F3;&#x5C11;&#x6709;&#x4E00;&#x4E2A;partition&#x3002;&#x6BCF;&#x4E2A;partition&#x4E2D;&#x7684;&#x6570;&#x636E;&#x4F7F;&#x7528;&#x591A;&#x4E2A;segment&#x6587;&#x4EF6;&#x5B58;&#x50A8;&#x3002;partition&#x4E2D;&#x7684;&#x6570;&#x636E;&#x662F;&#x6709;&#x5E8F;&#x7684;&#xFF0C;&#x4E0D;&#x540C;partition&#x95F4;&#x7684;&#x6570;&#x636E;&#x4E22;&#x5931;&#x4E86;&#x6570;&#x636E;&#x7684;&#x987A;&#x5E8F;&#x3002;&#x5982;&#x679C;topic&#x6709;&#x591A;&#x4E2A;partition&#xFF0C;&#x6D88;&#x8D39;&#x6570;&#x636E;&#x65F6;&#x5C31;&#x4E0D;&#x80FD;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x7684;&#x987A;&#x5E8F;&#x3002;&#x5728;&#x9700;&#x8981;&#x4E25;&#x683C;&#x4FDD;&#x8BC1;&#x6D88;&#x606F;&#x7684;&#x6D88;&#x8D39;&#x987A;&#x5E8F;&#x7684;&#x573A;&#x666F;&#x4E0B;&#xFF0C;&#x9700;&#x8981;&#x5C06;partition&#x6570;&#x76EE;&#x8BBE;&#x4E3A;1&#x3002;</p>
<h3 class="mume-header" id="44-producer" ebook-toc-level-3 heading="4.4&amp;#x3000;Producer">4.4&#x3000;Producer</h3>

<p>&#x751F;&#x4EA7;&#x8005;&#x5373;&#x6570;&#x636E;&#x7684;&#x53D1;&#x5E03;&#x8005;&#xFF0C;&#x8BE5;&#x89D2;&#x8272;&#x5C06;&#x6D88;&#x606F;&#x53D1;&#x5E03;&#x5230;Kafka&#x7684;topic&#x4E2D;&#x3002;broker&#x63A5;&#x6536;&#x5230;&#x751F;&#x4EA7;&#x8005;&#x53D1;&#x9001;&#x7684;&#x6D88;&#x606F;&#x540E;&#xFF0C;broker&#x5C06;&#x8BE5;&#x6D88;&#x606F;<strong>&#x8FFD;&#x52A0;</strong>&#x5230;&#x5F53;&#x524D;&#x7528;&#x4E8E;&#x8FFD;&#x52A0;&#x6570;&#x636E;&#x7684;segment&#x6587;&#x4EF6;&#x4E2D;&#x3002;&#x751F;&#x4EA7;&#x8005;&#x53D1;&#x9001;&#x7684;&#x6D88;&#x606F;&#xFF0C;&#x5B58;&#x50A8;&#x5230;&#x4E00;&#x4E2A;partition&#x4E2D;&#xFF0C;&#x751F;&#x4EA7;&#x8005;&#x4E5F;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x7684;partition&#x3002;</p>
<h3 class="mume-header" id="45-consumer" ebook-toc-level-3 heading="4.5&amp;#x3000;Consumer">4.5&#x3000;Consumer</h3>

<p>&#x6D88;&#x8D39;&#x8005;&#x53EF;&#x4EE5;&#x4ECE;broker&#x4E2D;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x3002;&#x6D88;&#x8D39;&#x8005;&#x53EF;&#x4EE5;&#x6D88;&#x8D39;&#x591A;&#x4E2A;topic&#x4E2D;&#x7684;&#x6570;&#x636E;&#x3002;</p>
<h3 class="mume-header" id="46-consumer-group" ebook-toc-level-3 heading="4.6&amp;#x3000;Consumer Group">4.6&#x3000;Consumer Group</h3>

<p>&#x6BCF;&#x4E2A;Consumer&#x5C5E;&#x4E8E;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x7684;Consumer Group&#xFF08;&#x53EF;&#x4E3A;&#x6BCF;&#x4E2A;Consumer&#x6307;&#x5B9A;group name&#xFF0C;&#x82E5;&#x4E0D;&#x6307;&#x5B9A;group name&#x5219;&#x5C5E;&#x4E8E;&#x9ED8;&#x8BA4;&#x7684;group&#xFF09;&#x3002;</p>
<h3 class="mume-header" id="47-leader" ebook-toc-level-3 heading="4.7&amp;#x3000;Leader">4.7&#x3000;Leader</h3>

<p>&#x6BCF;&#x4E2A;partition&#x6709;&#x591A;&#x4E2A;&#x526F;&#x672C;&#xFF0C;&#x5176;&#x4E2D;&#x6709;&#x4E14;&#x4EC5;&#x6709;&#x4E00;&#x4E2A;&#x4F5C;&#x4E3A;Leader&#xFF0C;Leader&#x662F;&#x5F53;&#x524D;&#x8D1F;&#x8D23;&#x6570;&#x636E;&#x7684;&#x8BFB;&#x5199;&#x7684;partition&#x3002;</p>
<h3 class="mume-header" id="48-follower" ebook-toc-level-3 heading="4.8&amp;#x3000;Follower">4.8&#x3000;Follower</h3>

<p>Follower&#x8DDF;&#x968F;Leader&#xFF0C;&#x6240;&#x6709;&#x5199;&#x8BF7;&#x6C42;&#x90FD;&#x901A;&#x8FC7;Leader&#x8DEF;&#x7531;&#xFF0C;&#x6570;&#x636E;&#x53D8;&#x66F4;&#x4F1A;&#x5E7F;&#x64AD;&#x7ED9;&#x6240;&#x6709;Follower&#xFF0C;Follower&#x4E0E;Leader&#x4FDD;&#x6301;&#x6570;&#x636E;&#x540C;&#x6B65;&#x3002;&#x5982;&#x679C;Leader&#x5931;&#x6548;&#xFF0C;&#x5219;&#x4ECE;Follower&#x4E2D;&#x9009;&#x4E3E;&#x51FA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;Leader&#x3002;&#x5F53;Follower&#x4E0E;Leader&#x6302;&#x6389;&#x3001;&#x5361;&#x4F4F;&#x6216;&#x8005;&#x540C;&#x6B65;&#x592A;&#x6162;&#xFF0C;leader&#x4F1A;&#x628A;&#x8FD9;&#x4E2A;follower&#x4ECE;&#x201C;in sync replicas&#x201D;&#xFF08;ISR&#xFF09;&#x5217;&#x8868;&#x4E2D;&#x5220;&#x9664;&#xFF0C;&#x91CD;&#x65B0;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Follower&#x3002;</p>
<h2 class="mume-header" id="%E5%8F%82%E8%80%83" ebook-toc-level-2 heading="&amp;#x53C2;&amp;#x8003;">&#x53C2;&#x8003;</h2>

<p><a href="https://www.cnblogs.com/qingyunzong/p/9004509.html">https://www.cnblogs.com/qingyunzong/p/9004509.html</a></p>
<h1 class="mume-header" id="%E4%B8%80-kafka%E7%9A%84%E6%9E%B6%E6%9E%84" ebook-toc-level-1 heading="&amp;#x4E00;&amp;#x3001;Kafka&amp;#x7684;&amp;#x67B6;&amp;#x6784;">&#x4E00;&#x3001;Kafka&#x7684;&#x67B6;&#x6784;</h1>

<h2 class="mume-header" id="%E4%B8%80-kafka%E7%9A%84%E6%9E%B6%E6%9E%84-1" ebook-toc-level-2 heading="&amp;#x4E00;&amp;#x3001;Kafka&amp;#x7684;&amp;#x67B6;&amp;#x6784;">&#x4E00;&#x3001;Kafka&#x7684;&#x67B6;&#x6784;</h2>

<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164149.png" alt="img"></p>
<p>&#x5982;&#x4E0A;&#x56FE;&#x6240;&#x793A;&#xFF0C;&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x7684;Kafka&#x96C6;&#x7FA4;&#x4E2D;&#x5305;&#x542B;&#x82E5;&#x5E72;Producer&#xFF08;&#x53EF;&#x4EE5;&#x662F;web&#x524D;&#x7AEF;&#x4EA7;&#x751F;&#x7684;Page View&#xFF0C;&#x6216;&#x8005;&#x662F;&#x670D;&#x52A1;&#x5668;&#x65E5;&#x5FD7;&#xFF0C;&#x7CFB;&#x7EDF;CPU&#x3001;Memory&#x7B49;&#xFF09;&#xFF0C;&#x82E5;&#x5E72;broker&#xFF08;Kafka&#x652F;&#x6301;&#x6C34;&#x5E73;&#x6269;&#x5C55;&#xFF0C;&#x4E00;&#x822C;broker&#x6570;&#x91CF;&#x8D8A;&#x591A;&#xFF0C;&#x96C6;&#x7FA4;&#x541E;&#x5410;&#x7387;&#x8D8A;&#x9AD8;&#xFF09;&#xFF0C;&#x82E5;&#x5E72;Consumer Group&#xFF0C;&#x4EE5;&#x53CA;&#x4E00;&#x4E2A;Zookeeper&#x96C6;&#x7FA4;&#x3002;Kafka&#x901A;&#x8FC7;Zookeeper&#x7BA1;&#x7406;&#x96C6;&#x7FA4;&#x914D;&#x7F6E;&#xFF0C;&#x9009;&#x4E3E;leader&#xFF0C;&#x4EE5;&#x53CA;&#x5728;Consumer Group&#x53D1;&#x751F;&#x53D8;&#x5316;&#x65F6;&#x8FDB;&#x884C;rebalance&#x3002;Producer&#x4F7F;&#x7528;push&#x6A21;&#x5F0F;&#x5C06;&#x6D88;&#x606F;&#x53D1;&#x5E03;&#x5230;broker&#xFF0C;Consumer&#x4F7F;&#x7528;pull&#x6A21;&#x5F0F;&#x4ECE;broker&#x8BA2;&#x9605;&#x5E76;&#x6D88;&#x8D39;&#x6D88;&#x606F;&#x3002;</p>
<h2 class="mume-header" id="%E4%BA%8C-topics%E5%92%8Cpartition" ebook-toc-level-2 heading="&amp;#x4E8C;&amp;#x3001;Topics&amp;#x548C;Partition">&#x4E8C;&#x3001;Topics&#x548C;Partition</h2>

<p>Topic&#x5728;&#x903B;&#x8F91;&#x4E0A;&#x53EF;&#x4EE5;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x4E00;&#x4E2A;queue&#xFF0C;&#x6BCF;&#x6761;&#x6D88;&#x8D39;&#x90FD;&#x5FC5;&#x987B;&#x6307;&#x5B9A;&#x5B83;&#x7684;Topic&#xFF0C;&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x7406;&#x89E3;&#x4E3A;&#x5FC5;&#x987B;&#x6307;&#x660E;&#x628A;&#x8FD9;&#x6761;&#x6D88;&#x606F;&#x653E;&#x8FDB;&#x54EA;&#x4E2A;queue&#x91CC;&#x3002;&#x4E3A;&#x4E86;&#x4F7F;&#x5F97;Kafka&#x7684;&#x541E;&#x5410;&#x7387;&#x53EF;&#x4EE5;&#x7EBF;&#x6027;&#x63D0;&#x9AD8;&#xFF0C;&#x7269;&#x7406;&#x4E0A;&#x628A;Topic&#x5206;&#x6210;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;Partition&#xFF0C;&#x6BCF;&#x4E2A;Partition&#x5728;&#x7269;&#x7406;&#x4E0A;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x8BE5;&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x5B58;&#x50A8;&#x8FD9;&#x4E2A;Partition&#x7684;&#x6240;&#x6709;&#x6D88;&#x606F;&#x548C;&#x7D22;&#x5F15;&#x6587;&#x4EF6;&#x3002;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;topic&#x65F6;&#xFF0C;&#x540C;&#x65F6;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x5206;&#x533A;&#x6570;&#x76EE;&#xFF0C;&#x5206;&#x533A;&#x6570;&#x8D8A;&#x591A;&#xFF0C;&#x5176;&#x541E;&#x5410;&#x91CF;&#x4E5F;&#x8D8A;&#x5927;&#xFF0C;&#x4F46;&#x662F;&#x9700;&#x8981;&#x7684;&#x8D44;&#x6E90;&#x4E5F;&#x8D8A;&#x591A;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x4F1A;&#x5BFC;&#x81F4;&#x66F4;&#x9AD8;&#x7684;&#x4E0D;&#x53EF;&#x7528;&#x6027;&#xFF0C;kafka&#x5728;&#x63A5;&#x6536;&#x5230;&#x751F;&#x4EA7;&#x8005;&#x53D1;&#x9001;&#x7684;&#x6D88;&#x606F;&#x4E4B;&#x540E;&#xFF0C;&#x4F1A;&#x6839;&#x636E;&#x5747;&#x8861;&#x7B56;&#x7565;&#x5C06;&#x6D88;&#x606F;&#x5B58;&#x50A8;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x5206;&#x533A;&#x4E2D;&#x3002;&#x56E0;&#x4E3A;&#x6BCF;&#x6761;&#x6D88;&#x606F;&#x90FD;&#x88AB;append&#x5230;&#x8BE5;Partition&#x4E2D;&#xFF0C;&#x5C5E;&#x4E8E;&#x987A;&#x5E8F;&#x5199;&#x78C1;&#x76D8;&#xFF0C;&#x56E0;&#x6B64;&#x6548;&#x7387;&#x975E;&#x5E38;&#x9AD8;&#xFF08;&#x7ECF;&#x9A8C;&#x8BC1;&#xFF0C;&#x987A;&#x5E8F;&#x5199;&#x78C1;&#x76D8;&#x6548;&#x7387;&#x6BD4;&#x968F;&#x673A;&#x5199;&#x5185;&#x5B58;&#x8FD8;&#x8981;&#x9AD8;&#xFF0C;&#x8FD9;&#x662F;Kafka&#x9AD8;&#x541E;&#x5410;&#x7387;&#x7684;&#x4E00;&#x4E2A;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x4FDD;&#x8BC1;&#xFF09;&#x3002;</p>
<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164152.png" alt="img"></p>
<p>&#x5BF9;&#x4E8E;&#x4F20;&#x7EDF;&#x7684;message queue&#x800C;&#x8A00;&#xFF0C;&#x4E00;&#x822C;&#x4F1A;&#x5220;&#x9664;&#x5DF2;&#x7ECF;&#x88AB;&#x6D88;&#x8D39;&#x7684;&#x6D88;&#x606F;&#xFF0C;&#x800C;Kafka&#x96C6;&#x7FA4;&#x4F1A;&#x4FDD;&#x7559;&#x6240;&#x6709;&#x7684;&#x6D88;&#x606F;&#xFF0C;&#x65E0;&#x8BBA;&#x5176;&#x88AB;&#x6D88;&#x8D39;&#x4E0E;&#x5426;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x56E0;&#x4E3A;&#x78C1;&#x76D8;&#x9650;&#x5236;&#xFF0C;&#x4E0D;&#x53EF;&#x80FD;&#x6C38;&#x4E45;&#x4FDD;&#x7559;&#x6240;&#x6709;&#x6570;&#x636E;&#xFF08;&#x5B9E;&#x9645;&#x4E0A;&#x4E5F;&#x6CA1;&#x5FC5;&#x8981;&#xFF09;&#xFF0C;&#x56E0;&#x6B64;Kafka&#x63D0;&#x4F9B;&#x4E24;&#x79CD;&#x7B56;&#x7565;&#x5220;&#x9664;&#x65E7;&#x6570;&#x636E;&#x3002;&#x4E00;&#x662F;&#x57FA;&#x4E8E;&#x65F6;&#x95F4;&#xFF0C;&#x4E8C;&#x662F;&#x57FA;&#x4E8E;Partition&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x3002;&#x4F8B;&#x5982;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x914D;&#x7F6E;$KAFKA_HOME/config/server.properties&#xFF0C;&#x8BA9;Kafka&#x5220;&#x9664;&#x4E00;&#x5468;&#x524D;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4E5F;&#x53EF;&#x5728;Partition&#x6587;&#x4EF6;&#x8D85;&#x8FC7;1GB&#x65F6;&#x5220;&#x9664;&#x65E7;&#x6570;&#x636E;&#xFF0C;&#x914D;&#x7F6E;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<pre data-role="codeBlock" data-info class="language-"><code># The minimum age of a log file to be eligible for deletion
log.retention.hours=168
# The maximum size of a log segment file. When this size is reached a new log segment will be created.
log.segment.bytes=1073741824
# The interval at which log segments are checked to see if they can be deleted according to the retention policies
log.retention.check.interval.ms=300000
# If log.cleaner.enable=true is set the cleaner will be enabled and individual logs can then be marked for log compaction.
log.cleaner.enable=false
</code></pre><p>&#x56E0;&#x4E3A;Kafka&#x8BFB;&#x53D6;&#x7279;&#x5B9A;&#x6D88;&#x606F;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;O(1)&#xFF0C;&#x5373;&#x4E0E;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x65E0;&#x5173;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x5220;&#x9664;&#x8FC7;&#x671F;&#x6587;&#x4EF6;&#x4E0E;&#x63D0;&#x9AD8;Kafka&#x6027;&#x80FD;&#x65E0;&#x5173;&#x3002;&#x9009;&#x62E9;&#x600E;&#x6837;&#x7684;&#x5220;&#x9664;&#x7B56;&#x7565;&#x53EA;&#x4E0E;&#x78C1;&#x76D8;&#x4EE5;&#x53CA;&#x5177;&#x4F53;&#x7684;&#x9700;&#x6C42;&#x6709;&#x5173;&#x3002;&#x53E6;&#x5916;&#xFF0C;Kafka&#x4F1A;&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A;Consumer Group&#x4FDD;&#x7559;&#x4E00;&#x4E9B;metadata&#x4FE1;&#x606F;&#x2014;&#x2014;&#x5F53;&#x524D;&#x6D88;&#x8D39;&#x7684;&#x6D88;&#x606F;&#x7684;position&#xFF0C;&#x4E5F;&#x5373;offset&#x3002;&#x8FD9;&#x4E2A;offset&#x7531;Consumer&#x63A7;&#x5236;&#x3002;&#x6B63;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;Consumer&#x4F1A;&#x5728;&#x6D88;&#x8D39;&#x5B8C;&#x4E00;&#x6761;&#x6D88;&#x606F;&#x540E;&#x9012;&#x589E;&#x8BE5;offset&#x3002;&#x5F53;&#x7136;&#xFF0C;Consumer&#x4E5F;&#x53EF;&#x5C06;offset&#x8BBE;&#x6210;&#x4E00;&#x4E2A;&#x8F83;&#x5C0F;&#x7684;&#x503C;&#xFF0C;&#x91CD;&#x65B0;&#x6D88;&#x8D39;&#x4E00;&#x4E9B;&#x6D88;&#x606F;&#x3002;&#x56E0;&#x4E3A;offet&#x7531;Consumer&#x63A7;&#x5236;&#xFF0C;&#x6240;&#x4EE5;Kafka broker&#x662F;&#x65E0;&#x72B6;&#x6001;&#x7684;&#xFF0C;&#x5B83;&#x4E0D;&#x9700;&#x8981;&#x6807;&#x8BB0;&#x54EA;&#x4E9B;&#x6D88;&#x606F;&#x88AB;&#x54EA;&#x4E9B;&#x6D88;&#x8D39;&#x8FC7;&#xFF0C;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x901A;&#x8FC7;broker&#x53BB;&#x4FDD;&#x8BC1;&#x540C;&#x4E00;&#x4E2A;Consumer Group&#x53EA;&#x6709;&#x4E00;&#x4E2A;Consumer&#x80FD;&#x6D88;&#x8D39;&#x67D0;&#x4E00;&#x6761;&#x6D88;&#x606F;&#xFF0C;&#x56E0;&#x6B64;&#x4E5F;&#x5C31;&#x4E0D;&#x9700;&#x8981;&#x9501;&#x673A;&#x5236;&#xFF0C;&#x8FD9;&#x4E5F;&#x4E3A;Kafka&#x7684;&#x9AD8;&#x541E;&#x5410;&#x7387;&#x63D0;&#x4F9B;&#x4E86;&#x6709;&#x529B;&#x4FDD;&#x969C;&#x3002;</p>
<h2 class="mume-header" id="%E4%B8%89-producer%E6%B6%88%E6%81%AF%E8%B7%AF%E7%94%B1" ebook-toc-level-2 heading="&amp;#x4E09;&amp;#x3001;Producer&amp;#x6D88;&amp;#x606F;&amp;#x8DEF;&amp;#x7531;">&#x4E09;&#x3001;Producer&#x6D88;&#x606F;&#x8DEF;&#x7531;</h2>

<p>Producer&#x53D1;&#x9001;&#x6D88;&#x606F;&#x5230;broker&#x65F6;&#xFF0C;&#x4F1A;&#x6839;&#x636E;Paritition&#x673A;&#x5236;&#x9009;&#x62E9;&#x5C06;&#x5176;&#x5B58;&#x50A8;&#x5230;&#x54EA;&#x4E00;&#x4E2A;Partition&#x3002;&#x5982;&#x679C;Partition&#x673A;&#x5236;&#x8BBE;&#x7F6E;&#x5408;&#x7406;&#xFF0C;&#x6240;&#x6709;&#x6D88;&#x606F;&#x53EF;&#x4EE5;&#x5747;&#x5300;&#x5206;&#x5E03;&#x5230;&#x4E0D;&#x540C;&#x7684;Partition&#x91CC;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x5B9E;&#x73B0;&#x4E86;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3002;&#x5982;&#x679C;&#x4E00;&#x4E2A;Topic&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x90A3;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x6240;&#x5728;&#x7684;&#x673A;&#x5668;I/O&#x5C06;&#x4F1A;&#x6210;&#x4E3A;&#x8FD9;&#x4E2A;Topic&#x7684;&#x6027;&#x80FD;&#x74F6;&#x9888;&#xFF0C;&#x800C;&#x6709;&#x4E86;Partition&#x540E;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x6D88;&#x606F;&#x53EF;&#x4EE5;&#x5E76;&#x884C;&#x5199;&#x5165;&#x4E0D;&#x540C;broker&#x7684;&#x4E0D;&#x540C;Partition&#x91CC;&#xFF0C;&#x6781;&#x5927;&#x7684;&#x63D0;&#x9AD8;&#x4E86;&#x541E;&#x5410;&#x7387;&#x3002;&#x53EF;&#x4EE5;&#x5728;$KAFKA_HOME/config/server.properties&#x4E2D;&#x901A;&#x8FC7;&#x914D;&#x7F6E;&#x9879;num.partitions&#x6765;&#x6307;&#x5B9A;&#x65B0;&#x5EFA;Topic&#x7684;&#x9ED8;&#x8BA4;Partition&#x6570;&#x91CF;&#xFF0C;&#x4E5F;&#x53EF;&#x5728;&#x521B;&#x5EFA;Topic&#x65F6;&#x901A;&#x8FC7;&#x53C2;&#x6570;&#x6307;&#x5B9A;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;Topic&#x521B;&#x5EFA;&#x4E4B;&#x540E;&#x901A;&#x8FC7;Kafka&#x63D0;&#x4F9B;&#x7684;&#x5DE5;&#x5177;&#x4FEE;&#x6539;&#x3002;</p>
<p>&#x5728;&#x53D1;&#x9001;&#x4E00;&#x6761;&#x6D88;&#x606F;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x8FD9;&#x6761;&#x6D88;&#x606F;&#x7684;key&#xFF0C;Producer&#x6839;&#x636E;&#x8FD9;&#x4E2A;key&#x548C;Partition&#x673A;&#x5236;&#x6765;&#x5224;&#x65AD;&#x5E94;&#x8BE5;&#x5C06;&#x8FD9;&#x6761;&#x6D88;&#x606F;&#x53D1;&#x9001;&#x5230;&#x54EA;&#x4E2A;Parition&#x3002;Paritition&#x673A;&#x5236;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6307;&#x5B9A;Producer&#x7684;paritition. class&#x8FD9;&#x4E00;&#x53C2;&#x6570;&#x6765;&#x6307;&#x5B9A;&#xFF0C;&#x8BE5;class&#x5FC5;&#x987B;&#x5B9E;&#x73B0;kafka.producer.Partitioner&#x63A5;&#x53E3;&#x3002;</p>
<h2 class="mume-header" id="%E5%9B%9B-consumer-group" ebook-toc-level-2 heading="&amp;#x56DB;&amp;#x3001;Consumer Group">&#x56DB;&#x3001;Consumer Group</h2>

<p>&#x4F7F;&#x7528;Consumer high level API&#x65F6;&#xFF0C;&#x540C;&#x4E00;Topic&#x7684;&#x4E00;&#x6761;&#x6D88;&#x606F;&#x53EA;&#x80FD;&#x88AB;&#x540C;&#x4E00;&#x4E2A;Consumer Group&#x5185;&#x7684;&#x4E00;&#x4E2A;Consumer&#x6D88;&#x8D39;&#xFF0C;&#x4F46;&#x591A;&#x4E2A;Consumer Group&#x53EF;&#x540C;&#x65F6;&#x6D88;&#x8D39;&#x8FD9;&#x4E00;&#x6D88;&#x606F;&#x3002;</p>
<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164155.png" alt="img"></p>
<p>&#x8FD9;&#x662F;Kafka&#x7528;&#x6765;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;Topic&#x6D88;&#x606F;&#x7684;&#x5E7F;&#x64AD;&#xFF08;&#x53D1;&#x7ED9;&#x6240;&#x6709;&#x7684;Consumer&#xFF09;&#x548C;&#x5355;&#x64AD;&#xFF08;&#x53D1;&#x7ED9;&#x67D0;&#x4E00;&#x4E2A;Consumer&#xFF09;&#x7684;&#x624B;&#x6BB5;&#x3002;&#x4E00;&#x4E2A;Topic&#x53EF;&#x4EE5;&#x5BF9;&#x5E94;&#x591A;&#x4E2A;Consumer Group&#x3002;&#x5982;&#x679C;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x5E7F;&#x64AD;&#xFF0C;&#x53EA;&#x8981;&#x6BCF;&#x4E2A;Consumer&#x6709;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;Group&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;&#x8981;&#x5B9E;&#x73B0;&#x5355;&#x64AD;&#x53EA;&#x8981;&#x6240;&#x6709;&#x7684;Consumer&#x5728;&#x540C;&#x4E00;&#x4E2A;Group&#x91CC;&#x3002;&#x7528;Consumer Group&#x8FD8;&#x53EF;&#x4EE5;&#x5C06;Consumer&#x8FDB;&#x884C;&#x81EA;&#x7531;&#x7684;&#x5206;&#x7EC4;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x591A;&#x6B21;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x5230;&#x4E0D;&#x540C;&#x7684;Topic&#x3002;</p>
<p>&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;Kafka&#x7684;&#x8BBE;&#x8BA1;&#x7406;&#x5FF5;&#x4E4B;&#x4E00;&#x5C31;&#x662F;&#x540C;&#x65F6;&#x63D0;&#x4F9B;&#x79BB;&#x7EBF;&#x5904;&#x7406;&#x548C;&#x5B9E;&#x65F6;&#x5904;&#x7406;&#x3002;&#x6839;&#x636E;&#x8FD9;&#x4E00;&#x7279;&#x6027;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Storm&#x8FD9;&#x79CD;&#x5B9E;&#x65F6;&#x6D41;&#x5904;&#x7406;&#x7CFB;&#x7EDF;&#x5BF9;&#x6D88;&#x606F;&#x8FDB;&#x884C;&#x5B9E;&#x65F6;&#x5728;&#x7EBF;&#x5904;&#x7406;&#xFF0C;&#x540C;&#x65F6;&#x4F7F;&#x7528;Hadoop&#x8FD9;&#x79CD;&#x6279;&#x5904;&#x7406;&#x7CFB;&#x7EDF;&#x8FDB;&#x884C;&#x79BB;&#x7EBF;&#x5904;&#x7406;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x5C06;&#x6570;&#x636E;&#x5B9E;&#x65F6;&#x5907;&#x4EFD;&#x5230;&#x53E6;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x4E2D;&#x5FC3;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x4FDD;&#x8BC1;&#x8FD9;&#x4E09;&#x4E2A;&#x64CD;&#x4F5C;&#x6240;&#x4F7F;&#x7528;&#x7684;Consumer&#x5C5E;&#x4E8E;&#x4E0D;&#x540C;&#x7684;Consumer Group&#x5373;&#x53EF;&#x3002;</p>
<h2 class="mume-header" id="%E4%BA%94-push-vs-pull" ebook-toc-level-2 heading="&amp;#x4E94;&amp;#x3001;Push vs. Pull">&#x4E94;&#x3001;Push vs. Pull</h2>

<p>&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#x7CFB;&#x7EDF;&#xFF0C;Kafka&#x9075;&#x5FAA;&#x4E86;&#x4F20;&#x7EDF;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x9009;&#x62E9;&#x7531;Producer&#x5411;broker push&#x6D88;&#x606F;&#x5E76;&#x7531;Consumer&#x4ECE;broker pull&#x6D88;&#x606F;&#x3002;&#x4E00;&#x4E9B;logging-centric system&#xFF0C;&#x6BD4;&#x5982;Facebook&#x7684;Scribe&#x548C;Cloudera&#x7684;Flume&#xFF0C;&#x91C7;&#x7528;push&#x6A21;&#x5F0F;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;push&#x6A21;&#x5F0F;&#x548C;pull&#x6A21;&#x5F0F;&#x5404;&#x6709;&#x4F18;&#x52A3;&#x3002;</p>
<p>push&#x6A21;&#x5F0F;&#x5F88;&#x96BE;&#x9002;&#x5E94;&#x6D88;&#x8D39;&#x901F;&#x7387;&#x4E0D;&#x540C;&#x7684;&#x6D88;&#x8D39;&#x8005;&#xFF0C;&#x56E0;&#x4E3A;&#x6D88;&#x606F;&#x53D1;&#x9001;&#x901F;&#x7387;&#x662F;&#x7531;broker&#x51B3;&#x5B9A;&#x7684;&#x3002;push&#x6A21;&#x5F0F;&#x7684;&#x76EE;&#x6807;&#x662F;&#x5C3D;&#x53EF;&#x80FD;&#x4EE5;&#x6700;&#x5FEB;&#x901F;&#x5EA6;&#x4F20;&#x9012;&#x6D88;&#x606F;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x6837;&#x5F88;&#x5BB9;&#x6613;&#x9020;&#x6210;Consumer&#x6765;&#x4E0D;&#x53CA;&#x5904;&#x7406;&#x6D88;&#x606F;&#xFF0C;&#x5178;&#x578B;&#x7684;&#x8868;&#x73B0;&#x5C31;&#x662F;&#x62D2;&#x7EDD;&#x670D;&#x52A1;&#x4EE5;&#x53CA;&#x7F51;&#x7EDC;&#x62E5;&#x585E;&#x3002;&#x800C;pull&#x6A21;&#x5F0F;&#x5219;&#x53EF;&#x4EE5;&#x6839;&#x636E;Consumer&#x7684;&#x6D88;&#x8D39;&#x80FD;&#x529B;&#x4EE5;&#x9002;&#x5F53;&#x7684;&#x901F;&#x7387;&#x6D88;&#x8D39;&#x6D88;&#x606F;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;Kafka&#x800C;&#x8A00;&#xFF0C;pull&#x6A21;&#x5F0F;&#x66F4;&#x5408;&#x9002;&#x3002;pull&#x6A21;&#x5F0F;&#x53EF;&#x7B80;&#x5316;broker&#x7684;&#x8BBE;&#x8BA1;&#xFF0C;Consumer&#x53EF;&#x81EA;&#x4E3B;&#x63A7;&#x5236;&#x6D88;&#x8D39;&#x6D88;&#x606F;&#x7684;&#x901F;&#x7387;&#xFF0C;&#x540C;&#x65F6;Consumer&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x63A7;&#x5236;&#x6D88;&#x8D39;&#x65B9;&#x5F0F;&#x2014;&#x2014;&#x5373;&#x53EF;&#x6279;&#x91CF;&#x6D88;&#x8D39;&#x4E5F;&#x53EF;&#x9010;&#x6761;&#x6D88;&#x8D39;&#xFF0C;&#x540C;&#x65F6;&#x8FD8;&#x80FD;&#x9009;&#x62E9;&#x4E0D;&#x540C;&#x7684;&#x63D0;&#x4EA4;&#x65B9;&#x5F0F;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x4E0D;&#x540C;&#x7684;&#x4F20;&#x8F93;&#x8BED;&#x4E49;&#x3002;</p>
<h2 class="mume-header" id="%E5%85%AD-kafka-delivery-guarantee" ebook-toc-level-2 heading="&amp;#x516D;&amp;#x3001;Kafka delivery guarantee">&#x516D;&#x3001;Kafka delivery guarantee</h2>

<p>&#x6709;&#x8FD9;&#x4E48;&#x51E0;&#x79CD;&#x53EF;&#x80FD;&#x7684;delivery guarantee&#xFF1A;</p>
<blockquote>
<p>At most once &#x3000;&#x3000;&#x6D88;&#x606F;&#x53EF;&#x80FD;&#x4F1A;&#x4E22;&#xFF0C;&#x4F46;&#x7EDD;&#x4E0D;&#x4F1A;&#x91CD;&#x590D;&#x4F20;&#x8F93;</p>
<p>At least one &#x3000;&#x3000; &#x6D88;&#x606F;&#x7EDD;&#x4E0D;&#x4F1A;&#x4E22;&#xFF0C;&#x4F46;&#x53EF;&#x80FD;&#x4F1A;&#x91CD;&#x590D;&#x4F20;&#x8F93;</p>
<p>Exactly once &#x3000;&#x3000; &#x6BCF;&#x6761;&#x6D88;&#x606F;&#x80AF;&#x5B9A;&#x4F1A;&#x88AB;&#x4F20;&#x8F93;&#x4E00;&#x6B21;&#x4E14;&#x4EC5;&#x4F20;&#x8F93;&#x4E00;&#x6B21;&#xFF0C;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x8FD9;&#x662F;&#x7528;&#x6237;&#x6240;&#x60F3;&#x8981;&#x7684;&#x3002;</p>
</blockquote>
<p>&#x5F53;Producer&#x5411;broker&#x53D1;&#x9001;&#x6D88;&#x606F;&#x65F6;&#xFF0C;&#x4E00;&#x65E6;&#x8FD9;&#x6761;&#x6D88;&#x606F;&#x88AB;commit&#xFF0C;&#x56E0;&#x6570;replication&#x7684;&#x5B58;&#x5728;&#xFF0C;&#x5B83;&#x5C31;&#x4E0D;&#x4F1A;&#x4E22;&#x3002;&#x4F46;&#x662F;&#x5982;&#x679C;Producer&#x53D1;&#x9001;&#x6570;&#x636E;&#x7ED9;broker&#x540E;&#xFF0C;&#x9047;&#x5230;&#x7F51;&#x7EDC;&#x95EE;&#x9898;&#x800C;&#x9020;&#x6210;&#x901A;&#x4FE1;&#x4E2D;&#x65AD;&#xFF0C;&#x90A3;Producer&#x5C31;&#x65E0;&#x6CD5;&#x5224;&#x65AD;&#x8BE5;&#x6761;&#x6D88;&#x606F;&#x662F;&#x5426;&#x5DF2;&#x7ECF;commit&#x3002;&#x867D;&#x7136;Kafka&#x65E0;&#x6CD5;&#x786E;&#x5B9A;&#x7F51;&#x7EDC;&#x6545;&#x969C;&#x671F;&#x95F4;&#x53D1;&#x751F;&#x4E86;&#x4EC0;&#x4E48;&#xFF0C;&#x4F46;&#x662F;Producer&#x53EF;&#x4EE5;&#x751F;&#x6210;&#x4E00;&#x79CD;&#x7C7B;&#x4F3C;&#x4E8E;&#x4E3B;&#x952E;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x53D1;&#x751F;&#x6545;&#x969C;&#x65F6;&#x5E42;&#x7B49;&#x6027;&#x7684;&#x91CD;&#x8BD5;&#x591A;&#x6B21;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x505A;&#x5230;&#x4E86;Exactly once&#x3002;</p>
<p>&#x63A5;&#x4E0B;&#x6765;&#x8BA8;&#x8BBA;&#x7684;&#x662F;&#x6D88;&#x606F;&#x4ECE;broker&#x5230;Consumer&#x7684;delivery guarantee&#x8BED;&#x4E49;&#x3002;&#xFF08;&#x4EC5;&#x9488;&#x5BF9;Kafka consumer high level API&#xFF09;&#x3002;Consumer&#x5728;&#x4ECE;broker&#x8BFB;&#x53D6;&#x6D88;&#x606F;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x9009;&#x62E9;commit&#xFF0C;&#x8BE5;&#x64CD;&#x4F5C;&#x4F1A;&#x5728;Zookeeper&#x4E2D;&#x4FDD;&#x5B58;&#x8BE5;Consumer&#x5728;&#x8BE5;Partition&#x4E2D;&#x8BFB;&#x53D6;&#x7684;&#x6D88;&#x606F;&#x7684;offset&#x3002;&#x8BE5;Consumer&#x4E0B;&#x4E00;&#x6B21;&#x518D;&#x8BFB;&#x8BE5;Partition&#x65F6;&#x4F1A;&#x4ECE;&#x4E0B;&#x4E00;&#x6761;&#x5F00;&#x59CB;&#x8BFB;&#x53D6;&#x3002;&#x5982;&#x672A;commit&#xFF0C;&#x4E0B;&#x4E00;&#x6B21;&#x8BFB;&#x53D6;&#x7684;&#x5F00;&#x59CB;&#x4F4D;&#x7F6E;&#x4F1A;&#x8DDF;&#x4E0A;&#x4E00;&#x6B21;commit&#x4E4B;&#x540E;&#x7684;&#x5F00;&#x59CB;&#x4F4D;&#x7F6E;&#x76F8;&#x540C;&#x3002;&#x5F53;&#x7136;&#x53EF;&#x4EE5;&#x5C06;Consumer&#x8BBE;&#x7F6E;&#x4E3A;autocommit&#xFF0C;&#x5373;Consumer&#x4E00;&#x65E6;&#x8BFB;&#x5230;&#x6570;&#x636E;&#x7ACB;&#x5373;&#x81EA;&#x52A8;commit&#x3002;&#x5982;&#x679C;&#x53EA;&#x8BA8;&#x8BBA;&#x8FD9;&#x4E00;&#x8BFB;&#x53D6;&#x6D88;&#x606F;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x90A3;Kafka&#x662F;&#x786E;&#x4FDD;&#x4E86;Exactly once&#x3002;&#x4F46;&#x5B9E;&#x9645;&#x4F7F;&#x7528;&#x4E2D;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5E76;&#x975E;&#x5728;Consumer&#x8BFB;&#x53D6;&#x5B8C;&#x6570;&#x636E;&#x5C31;&#x7ED3;&#x675F;&#x4E86;&#xFF0C;&#x800C;&#x662F;&#x8981;&#x8FDB;&#x884C;&#x8FDB;&#x4E00;&#x6B65;&#x5904;&#x7406;&#xFF0C;&#x800C;&#x6570;&#x636E;&#x5904;&#x7406;&#x4E0E;commit&#x7684;&#x987A;&#x5E8F;&#x5728;&#x5F88;&#x5927;&#x7A0B;&#x5EA6;&#x4E0A;&#x51B3;&#x5B9A;&#x4E86;&#x6D88;&#x606F;&#x4ECE;broker&#x548C;consumer&#x7684;delivery guarantee semantic&#x3002;</p>
<p><strong>Kafka&#x9ED8;&#x8BA4;&#x4FDD;&#x8BC1;At least once</strong>&#xFF0C;&#x5E76;&#x4E14;&#x5141;&#x8BB8;&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;Producer&#x5F02;&#x6B65;&#x63D0;&#x4EA4;&#x6765;&#x5B9E;&#x73B0;At most once&#x3002;&#x800C;Exactly once&#x8981;&#x6C42;&#x4E0E;&#x5916;&#x90E8;&#x5B58;&#x50A8;&#x7CFB;&#x7EDF;&#x534F;&#x4F5C;&#xFF0C;&#x5E78;&#x8FD0;&#x7684;&#x662F;Kafka&#x63D0;&#x4F9B;&#x7684;offset&#x53EF;&#x4EE5;&#x975E;&#x5E38;&#x76F4;&#x63A5;&#x975E;&#x5E38;&#x5BB9;&#x6613;&#x5F97;&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x3002;</p>
<h2 class="mume-header" id="%E5%8F%82%E8%80%83-1" ebook-toc-level-2 heading="&amp;#x53C2;&amp;#x8003;">&#x53C2;&#x8003;</h2>

<p><a href="https://www.cnblogs.com/qingyunzong/p/9004593.html">https://www.cnblogs.com/qingyunzong/p/9004593.html</a></p>
<h1 class="mume-header" id="kafka%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8" ebook-toc-level-1 heading="kafka&amp;#x7684;&amp;#x9AD8;&amp;#x53EF;&amp;#x7528;">kafka&#x7684;&#x9AD8;&#x53EF;&#x7528;</h1>

<h2 class="mume-header" id="%E4%B8%80-%E9%AB%98%E5%8F%AF%E7%94%A8%E7%9A%84%E7%94%B1%E6%9D%A5" ebook-toc-level-2 heading="&amp;#x4E00;&amp;#x3001;&amp;#x9AD8;&amp;#x53EF;&amp;#x7528;&amp;#x7684;&amp;#x7531;&amp;#x6765;">&#x4E00;&#x3001;&#x9AD8;&#x53EF;&#x7528;&#x7684;&#x7531;&#x6765;</h2>

<h3 class="mume-header" id="11-%E4%B8%BA%E4%BD%95%E9%9C%80%E8%A6%81replication" ebook-toc-level-3 heading="1.1&amp;#x3000;&amp;#x4E3A;&amp;#x4F55;&amp;#x9700;&amp;#x8981;Replication">1.1&#x3000;&#x4E3A;&#x4F55;&#x9700;&#x8981;Replication</h3>

<p>&#x5728;Kafka&#x5728;0.8&#x4EE5;&#x524D;&#x7684;&#x7248;&#x672C;&#x4E2D;&#xFF0C;&#x662F;&#x6CA1;&#x6709;Replication&#x7684;&#xFF0C;&#x4E00;&#x65E6;&#x67D0;&#x4E00;&#x4E2A;Broker&#x5B95;&#x673A;&#xFF0C;&#x5219;&#x5176;&#x4E0A;&#x6240;&#x6709;&#x7684;Partition&#x6570;&#x636E;&#x90FD;&#x4E0D;&#x53EF;&#x88AB;&#x6D88;&#x8D39;&#xFF0C;&#x8FD9;&#x4E0E;Kafka&#x6570;&#x636E;&#x6301;&#x4E45;&#x6027;&#x53CA;Delivery Guarantee&#x7684;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;&#x76F8;&#x6096;&#x3002;&#x540C;&#x65F6;Producer&#x90FD;&#x4E0D;&#x80FD;&#x518D;&#x5C06;&#x6570;&#x636E;&#x5B58;&#x4E8E;&#x8FD9;&#x4E9B;Partition&#x4E2D;&#x3002;</p>
<p>&#x5982;&#x679C;Producer&#x4F7F;&#x7528;&#x540C;&#x6B65;&#x6A21;&#x5F0F;&#x5219;Producer&#x4F1A;&#x5728;&#x5C1D;&#x8BD5;&#x91CD;&#x65B0;&#x53D1;&#x9001;message.send.max.retries&#xFF08;&#x9ED8;&#x8BA4;&#x503C;&#x4E3A;3&#xFF09;&#x6B21;&#x540E;&#x629B;&#x51FA;Exception&#xFF0C;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x505C;&#x6B62;&#x53D1;&#x9001;&#x540E;&#x7EED;&#x6570;&#x636E;&#x4E5F;&#x53EF;&#x9009;&#x62E9;&#x7EE7;&#x7EED;&#x9009;&#x62E9;&#x53D1;&#x9001;&#x3002;&#x800C;&#x524D;&#x8005;&#x4F1A;&#x9020;&#x6210;&#x6570;&#x636E;&#x7684;&#x963B;&#x585E;&#xFF0C;&#x540E;&#x8005;&#x4F1A;&#x9020;&#x6210;&#x672C;&#x5E94;&#x53D1;&#x5F80;&#x8BE5;Broker&#x7684;&#x6570;&#x636E;&#x7684;&#x4E22;&#x5931;&#x3002;</p>
<p>&#x5982;&#x679C;Producer&#x4F7F;&#x7528;&#x5F02;&#x6B65;&#x6A21;&#x5F0F;&#xFF0C;&#x5219;Producer&#x4F1A;&#x5C1D;&#x8BD5;&#x91CD;&#x65B0;&#x53D1;&#x9001;message.send.max.retries&#xFF08;&#x9ED8;&#x8BA4;&#x503C;&#x4E3A;3&#xFF09;&#x6B21;&#x540E;&#x8BB0;&#x5F55;&#x8BE5;&#x5F02;&#x5E38;&#x5E76;&#x7EE7;&#x7EED;&#x53D1;&#x9001;&#x540E;&#x7EED;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x4F1A;&#x9020;&#x6210;&#x6570;&#x636E;&#x4E22;&#x5931;&#x5E76;&#x4E14;&#x7528;&#x6237;&#x53EA;&#x80FD;&#x901A;&#x8FC7;&#x65E5;&#x5FD7;&#x53D1;&#x73B0;&#x8BE5;&#x95EE;&#x9898;&#x3002;&#x540C;&#x65F6;&#xFF0C;Kafka&#x7684;Producer&#x5E76;&#x672A;&#x5BF9;&#x5F02;&#x6B65;&#x6A21;&#x5F0F;&#x63D0;&#x4F9B;callback&#x63A5;&#x53E3;&#x3002;</p>
<p>&#x7531;&#x6B64;&#x53EF;&#x89C1;&#xFF0C;&#x5728;&#x6CA1;&#x6709;Replication&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E00;&#x65E6;&#x67D0;&#x673A;&#x5668;&#x5B95;&#x673A;&#x6216;&#x8005;&#x67D0;&#x4E2A;Broker&#x505C;&#x6B62;&#x5DE5;&#x4F5C;&#x5219;&#x4F1A;&#x9020;&#x6210;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#x7684;&#x53EF;&#x7528;&#x6027;&#x964D;&#x4F4E;&#x3002;&#x968F;&#x7740;&#x96C6;&#x7FA4;&#x89C4;&#x6A21;&#x7684;&#x589E;&#x52A0;&#xFF0C;&#x6574;&#x4E2A;&#x96C6;&#x7FA4;&#x4E2D;&#x51FA;&#x73B0;&#x8BE5;&#x7C7B;&#x5F02;&#x5E38;&#x7684;&#x51E0;&#x7387;&#x5927;&#x5927;&#x589E;&#x52A0;&#xFF0C;&#x56E0;&#x6B64;&#x5BF9;&#x4E8E;&#x751F;&#x4EA7;&#x7CFB;&#x7EDF;&#x800C;&#x8A00;Replication&#x673A;&#x5236;&#x7684;&#x5F15;&#x5165;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x3002;</p>
<h3 class="mume-header" id="12-leader-election" ebook-toc-level-3 heading="1.2&amp;#x3000;Leader Election">1.2&#x3000;Leader Election</h3>

<p>&#x5F15;&#x5165;Replication&#x4E4B;&#x540E;&#xFF0C;&#x540C;&#x4E00;&#x4E2A;Partition&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x591A;&#x4E2A;Replica&#xFF0C;&#x800C;&#x8FD9;&#x65F6;&#x9700;&#x8981;&#x5728;&#x8FD9;&#x4E9B;Replication&#x4E4B;&#x95F4;&#x9009;&#x51FA;&#x4E00;&#x4E2A;Leader&#xFF0C;Producer&#x548C;Consumer&#x53EA;&#x4E0E;&#x8FD9;&#x4E2A;Leader&#x4EA4;&#x4E92;&#xFF0C;&#x5176;&#x5B83;Replica&#x4F5C;&#x4E3A;Follower&#x4ECE;Leader&#x4E2D;&#x590D;&#x5236;&#x6570;&#x636E;&#x3002;</p>
<p>&#x56E0;&#x4E3A;&#x9700;&#x8981;&#x4FDD;&#x8BC1;&#x540C;&#x4E00;&#x4E2A;Partition&#x7684;&#x591A;&#x4E2A;Replica&#x4E4B;&#x95F4;&#x7684;&#x6570;&#x636E;&#x4E00;&#x81F4;&#x6027;&#xFF08;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x5B95;&#x673A;&#x540E;&#x5176;&#x5B83;Replica&#x5FC5;&#x987B;&#x8981;&#x80FD;&#x7EE7;&#x7EED;&#x670D;&#x52A1;&#x5E76;&#x4E14;&#x5373;&#x4E0D;&#x80FD;&#x9020;&#x6210;&#x6570;&#x636E;&#x91CD;&#x590D;&#x4E5F;&#x4E0D;&#x80FD;&#x9020;&#x6210;&#x6570;&#x636E;&#x4E22;&#x5931;&#xFF09;&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x4E00;&#x4E2A;Leader&#xFF0C;&#x6240;&#x6709;Replica&#x90FD;&#x53EF;&#x540C;&#x65F6;&#x8BFB;/&#x5199;&#x6570;&#x636E;&#xFF0C;&#x90A3;&#x5C31;&#x9700;&#x8981;&#x4FDD;&#x8BC1;&#x591A;&#x4E2A;Replica&#x4E4B;&#x95F4;&#x4E92;&#x76F8;&#xFF08;N&#xD7;N&#x6761;&#x901A;&#x8DEF;&#xFF09;&#x540C;&#x6B65;&#x6570;&#x636E;&#xFF0C;&#x6570;&#x636E;&#x7684;&#x4E00;&#x81F4;&#x6027;&#x548C;&#x6709;&#x5E8F;&#x6027;&#x975E;&#x5E38;&#x96BE;&#x4FDD;&#x8BC1;&#xFF0C;&#x5927;&#x5927;&#x589E;&#x52A0;&#x4E86;Replication&#x5B9E;&#x73B0;&#x7684;&#x590D;&#x6742;&#x6027;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x589E;&#x52A0;&#x4E86;&#x51FA;&#x73B0;&#x5F02;&#x5E38;&#x7684;&#x51E0;&#x7387;&#x3002;&#x800C;&#x5F15;&#x5165;Leader&#x540E;&#xFF0C;&#x53EA;&#x6709;Leader&#x8D1F;&#x8D23;&#x6570;&#x636E;&#x8BFB;&#x5199;&#xFF0C;Follower&#x53EA;&#x5411;Leader&#x987A;&#x5E8F;Fetch&#x6570;&#x636E;&#xFF08;N&#x6761;&#x901A;&#x8DEF;&#xFF09;&#xFF0C;&#x7CFB;&#x7EDF;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x4E14;&#x9AD8;&#x6548;&#x3002;</p>
<h2 class="mume-header" id="%E4%BA%8C-kafka-ha%E8%AE%BE%E8%AE%A1%E8%A7%A3%E6%9E%90" ebook-toc-level-2 heading="&amp;#x4E8C;&amp;#x3001;Kafka HA&amp;#x8BBE;&amp;#x8BA1;&amp;#x89E3;&amp;#x6790;">&#x4E8C;&#x3001;Kafka HA&#x8BBE;&#x8BA1;&#x89E3;&#x6790;</h2>

<h3 class="mume-header" id="21-%E5%A6%82%E4%BD%95%E5%B0%86%E6%89%80%E6%9C%89replica%E5%9D%87%E5%8C%80%E5%88%86%E5%B8%83%E5%88%B0%E6%95%B4%E4%B8%AA%E9%9B%86%E7%BE%A4" ebook-toc-level-3 heading="2.1&amp;#x3000;&amp;#x5982;&amp;#x4F55;&amp;#x5C06;&amp;#x6240;&amp;#x6709;Replica&amp;#x5747;&amp;#x5300;&amp;#x5206;&amp;#x5E03;&amp;#x5230;&amp;#x6574;&amp;#x4E2A;&amp;#x96C6;&amp;#x7FA4;">2.1&#x3000;&#x5982;&#x4F55;&#x5C06;&#x6240;&#x6709;Replica&#x5747;&#x5300;&#x5206;&#x5E03;&#x5230;&#x6574;&#x4E2A;&#x96C6;&#x7FA4;</h3>

<p>&#x4E3A;&#x4E86;&#x66F4;&#x597D;&#x7684;&#x505A;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;Kafka&#x5C3D;&#x91CF;&#x5C06;&#x6240;&#x6709;&#x7684;Partition&#x5747;&#x5300;&#x5206;&#x914D;&#x5230;&#x6574;&#x4E2A;&#x96C6;&#x7FA4;&#x4E0A;&#x3002;&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x7684;&#x90E8;&#x7F72;&#x65B9;&#x5F0F;&#x662F;&#x4E00;&#x4E2A;Topic&#x7684;Partition&#x6570;&#x91CF;&#x5927;&#x4E8E;Broker&#x7684;&#x6570;&#x91CF;&#x3002;&#x540C;&#x65F6;&#x4E3A;&#x4E86;&#x63D0;&#x9AD8;Kafka&#x7684;&#x5BB9;&#x9519;&#x80FD;&#x529B;&#xFF0C;&#x4E5F;&#x9700;&#x8981;&#x5C06;&#x540C;&#x4E00;&#x4E2A;Partition&#x7684;Replica&#x5C3D;&#x91CF;&#x5206;&#x6563;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x673A;&#x5668;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x5982;&#x679C;&#x6240;&#x6709;&#x7684;Replica&#x90FD;&#x5728;&#x540C;&#x4E00;&#x4E2A;Broker&#x4E0A;&#xFF0C;&#x90A3;&#x4E00;&#x65E6;&#x8BE5;Broker&#x5B95;&#x673A;&#xFF0C;&#x8BE5;Partition&#x7684;&#x6240;&#x6709;Replica&#x90FD;&#x65E0;&#x6CD5;&#x5DE5;&#x4F5C;&#xFF0C;&#x4E5F;&#x5C31;&#x8FBE;&#x4E0D;&#x5230;HA&#x7684;&#x6548;&#x679C;&#x3002;&#x540C;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x67D0;&#x4E2A;Broker&#x5B95;&#x673A;&#x4E86;&#xFF0C;&#x9700;&#x8981;&#x4FDD;&#x8BC1;&#x5B83;&#x4E0A;&#x9762;&#x7684;&#x8D1F;&#x8F7D;&#x53EF;&#x4EE5;&#x88AB;&#x5747;&#x5300;&#x7684;&#x5206;&#x914D;&#x5230;&#x5176;&#x5B83;&#x5E78;&#x5B58;&#x7684;&#x6240;&#x6709;Broker&#x4E0A;&#x3002;</p>
<p>Kafka&#x5206;&#x914D;Replica&#x7684;&#x7B97;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;</p>
<p>1.&#x5C06;&#x6240;&#x6709;Broker&#xFF08;&#x5047;&#x8BBE;&#x5171;n&#x4E2A;Broker&#xFF09;&#x548C;&#x5F85;&#x5206;&#x914D;&#x7684;Partition&#x6392;&#x5E8F;</p>
<p>2.&#x5C06;&#x7B2C;i&#x4E2A;Partition&#x5206;&#x914D;&#x5230;&#x7B2C;&#xFF08;i mod n&#xFF09;&#x4E2A;Broker&#x4E0A;</p>
<p>3.&#x5C06;&#x7B2C;i&#x4E2A;Partition&#x7684;&#x7B2C;j&#x4E2A;Replica&#x5206;&#x914D;&#x5230;&#x7B2C;&#xFF08;(i + j) mode n&#xFF09;&#x4E2A;Broker&#x4E0A;</p>
<h3 class="mume-header" id="22-data-replication%E5%89%AF%E6%9C%AC%E7%AD%96%E7%95%A5" ebook-toc-level-3 heading="2.2&amp;#x3000;Data Replication&amp;#xFF08;&amp;#x526F;&amp;#x672C;&amp;#x7B56;&amp;#x7565;&amp;#xFF09;">2.2&#x3000;Data Replication&#xFF08;&#x526F;&#x672C;&#x7B56;&#x7565;&#xFF09;</h3>

<p>Kafka&#x7684;&#x9AD8;&#x53EF;&#x9760;&#x6027;&#x7684;&#x4FDD;&#x969C;&#x6765;&#x6E90;&#x4E8E;&#x5176;&#x5065;&#x58EE;&#x7684;&#x526F;&#x672C;&#xFF08;replication&#xFF09;&#x7B56;&#x7565;&#x3002;</p>
<h4 class="mume-header" id="221-%E6%B6%88%E6%81%AF%E4%BC%A0%E9%80%92%E5%90%8C%E6%AD%A5%E7%AD%96%E7%95%A5" ebook-toc-level-4 heading="2.2.1&amp;#x3000;&amp;#x6D88;&amp;#x606F;&amp;#x4F20;&amp;#x9012;&amp;#x540C;&amp;#x6B65;&amp;#x7B56;&amp;#x7565;">2.2.1&#x3000;&#x6D88;&#x606F;&#x4F20;&#x9012;&#x540C;&#x6B65;&#x7B56;&#x7565;</h4>

<p>Producer&#x5728;&#x53D1;&#x5E03;&#x6D88;&#x606F;&#x5230;&#x67D0;&#x4E2A;Partition&#x65F6;&#xFF0C;&#x5148;&#x901A;&#x8FC7;ZooKeeper&#x627E;&#x5230;&#x8BE5;Partition&#x7684;Leader&#xFF0C;&#x7136;&#x540E;&#x65E0;&#x8BBA;&#x8BE5;Topic&#x7684;Replication Factor&#x4E3A;&#x591A;&#x5C11;&#xFF0C;Producer&#x53EA;&#x5C06;&#x8BE5;&#x6D88;&#x606F;&#x53D1;&#x9001;&#x5230;&#x8BE5;Partition&#x7684;Leader&#x3002;Leader&#x4F1A;&#x5C06;&#x8BE5;&#x6D88;&#x606F;&#x5199;&#x5165;&#x5176;&#x672C;&#x5730;Log&#x3002;&#x6BCF;&#x4E2A;Follower&#x90FD;&#x4ECE;Leader pull&#x6570;&#x636E;&#x3002;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x4E0A;&#xFF0C;Follower&#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;&#x987A;&#x5E8F;&#x4E0E;Leader&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x3002;Follower&#x5728;&#x6536;&#x5230;&#x8BE5;&#x6D88;&#x606F;&#x5E76;&#x5199;&#x5165;&#x5176;Log&#x540E;&#xFF0C;&#x5411;Leader&#x53D1;&#x9001;ACK&#x3002;&#x4E00;&#x65E6;Leader&#x6536;&#x5230;&#x4E86;ISR&#x4E2D;&#x7684;&#x6240;&#x6709;Replica&#x7684;ACK&#xFF0C;&#x8BE5;&#x6D88;&#x606F;&#x5C31;&#x88AB;&#x8BA4;&#x4E3A;&#x5DF2;&#x7ECF;commit&#x4E86;&#xFF0C;Leader&#x5C06;&#x589E;&#x52A0;HW&#x5E76;&#x4E14;&#x5411;Producer&#x53D1;&#x9001;ACK&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#xFF0C;&#x6BCF;&#x4E2A;Follower&#x5728;&#x63A5;&#x6536;&#x5230;&#x6570;&#x636E;&#x540E;&#x5C31;&#x7ACB;&#x9A6C;&#x5411;Leader&#x53D1;&#x9001;ACK&#xFF0C;&#x800C;&#x975E;&#x7B49;&#x5230;&#x6570;&#x636E;&#x5199;&#x5165;Log&#x4E2D;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5BF9;&#x4E8E;&#x5DF2;&#x7ECF;commit&#x7684;&#x6D88;&#x606F;&#xFF0C;Kafka&#x53EA;&#x80FD;&#x4FDD;&#x8BC1;&#x5B83;&#x88AB;&#x5B58;&#x4E8E;&#x591A;&#x4E2A;Replica&#x7684;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x800C;&#x4E0D;&#x80FD;&#x4FDD;&#x8BC1;&#x5B83;&#x4EEC;&#x88AB;&#x6301;&#x4E45;&#x5316;&#x5230;&#x78C1;&#x76D8;&#x4E2D;&#xFF0C;&#x4E5F;&#x5C31;&#x4E0D;&#x80FD;&#x5B8C;&#x5168;&#x4FDD;&#x8BC1;&#x5F02;&#x5E38;&#x53D1;&#x751F;&#x540E;&#x8BE5;&#x6761;&#x6D88;&#x606F;&#x4E00;&#x5B9A;&#x80FD;&#x88AB;Consumer&#x6D88;&#x8D39;&#x3002;</p>
<p>Consumer&#x8BFB;&#x6D88;&#x606F;&#x4E5F;&#x662F;&#x4ECE;Leader&#x8BFB;&#x53D6;&#xFF0C;&#x53EA;&#x6709;&#x88AB;commit&#x8FC7;&#x7684;&#x6D88;&#x606F;&#x624D;&#x4F1A;&#x66B4;&#x9732;&#x7ED9;Consumer&#x3002;</p>
<p>Kafka Replication&#x7684;&#x6570;&#x636E;&#x6D41;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF1A;</p>
<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164101.png" alt="img"></p>
<h4 class="mume-header" id="222-ack%E5%89%8D%E9%9C%80%E8%A6%81%E4%BF%9D%E8%AF%81%E6%9C%89%E5%A4%9A%E5%B0%91%E4%B8%AA%E5%A4%87%E4%BB%BD" ebook-toc-level-4 heading="2.2.2&amp;#x3000;ACK&amp;#x524D;&amp;#x9700;&amp;#x8981;&amp;#x4FDD;&amp;#x8BC1;&amp;#x6709;&amp;#x591A;&amp;#x5C11;&amp;#x4E2A;&amp;#x5907;&amp;#x4EFD;">2.2.2&#x3000;ACK&#x524D;&#x9700;&#x8981;&#x4FDD;&#x8BC1;&#x6709;&#x591A;&#x5C11;&#x4E2A;&#x5907;&#x4EFD;</h4>

<p>&#x5BF9;&#x4E8E;Kafka&#x800C;&#x8A00;&#xFF0C;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;Broker&#x662F;&#x5426;&#x201C;&#x6D3B;&#x7740;&#x201D;&#x5305;&#x542B;&#x4E24;&#x4E2A;&#x6761;&#x4EF6;&#xFF1A;</p>
<ul>
<li>&#x4E00;&#x662F;&#x5B83;&#x5FC5;&#x987B;&#x7EF4;&#x62A4;&#x4E0E;ZooKeeper&#x7684;session&#xFF08;&#x8FD9;&#x4E2A;&#x901A;&#x8FC7;ZooKeeper&#x7684;Heartbeat&#x673A;&#x5236;&#x6765;&#x5B9E;&#x73B0;&#xFF09;&#x3002;</li>
<li>&#x4E8C;&#x662F;Follower&#x5FC5;&#x987B;&#x80FD;&#x591F;&#x53CA;&#x65F6;&#x5C06;Leader&#x7684;&#x6D88;&#x606F;&#x590D;&#x5236;&#x8FC7;&#x6765;&#xFF0C;&#x4E0D;&#x80FD;&#x201C;&#x843D;&#x540E;&#x592A;&#x591A;&#x201D;&#x3002;</li>
</ul>
<p>Leader&#x4F1A;&#x8DDF;&#x8E2A;&#x4E0E;&#x5176;&#x4FDD;&#x6301;&#x540C;&#x6B65;&#x7684;Replica&#x5217;&#x8868;&#xFF0C;&#x8BE5;&#x5217;&#x8868;&#x79F0;&#x4E3A;ISR&#xFF08;&#x5373;in-sync Replica&#xFF09;&#x3002;&#x5982;&#x679C;&#x4E00;&#x4E2A;Follower&#x5B95;&#x673A;&#xFF0C;&#x6216;&#x8005;&#x843D;&#x540E;&#x592A;&#x591A;&#xFF0C;Leader&#x5C06;&#x628A;&#x5B83;&#x4ECE;ISR&#x4E2D;&#x79FB;&#x9664;&#x3002;&#x8FD9;&#x91CC;&#x6240;&#x63CF;&#x8FF0;&#x7684;&#x201C;&#x843D;&#x540E;&#x592A;&#x591A;&#x201D;&#x6307;Follower&#x590D;&#x5236;&#x7684;&#x6D88;&#x606F;&#x843D;&#x540E;&#x4E8E;Leader&#x540E;&#x7684;&#x6761;&#x6570;&#x8D85;&#x8FC7;&#x9884;&#x5B9A;&#x503C;&#xFF08;&#x8BE5;&#x503C;&#x53EF;&#x5728;$KAFKA_HOME/config/server.properties&#x4E2D;&#x901A;&#x8FC7;replica.lag.max.messages&#x914D;&#x7F6E;&#xFF0C;&#x5176;&#x9ED8;&#x8BA4;&#x503C;&#x662F;4000&#xFF09;&#x6216;&#x8005;Follower&#x8D85;&#x8FC7;&#x4E00;&#x5B9A;&#x65F6;&#x95F4;&#xFF08;&#x8BE5;&#x503C;&#x53EF;&#x5728;$KAFKA_HOME/config/server.properties&#x4E2D;&#x901A;&#x8FC7;replica.lag.time.max.ms&#x6765;&#x914D;&#x7F6E;&#xFF0C;&#x5176;&#x9ED8;&#x8BA4;&#x503C;&#x662F;10000&#xFF09;&#x672A;&#x5411;Leader&#x53D1;&#x9001;fetch&#x8BF7;&#x6C42;&#x3002;</p>
<p>Kafka&#x7684;&#x590D;&#x5236;&#x673A;&#x5236;&#x65E2;&#x4E0D;&#x662F;&#x5B8C;&#x5168;&#x7684;&#x540C;&#x6B65;&#x590D;&#x5236;&#xFF0C;&#x4E5F;&#x4E0D;&#x662F;&#x5355;&#x7EAF;&#x7684;&#x5F02;&#x6B65;&#x590D;&#x5236;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x5B8C;&#x5168;&#x540C;&#x6B65;&#x590D;&#x5236;&#x8981;&#x6C42;&#x6240;&#x6709;&#x80FD;&#x5DE5;&#x4F5C;&#x7684;Follower&#x90FD;&#x590D;&#x5236;&#x5B8C;&#xFF0C;&#x8FD9;&#x6761;&#x6D88;&#x606F;&#x624D;&#x4F1A;&#x88AB;&#x8BA4;&#x4E3A;commit&#xFF0C;&#x8FD9;&#x79CD;&#x590D;&#x5236;&#x65B9;&#x5F0F;&#x6781;&#x5927;&#x7684;&#x5F71;&#x54CD;&#x4E86;&#x541E;&#x5410;&#x7387;&#xFF08;&#x9AD8;&#x541E;&#x5410;&#x7387;&#x662F;Kafka&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x4E2A;&#x7279;&#x6027;&#xFF09;&#x3002;&#x800C;&#x5F02;&#x6B65;&#x590D;&#x5236;&#x65B9;&#x5F0F;&#x4E0B;&#xFF0C;Follower&#x5F02;&#x6B65;&#x7684;&#x4ECE;Leader&#x590D;&#x5236;&#x6570;&#x636E;&#xFF0C;&#x6570;&#x636E;&#x53EA;&#x8981;&#x88AB;Leader&#x5199;&#x5165;log&#x5C31;&#x88AB;&#x8BA4;&#x4E3A;&#x5DF2;&#x7ECF;commit&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x5982;&#x679C;Follower&#x90FD;&#x590D;&#x5236;&#x5B8C;&#x90FD;&#x843D;&#x540E;&#x4E8E;Leader&#xFF0C;&#x800C;&#x5982;&#x679C;Leader&#x7A81;&#x7136;&#x5B95;&#x673A;&#xFF0C;&#x5219;&#x4F1A;&#x4E22;&#x5931;&#x6570;&#x636E;&#x3002;&#x800C;Kafka&#x7684;&#x8FD9;&#x79CD;&#x4F7F;&#x7528;ISR&#x7684;&#x65B9;&#x5F0F;&#x5219;&#x5F88;&#x597D;&#x7684;&#x5747;&#x8861;&#x4E86;&#x786E;&#x4FDD;&#x6570;&#x636E;&#x4E0D;&#x4E22;&#x5931;&#x4EE5;&#x53CA;&#x541E;&#x5410;&#x7387;&#x3002;Follower&#x53EF;&#x4EE5;&#x6279;&#x91CF;&#x7684;&#x4ECE;Leader&#x590D;&#x5236;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x6837;&#x6781;&#x5927;&#x7684;&#x63D0;&#x9AD8;&#x590D;&#x5236;&#x6027;&#x80FD;&#xFF08;&#x6279;&#x91CF;&#x5199;&#x78C1;&#x76D8;&#xFF09;&#xFF0C;&#x6781;&#x5927;&#x51CF;&#x5C11;&#x4E86;Follower&#x4E0E;Leader&#x7684;&#x5DEE;&#x8DDD;&#x3002;</p>
<p>&#x9700;&#x8981;&#x8BF4;&#x660E;&#x7684;&#x662F;&#xFF0C;Kafka&#x53EA;&#x89E3;&#x51B3;fail/recover&#xFF0C;&#x4E0D;&#x5904;&#x7406;&#x201C;Byzantine&#x201D;&#xFF08;&#x201C;&#x62DC;&#x5360;&#x5EAD;&#x201D;&#xFF09;&#x95EE;&#x9898;&#x3002;&#x4E00;&#x6761;&#x6D88;&#x606F;&#x53EA;&#x6709;&#x88AB;ISR&#x91CC;&#x7684;&#x6240;&#x6709;Follower&#x90FD;&#x4ECE;Leader&#x590D;&#x5236;&#x8FC7;&#x53BB;&#x624D;&#x4F1A;&#x88AB;&#x8BA4;&#x4E3A;&#x5DF2;&#x63D0;&#x4EA4;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x907F;&#x514D;&#x4E86;&#x90E8;&#x5206;&#x6570;&#x636E;&#x88AB;&#x5199;&#x8FDB;&#x4E86;Leader&#xFF0C;&#x8FD8;&#x6CA1;&#x6765;&#x5F97;&#x53CA;&#x88AB;&#x4EFB;&#x4F55;Follower&#x590D;&#x5236;&#x5C31;&#x5B95;&#x673A;&#x4E86;&#xFF0C;&#x800C;&#x9020;&#x6210;&#x6570;&#x636E;&#x4E22;&#x5931;&#xFF08;Consumer&#x65E0;&#x6CD5;&#x6D88;&#x8D39;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#xFF09;&#x3002;&#x800C;&#x5BF9;&#x4E8E;Producer&#x800C;&#x8A00;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x662F;&#x5426;&#x7B49;&#x5F85;&#x6D88;&#x606F;commit&#xFF0C;&#x8FD9;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;request.required.acks&#x6765;&#x8BBE;&#x7F6E;&#x3002;&#x8FD9;&#x79CD;&#x673A;&#x5236;&#x786E;&#x4FDD;&#x4E86;&#x53EA;&#x8981;ISR&#x6709;&#x4E00;&#x4E2A;&#x6216;&#x4EE5;&#x4E0A;&#x7684;Follower&#xFF0C;&#x4E00;&#x6761;&#x88AB;commit&#x7684;&#x6D88;&#x606F;&#x5C31;&#x4E0D;&#x4F1A;&#x4E22;&#x5931;&#x3002;</p>
<h4 class="mume-header" id="223-leader-election%E7%AE%97%E6%B3%95" ebook-toc-level-4 heading="2.2.3&amp;#x3000;Leader Election&amp;#x7B97;&amp;#x6CD5;">2.2.3&#x3000;Leader Election&#x7B97;&#x6CD5;</h4>

<p>Leader&#x9009;&#x4E3E;&#x672C;&#x8D28;&#x4E0A;&#x662F;&#x4E00;&#x4E2A;&#x5206;&#x5E03;&#x5F0F;&#x9501;&#xFF0C;&#x6709;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;&#x57FA;&#x4E8E;ZooKeeper&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x9501;&#xFF1A;</p>
<ul>
<li>&#x8282;&#x70B9;&#x540D;&#x79F0;&#x552F;&#x4E00;&#x6027;&#xFF1A;&#x591A;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x53EA;&#x6709;&#x6210;&#x529F;&#x521B;&#x5EFA;&#x8282;&#x70B9;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x624D;&#x80FD;&#x83B7;&#x5F97;&#x9501;</li>
<li>&#x4E34;&#x65F6;&#x987A;&#x5E8F;&#x8282;&#x70B9;&#xFF1A;&#x6240;&#x6709;&#x5BA2;&#x6237;&#x7AEF;&#x5728;&#x67D0;&#x4E2A;&#x76EE;&#x5F55;&#x4E0B;&#x521B;&#x5EFA;&#x81EA;&#x5DF1;&#x7684;&#x4E34;&#x65F6;&#x987A;&#x5E8F;&#x8282;&#x70B9;&#xFF0C;&#x53EA;&#x6709;&#x5E8F;&#x53F7;&#x6700;&#x5C0F;&#x7684;&#x624D;&#x83B7;&#x5F97;&#x9501;</li>
</ul>
<p>&#x4E00;&#x79CD;&#x975E;&#x5E38;&#x5E38;&#x7528;&#x7684;&#x9009;&#x4E3E;leader&#x7684;&#x65B9;&#x5F0F;&#x662F;&#x201C;Majority Vote&#x201D;&#xFF08;&#x201C;&#x5C11;&#x6570;&#x670D;&#x4ECE;&#x591A;&#x6570;&#x201D;&#xFF09;&#xFF0C;&#x4F46;Kafka&#x5E76;&#x672A;&#x91C7;&#x7528;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x3002;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6709;2f+1&#x4E2A;Replica&#xFF08;&#x5305;&#x542B;Leader&#x548C;Follower&#xFF09;&#xFF0C;&#x90A3;&#x5728;commit&#x4E4B;&#x524D;&#x5FC5;&#x987B;&#x4FDD;&#x8BC1;&#x6709;f+1&#x4E2A;Replica&#x590D;&#x5236;&#x5B8C;&#x6D88;&#x606F;&#xFF0C;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x6B63;&#x786E;&#x9009;&#x51FA;&#x65B0;&#x7684;Leader&#xFF0C;fail&#x7684;Replica&#x4E0D;&#x80FD;&#x8D85;&#x8FC7;f&#x4E2A;&#x3002;&#x56E0;&#x4E3A;&#x5728;&#x5269;&#x4E0B;&#x7684;&#x4EFB;&#x610F;f+1&#x4E2A;Replica&#x91CC;&#xFF0C;&#x81F3;&#x5C11;&#x6709;&#x4E00;&#x4E2A;Replica&#x5305;&#x542B;&#x6709;&#x6700;&#x65B0;&#x7684;&#x6240;&#x6709;&#x6D88;&#x606F;&#x3002;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x6709;&#x4E2A;&#x5F88;&#x5927;&#x7684;&#x4F18;&#x52BF;&#xFF0C;&#x7CFB;&#x7EDF;&#x7684;latency&#x53EA;&#x53D6;&#x51B3;&#x4E8E;&#x6700;&#x5FEB;&#x7684;&#x51E0;&#x4E2A;Broker&#xFF0C;&#x800C;&#x975E;&#x6700;&#x6162;&#x90A3;&#x4E2A;&#x3002;Majority Vote&#x4E5F;&#x6709;&#x4E00;&#x4E9B;&#x52A3;&#x52BF;&#xFF0C;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;Leader Election&#x7684;&#x6B63;&#x5E38;&#x8FDB;&#x884C;&#xFF0C;&#x5B83;&#x6240;&#x80FD;&#x5BB9;&#x5FCD;&#x7684;fail&#x7684;follower&#x4E2A;&#x6570;&#x6BD4;&#x8F83;&#x5C11;&#x3002;&#x5982;&#x679C;&#x8981;&#x5BB9;&#x5FCD;1&#x4E2A;follower&#x6302;&#x6389;&#xFF0C;&#x5FC5;&#x987B;&#x8981;&#x6709;3&#x4E2A;&#x4EE5;&#x4E0A;&#x7684;Replica&#xFF0C;&#x5982;&#x679C;&#x8981;&#x5BB9;&#x5FCD;2&#x4E2A;Follower&#x6302;&#x6389;&#xFF0C;&#x5FC5;&#x987B;&#x8981;&#x6709;5&#x4E2A;&#x4EE5;&#x4E0A;&#x7684;Replica&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0B;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x8F83;&#x9AD8;&#x7684;&#x5BB9;&#x9519;&#x7A0B;&#x5EA6;&#xFF0C;&#x5FC5;&#x987B;&#x8981;&#x6709;&#x5927;&#x91CF;&#x7684;Replica&#xFF0C;&#x800C;&#x5927;&#x91CF;&#x7684;Replica&#x53C8;&#x4F1A;&#x5728;&#x5927;&#x6570;&#x636E;&#x91CF;&#x4E0B;&#x5BFC;&#x81F4;&#x6027;&#x80FD;&#x7684;&#x6025;&#x5267;&#x4E0B;&#x964D;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x8FD9;&#x79CD;&#x7B97;&#x6CD5;&#x66F4;&#x591A;&#x7528;&#x5728;ZooKeeper&#x8FD9;&#x79CD;&#x5171;&#x4EAB;&#x96C6;&#x7FA4;&#x914D;&#x7F6E;&#x7684;&#x7CFB;&#x7EDF;&#x4E2D;&#x800C;&#x5F88;&#x5C11;&#x5728;&#x9700;&#x8981;&#x5B58;&#x50A8;&#x5927;&#x91CF;&#x6570;&#x636E;&#x7684;&#x7CFB;&#x7EDF;&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x539F;&#x56E0;&#x3002;&#x4F8B;&#x5982;HDFS&#x7684;HA Feature&#x662F;&#x57FA;&#x4E8E;majority-vote-based journal&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x7684;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x5E76;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x3002;</p>
<p>Kafka&#x5728;ZooKeeper&#x4E2D;&#x52A8;&#x6001;&#x7EF4;&#x62A4;&#x4E86;&#x4E00;&#x4E2A;ISR&#xFF08;in-sync replicas&#xFF09;&#xFF0C;&#x8FD9;&#x4E2A;ISR&#x91CC;&#x7684;&#x6240;&#x6709;Replica&#x90FD;&#x8DDF;&#x4E0A;&#x4E86;leader&#xFF0C;&#x53EA;&#x6709;ISR&#x91CC;&#x7684;&#x6210;&#x5458;&#x624D;&#x6709;&#x88AB;&#x9009;&#x4E3A;Leader&#x7684;&#x53EF;&#x80FD;&#x3002;&#x5728;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;&#x5BF9;&#x4E8E;f+1&#x4E2A;Replica&#xFF0C;&#x4E00;&#x4E2A;Partition&#x80FD;&#x5728;&#x4FDD;&#x8BC1;&#x4E0D;&#x4E22;&#x5931;&#x5DF2;&#x7ECF;commit&#x7684;&#x6D88;&#x606F;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#x5BB9;&#x5FCD;f&#x4E2A;Replica&#x7684;&#x5931;&#x8D25;&#x3002;&#x5728;&#x5927;&#x591A;&#x6570;&#x4F7F;&#x7528;&#x573A;&#x666F;&#x4E2D;&#xFF0C;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x662F;&#x975E;&#x5E38;&#x6709;&#x5229;&#x7684;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x4E3A;&#x4E86;&#x5BB9;&#x5FCD;f&#x4E2A;Replica&#x7684;&#x5931;&#x8D25;&#xFF0C;Majority Vote&#x548C;ISR&#x5728;commit&#x524D;&#x9700;&#x8981;&#x7B49;&#x5F85;&#x7684;Replica&#x6570;&#x91CF;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x4F46;&#x662F;ISR&#x9700;&#x8981;&#x7684;&#x603B;&#x7684;Replica&#x7684;&#x4E2A;&#x6570;&#x51E0;&#x4E4E;&#x662F;Majority Vote&#x7684;&#x4E00;&#x534A;&#x3002;</p>
<p>&#x867D;&#x7136;Majority Vote&#x4E0E;ISR&#x76F8;&#x6BD4;&#x6709;&#x4E0D;&#x9700;&#x7B49;&#x5F85;&#x6700;&#x6162;&#x7684;Broker&#x8FD9;&#x4E00;&#x4F18;&#x52BF;&#xFF0C;&#x4F46;&#x662F;Kafka&#x4F5C;&#x8005;&#x8BA4;&#x4E3A;Kafka&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Producer&#x9009;&#x62E9;&#x662F;&#x5426;&#x88AB;commit&#x963B;&#x585E;&#x6765;&#x6539;&#x5584;&#x8FD9;&#x4E00;&#x95EE;&#x9898;&#xFF0C;&#x5E76;&#x4E14;&#x8282;&#x7701;&#x4E0B;&#x6765;&#x7684;Replica&#x548C;&#x78C1;&#x76D8;&#x4F7F;&#x5F97;ISR&#x6A21;&#x5F0F;&#x4ECD;&#x7136;&#x503C;&#x5F97;&#x3002;</p>
<h4 class="mume-header" id="224-%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E6%89%80%E6%9C%89replica%E9%83%BD%E4%B8%8D%E5%B7%A5%E4%BD%9C" ebook-toc-level-4 heading="2.2.4&amp;#x3000;&amp;#x5982;&amp;#x4F55;&amp;#x5904;&amp;#x7406;&amp;#x6240;&amp;#x6709;Replica&amp;#x90FD;&amp;#x4E0D;&amp;#x5DE5;&amp;#x4F5C;">2.2.4&#x3000;&#x5982;&#x4F55;&#x5904;&#x7406;&#x6240;&#x6709;Replica&#x90FD;&#x4E0D;&#x5DE5;&#x4F5C;</h4>

<p>&#x5728;ISR&#x4E2D;&#x81F3;&#x5C11;&#x6709;&#x4E00;&#x4E2A;follower&#x65F6;&#xFF0C;Kafka&#x53EF;&#x4EE5;&#x786E;&#x4FDD;&#x5DF2;&#x7ECF;commit&#x7684;&#x6570;&#x636E;&#x4E0D;&#x4E22;&#x5931;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x67D0;&#x4E2A;Partition&#x7684;&#x6240;&#x6709;Replica&#x90FD;&#x5B95;&#x673A;&#x4E86;&#xFF0C;&#x5C31;&#x65E0;&#x6CD5;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x4E0D;&#x4E22;&#x5931;&#x4E86;&#x3002;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x6709;&#x4E24;&#x79CD;&#x53EF;&#x884C;&#x7684;&#x65B9;&#x6848;&#xFF1A;</p>
<p>1.&#x7B49;&#x5F85;ISR&#x4E2D;&#x7684;&#x4EFB;&#x4E00;&#x4E2A;Replica&#x201C;&#x6D3B;&#x201D;&#x8FC7;&#x6765;&#xFF0C;&#x5E76;&#x4E14;&#x9009;&#x5B83;&#x4F5C;&#x4E3A;Leader</p>
<p>2.&#x9009;&#x62E9;&#x7B2C;&#x4E00;&#x4E2A;&#x201C;&#x6D3B;&#x201D;&#x8FC7;&#x6765;&#x7684;Replica&#xFF08;&#x4E0D;&#x4E00;&#x5B9A;&#x662F;ISR&#x4E2D;&#x7684;&#xFF09;&#x4F5C;&#x4E3A;Leader</p>
<p>&#x8FD9;&#x5C31;&#x9700;&#x8981;&#x5728;&#x53EF;&#x7528;&#x6027;&#x548C;&#x4E00;&#x81F4;&#x6027;&#x5F53;&#x4E2D;&#x4F5C;&#x51FA;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x6298;&#x8877;&#x3002;&#x5982;&#x679C;&#x4E00;&#x5B9A;&#x8981;&#x7B49;&#x5F85;ISR&#x4E2D;&#x7684;Replica&#x201C;&#x6D3B;&#x201D;&#x8FC7;&#x6765;&#xFF0C;&#x90A3;&#x4E0D;&#x53EF;&#x7528;&#x7684;&#x65F6;&#x95F4;&#x5C31;&#x53EF;&#x80FD;&#x4F1A;&#x76F8;&#x5BF9;&#x8F83;&#x957F;&#x3002;&#x800C;&#x4E14;&#x5982;&#x679C;ISR&#x4E2D;&#x7684;&#x6240;&#x6709;Replica&#x90FD;&#x65E0;&#x6CD5;&#x201C;&#x6D3B;&#x201D;&#x8FC7;&#x6765;&#x4E86;&#xFF0C;&#x6216;&#x8005;&#x6570;&#x636E;&#x90FD;&#x4E22;&#x5931;&#x4E86;&#xFF0C;&#x8FD9;&#x4E2A;Partition&#x5C06;&#x6C38;&#x8FDC;&#x4E0D;&#x53EF;&#x7528;&#x3002;&#x9009;&#x62E9;&#x7B2C;&#x4E00;&#x4E2A;&#x201C;&#x6D3B;&#x201D;&#x8FC7;&#x6765;&#x7684;Replica&#x4F5C;&#x4E3A;Leader&#xFF0C;&#x800C;&#x8FD9;&#x4E2A;Replica&#x4E0D;&#x662F;ISR&#x4E2D;&#x7684;Replica&#xFF0C;&#x90A3;&#x5373;&#x4F7F;&#x5B83;&#x5E76;&#x4E0D;&#x4FDD;&#x8BC1;&#x5DF2;&#x7ECF;&#x5305;&#x542B;&#x4E86;&#x6240;&#x6709;&#x5DF2;commit&#x7684;&#x6D88;&#x606F;&#xFF0C;&#x5B83;&#x4E5F;&#x4F1A;&#x6210;&#x4E3A;Leader&#x800C;&#x4F5C;&#x4E3A;consumer&#x7684;&#x6570;&#x636E;&#x6E90;&#xFF08;&#x524D;&#x6587;&#x6709;&#x8BF4;&#x660E;&#xFF0C;&#x6240;&#x6709;&#x8BFB;&#x5199;&#x90FD;&#x7531;Leader&#x5B8C;&#x6210;&#xFF09;&#x3002;Kafka0.8.*&#x4F7F;&#x7528;&#x4E86;&#x7B2C;&#x4E8C;&#x79CD;&#x65B9;&#x5F0F;&#x3002;&#x6839;&#x636E;Kafka&#x7684;&#x6587;&#x6863;&#xFF0C;&#x5728;&#x4EE5;&#x540E;&#x7684;&#x7248;&#x672C;&#x4E2D;&#xFF0C;Kafka&#x652F;&#x6301;&#x7528;&#x6237;&#x901A;&#x8FC7;&#x914D;&#x7F6E;&#x9009;&#x62E9;&#x8FD9;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x4E2D;&#x7684;&#x4E00;&#x79CD;&#xFF0C;&#x4ECE;&#x800C;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F;&#x9009;&#x62E9;&#x9AD8;&#x53EF;&#x7528;&#x6027;&#x8FD8;&#x662F;&#x5F3A;&#x4E00;&#x81F4;&#x6027;&#x3002;</p>
<h4 class="mume-header" id="225-%E9%80%89%E4%B8%BEleader" ebook-toc-level-4 heading="2.2.5&amp;#x3000;&amp;#x9009;&amp;#x4E3E;Leader">2.2.5&#x3000;&#x9009;&#x4E3E;Leader</h4>

<p>&#x6700;&#x7B80;&#x5355;&#x6700;&#x76F4;&#x89C2;&#x7684;&#x65B9;&#x6848;&#x662F;&#xFF0C;&#x6240;&#x6709;Follower&#x90FD;&#x5728;ZooKeeper&#x4E0A;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;Watch&#xFF0C;&#x4E00;&#x65E6;Leader&#x5B95;&#x673A;&#xFF0C;&#x5176;&#x5BF9;&#x5E94;&#x7684;ephemeral znode&#x4F1A;&#x81EA;&#x52A8;&#x5220;&#x9664;&#xFF0C;&#x6B64;&#x65F6;&#x6240;&#x6709;Follower&#x90FD;&#x5C1D;&#x8BD5;&#x521B;&#x5EFA;&#x8BE5;&#x8282;&#x70B9;&#xFF0C;&#x800C;&#x521B;&#x5EFA;&#x6210;&#x529F;&#x8005;&#xFF08;ZooKeeper&#x4FDD;&#x8BC1;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x80FD;&#x521B;&#x5EFA;&#x6210;&#x529F;&#xFF09;&#x5373;&#x662F;&#x65B0;&#x7684;Leader&#xFF0C;&#x5176;&#x5B83;Replica&#x5373;&#x4E3A;Follower&#x3002;</p>
<p>&#x4F46;&#x662F;&#x8BE5;&#x65B9;&#x6CD5;&#x4F1A;&#x6709;3&#x4E2A;&#x95EE;&#x9898;&#xFF1A;</p>
<p>1.split-brain &#x8FD9;&#x662F;&#x7531;ZooKeeper&#x7684;&#x7279;&#x6027;&#x5F15;&#x8D77;&#x7684;&#xFF0C;&#x867D;&#x7136;ZooKeeper&#x80FD;&#x4FDD;&#x8BC1;&#x6240;&#x6709;Watch&#x6309;&#x987A;&#x5E8F;&#x89E6;&#x53D1;&#xFF0C;&#x4F46;&#x5E76;&#x4E0D;&#x80FD;&#x4FDD;&#x8BC1;&#x540C;&#x4E00;&#x65F6;&#x523B;&#x6240;&#x6709;Replica&#x201C;&#x770B;&#x201D;&#x5230;&#x7684;&#x72B6;&#x6001;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x8FD9;&#x5C31;&#x53EF;&#x80FD;&#x9020;&#x6210;&#x4E0D;&#x540C;Replica&#x7684;&#x54CD;&#x5E94;&#x4E0D;&#x4E00;&#x81F4;</p>
<p>2.herd effect &#x5982;&#x679C;&#x5B95;&#x673A;&#x7684;&#x90A3;&#x4E2A;Broker&#x4E0A;&#x7684;Partition&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x4F1A;&#x9020;&#x6210;&#x591A;&#x4E2A;Watch&#x88AB;&#x89E6;&#x53D1;&#xFF0C;&#x9020;&#x6210;&#x96C6;&#x7FA4;&#x5185;&#x5927;&#x91CF;&#x7684;&#x8C03;&#x6574;</p>
<p>3.ZooKeeper&#x8D1F;&#x8F7D;&#x8FC7;&#x91CD; &#x6BCF;&#x4E2A;Replica&#x90FD;&#x8981;&#x4E3A;&#x6B64;&#x5728;ZooKeeper&#x4E0A;&#x6CE8;&#x518C;&#x4E00;&#x4E2A;Watch&#xFF0C;&#x5F53;&#x96C6;&#x7FA4;&#x89C4;&#x6A21;&#x589E;&#x52A0;&#x5230;&#x51E0;&#x5343;&#x4E2A;Partition&#x65F6;ZooKeeper&#x8D1F;&#x8F7D;&#x4F1A;&#x8FC7;&#x91CD;&#x3002;</p>
<p>Kafka 0.8.*&#x7684;Leader Election&#x65B9;&#x6848;&#x89E3;&#x51B3;&#x4E86;&#x4E0A;&#x8FF0;&#x95EE;&#x9898;&#xFF0C;&#x5B83;&#x5728;&#x6240;&#x6709;broker&#x4E2D;&#x9009;&#x51FA;&#x4E00;&#x4E2A;controller&#xFF0C;&#x6240;&#x6709;Partition&#x7684;Leader&#x9009;&#x4E3E;&#x90FD;&#x7531;controller&#x51B3;&#x5B9A;&#x3002;controller&#x4F1A;&#x5C06;Leader&#x7684;&#x6539;&#x53D8;&#x76F4;&#x63A5;&#x901A;&#x8FC7;RPC&#x7684;&#x65B9;&#x5F0F;&#xFF08;&#x6BD4;ZooKeeper Queue&#x7684;&#x65B9;&#x5F0F;&#x66F4;&#x9AD8;&#x6548;&#xFF09;&#x901A;&#x77E5;&#x9700;&#x4E3A;&#x4E3A;&#x6B64;&#x4F5C;&#x4E3A;&#x54CD;&#x5E94;&#x7684;Broker&#x3002;&#x540C;&#x65F6;controller&#x4E5F;&#x8D1F;&#x8D23;&#x589E;&#x5220;Topic&#x4EE5;&#x53CA;Replica&#x7684;&#x91CD;&#x65B0;&#x5206;&#x914D;&#x3002;</p>
<h2 class="mume-header" id="%E4%B8%89-ha%E7%9B%B8%E5%85%B3zookeeper%E7%BB%93%E6%9E%84" ebook-toc-level-2 heading="&amp;#x4E09;&amp;#x3001;HA&amp;#x76F8;&amp;#x5173;ZooKeeper&amp;#x7ED3;&amp;#x6784;">&#x4E09;&#x3001;HA&#x76F8;&#x5173;ZooKeeper&#x7ED3;&#x6784;</h2>

<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164108.png" alt="img"></p>
<h3 class="mume-header" id="31-admin" ebook-toc-level-3 heading="3.1&amp;#x3000;admin">3.1&#x3000;admin</h3>

<p>&#x8BE5;&#x76EE;&#x5F55;&#x4E0B;znode&#x53EA;&#x6709;&#x5728;&#x6709;&#x76F8;&#x5173;&#x64CD;&#x4F5C;&#x65F6;&#x624D;&#x4F1A;&#x5B58;&#x5728;&#xFF0C;&#x64CD;&#x4F5C;&#x7ED3;&#x675F;&#x65F6;&#x4F1A;&#x5C06;&#x5176;&#x5220;&#x9664;</p>
<p>/admin/reassign_partitions&#x7528;&#x4E8E;&#x5C06;&#x4E00;&#x4E9B;Partition&#x5206;&#x914D;&#x5230;&#x4E0D;&#x540C;&#x7684;broker&#x96C6;&#x5408;&#x4E0A;&#x3002;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;&#x5F85;&#x91CD;&#x65B0;&#x5206;&#x914D;&#x7684;Partition&#xFF0C;Kafka&#x4F1A;&#x5728;&#x8BE5;znode&#x4E0A;&#x5B58;&#x50A8;&#x5176;&#x6240;&#x6709;&#x7684;Replica&#x548C;&#x76F8;&#x5E94;&#x7684;Broker id&#x3002;&#x8BE5;znode&#x7531;&#x7BA1;&#x7406;&#x8FDB;&#x7A0B;&#x521B;&#x5EFA;&#x5E76;&#x4E14;&#x4E00;&#x65E6;&#x91CD;&#x65B0;&#x5206;&#x914D;&#x6210;&#x529F;&#x5B83;&#x5C06;&#x4F1A;&#x88AB;&#x81EA;&#x52A8;&#x79FB;&#x9664;&#x3002;</p>
<h3 class="mume-header" id="32-broker" ebook-toc-level-3 heading="3.2&amp;#x3000;broker">3.2&#x3000;broker</h3>

<p>&#x5373;/brokers/ids/[brokerId]&#xFF09;&#x5B58;&#x50A8;&#x201C;&#x6D3B;&#x7740;&#x201D;&#x7684;broker&#x4FE1;&#x606F;&#x3002;</p>
<p>topic&#x6CE8;&#x518C;&#x4FE1;&#x606F;&#xFF08;/brokers/topics/[topic]&#xFF09;&#xFF0C;&#x5B58;&#x50A8;&#x8BE5;topic&#x7684;&#x6240;&#x6709;partition&#x7684;&#x6240;&#x6709;replica&#x6240;&#x5728;&#x7684;broker id&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;replica&#x5373;&#x4E3A;preferred replica&#xFF0C;&#x5BF9;&#x4E00;&#x4E2A;&#x7ED9;&#x5B9A;&#x7684;partition&#xFF0C;&#x5B83;&#x5728;&#x540C;&#x4E00;&#x4E2A;broker&#x4E0A;&#x6700;&#x591A;&#x53EA;&#x6709;&#x4E00;&#x4E2A;replica,&#x56E0;&#x6B64;broker id&#x53EF;&#x4F5C;&#x4E3A;replica id&#x3002;</p>
<h3 class="mume-header" id="33-controller" ebook-toc-level-3 heading="3.3&amp;#x3000;controller">3.3&#x3000;controller</h3>

<p>/controller -&gt; int (broker id of the controller)&#x5B58;&#x50A8;&#x5F53;&#x524D;controller&#x7684;&#x4FE1;&#x606F;</p>
<p>/controller_epoch -&gt; int (epoch)&#x76F4;&#x63A5;&#x4EE5;&#x6574;&#x6570;&#x5F62;&#x5F0F;&#x5B58;&#x50A8;controller epoch&#xFF0C;&#x800C;&#x975E;&#x50CF;&#x5176;&#x5B83;znode&#x4E00;&#x6837;&#x4EE5;JSON&#x5B57;&#x7B26;&#x4E32;&#x5F62;&#x5F0F;&#x5B58;&#x50A8;&#x3002;</p>
<h2 class="mume-header" id="%E5%9B%9B-producer%E5%8F%91%E5%B8%83%E6%B6%88%E6%81%AF" ebook-toc-level-2 heading="&amp;#x56DB;&amp;#x3001;&lt;strong&gt;producer&amp;#x53D1;&amp;#x5E03;&amp;#x6D88;&amp;#x606F;&lt;/strong&gt;">&#x56DB;&#x3001;<strong>producer&#x53D1;&#x5E03;&#x6D88;&#x606F;</strong></h2>

<h3 class="mume-header" id="41-%E5%86%99%E5%85%A5%E6%96%B9%E5%BC%8F" ebook-toc-level-3 heading="4.1&amp;#x3000;&amp;#x5199;&amp;#x5165;&amp;#x65B9;&amp;#x5F0F;">4.1&#x3000;&#x5199;&#x5165;&#x65B9;&#x5F0F;</h3>

<p>producer &#x91C7;&#x7528; push &#x6A21;&#x5F0F;&#x5C06;&#x6D88;&#x606F;&#x53D1;&#x5E03;&#x5230; broker&#xFF0C;&#x6BCF;&#x6761;&#x6D88;&#x606F;&#x90FD;&#x88AB; append &#x5230; patition &#x4E2D;&#xFF0C;&#x5C5E;&#x4E8E;&#x987A;&#x5E8F;&#x5199;&#x78C1;&#x76D8;&#xFF08;&#x987A;&#x5E8F;&#x5199;&#x78C1;&#x76D8;&#x6548;&#x7387;&#x6BD4;&#x968F;&#x673A;&#x5199;&#x5185;&#x5B58;&#x8981;&#x9AD8;&#xFF0C;&#x4FDD;&#x969C; kafka &#x541E;&#x5410;&#x7387;&#xFF09;&#x3002;</p>
<h3 class="mume-header" id="42-%E6%B6%88%E6%81%AF%E8%B7%AF%E7%94%B1" ebook-toc-level-3 heading="4.2&amp;#x3000;&amp;#x6D88;&amp;#x606F;&amp;#x8DEF;&amp;#x7531;">4.2&#x3000;&#x6D88;&#x606F;&#x8DEF;&#x7531;</h3>

<p>producer &#x53D1;&#x9001;&#x6D88;&#x606F;&#x5230; broker &#x65F6;&#xFF0C;&#x4F1A;&#x6839;&#x636E;&#x5206;&#x533A;&#x7B97;&#x6CD5;&#x9009;&#x62E9;&#x5C06;&#x5176;&#x5B58;&#x50A8;&#x5230;&#x54EA;&#x4E00;&#x4E2A; partition&#x3002;&#x5176;&#x8DEF;&#x7531;&#x673A;&#x5236;&#x4E3A;&#xFF1A;</p>
<pre data-role="codeBlock" data-info class="language-"><code>1&#x3001; &#x6307;&#x5B9A;&#x4E86; patition&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#xFF1B;
2&#x3001; &#x672A;&#x6307;&#x5B9A; patition &#x4F46;&#x6307;&#x5B9A; key&#xFF0C;&#x901A;&#x8FC7;&#x5BF9; key &#x7684; value &#x8FDB;&#x884C;hash &#x9009;&#x51FA;&#x4E00;&#x4E2A; patition
3&#x3001; patition &#x548C; key &#x90FD;&#x672A;&#x6307;&#x5B9A;&#xFF0C;&#x4F7F;&#x7528;&#x8F6E;&#x8BE2;&#x9009;&#x51FA;&#x4E00;&#x4E2A; patition&#x3002;
</code></pre><h3 class="mume-header" id="43-%E5%86%99%E5%85%A5%E6%B5%81%E7%A8%8B" ebook-toc-level-3 heading="4.3&amp;#x3000;&amp;#x5199;&amp;#x5165;&amp;#x6D41;&amp;#x7A0B;">4.3&#x3000;&#x5199;&#x5165;&#x6D41;&#x7A0B;</h3>

<p>producer &#x5199;&#x5165;&#x6D88;&#x606F;&#x5E8F;&#x5217;&#x56FE;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164114.png" alt="img"></p>
<p>&#x6D41;&#x7A0B;&#x8BF4;&#x660E;&#xFF1A;</p>
<blockquote>
<pre data-role="codeBlock" data-info class="language-"><code>1&#x3001; producer &#x5148;&#x4ECE; zookeeper &#x7684; &quot;/brokers/.../state&quot; &#x8282;&#x70B9;&#x627E;&#x5230;&#x8BE5; partition &#x7684; leader 
2&#x3001; producer &#x5C06;&#x6D88;&#x606F;&#x53D1;&#x9001;&#x7ED9;&#x8BE5; leader 
3&#x3001; leader &#x5C06;&#x6D88;&#x606F;&#x5199;&#x5165;&#x672C;&#x5730; log 
4&#x3001; followers &#x4ECE; leader pull &#x6D88;&#x606F;&#xFF0C;&#x5199;&#x5165;&#x672C;&#x5730; log &#x540E; leader &#x53D1;&#x9001; ACK 
5&#x3001; leader &#x6536;&#x5230;&#x6240;&#x6709; ISR &#x4E2D;&#x7684; replica &#x7684; ACK &#x540E;&#xFF0C;&#x589E;&#x52A0; HW&#xFF08;high watermark&#xFF0C;&#x6700;&#x540E; commit &#x7684; offset&#xFF09; &#x5E76;&#x5411; producer &#x53D1;&#x9001; ACK
</code></pre></blockquote>
<h2 class="mume-header" id="%E4%BA%94-broker%E4%BF%9D%E5%AD%98%E6%B6%88%E6%81%AF" ebook-toc-level-2 heading="&amp;#x4E94;&amp;#x3001;broker&amp;#x4FDD;&amp;#x5B58;&amp;#x6D88;&amp;#x606F;">&#x4E94;&#x3001;broker&#x4FDD;&#x5B58;&#x6D88;&#x606F;</h2>

<h3 class="mume-header" id="51-%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F" ebook-toc-level-3 heading="5.1&amp;#x3000;&amp;#x5B58;&amp;#x50A8;&amp;#x65B9;&amp;#x5F0F;">5.1&#x3000;&#x5B58;&#x50A8;&#x65B9;&#x5F0F;</h3>

<p>&#x7269;&#x7406;&#x4E0A;&#x628A; topic &#x5206;&#x6210;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A; patition&#xFF08;&#x5BF9;&#x5E94; server.properties &#x4E2D;&#x7684; num.partitions=3 &#x914D;&#x7F6E;&#xFF09;&#xFF0C;&#x6BCF;&#x4E2A; patition &#x7269;&#x7406;&#x4E0A;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#xFF08;&#x8BE5;&#x6587;&#x4EF6;&#x5939;&#x5B58;&#x50A8;&#x8BE5; patition &#x7684;&#x6240;&#x6709;&#x6D88;&#x606F;&#x548C;&#x7D22;&#x5F15;&#x6587;&#x4EF6;&#xFF09;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164118.png" alt="img"></p>
<h3 class="mume-header" id="52-%E5%AD%98%E5%82%A8%E7%AD%96%E7%95%A5" ebook-toc-level-3 heading="5.2&amp;#x3000;&amp;#x5B58;&amp;#x50A8;&amp;#x7B56;&amp;#x7565;">5.2&#x3000;&#x5B58;&#x50A8;&#x7B56;&#x7565;</h3>

<p>&#x65E0;&#x8BBA;&#x6D88;&#x606F;&#x662F;&#x5426;&#x88AB;&#x6D88;&#x8D39;&#xFF0C;kafka &#x90FD;&#x4F1A;&#x4FDD;&#x7559;&#x6240;&#x6709;&#x6D88;&#x606F;&#x3002;&#x6709;&#x4E24;&#x79CD;&#x7B56;&#x7565;&#x53EF;&#x4EE5;&#x5220;&#x9664;&#x65E7;&#x6570;&#x636E;&#xFF1A;</p>
<pre data-role="codeBlock" data-info class="language-"><code>1&#x3001; &#x57FA;&#x4E8E;&#x65F6;&#x95F4;&#xFF1A;log.retention.hours=168 
2&#x3001; &#x57FA;&#x4E8E;&#x5927;&#x5C0F;&#xFF1A;log.retention.bytes=1073741824
</code></pre><h2 class="mume-header" id="%E5%85%AD-topic%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E5%88%A0%E9%99%A4" ebook-toc-level-2 heading="&amp;#x516D;&amp;#x3001;Topic&amp;#x7684;&amp;#x521B;&amp;#x5EFA;&amp;#x548C;&amp;#x5220;&amp;#x9664;">&#x516D;&#x3001;Topic&#x7684;&#x521B;&#x5EFA;&#x548C;&#x5220;&#x9664;</h2>

<h3 class="mume-header" id="61-%E5%88%9B%E5%BB%BAtopic" ebook-toc-level-3 heading="6.1&amp;#x3000;&amp;#x521B;&amp;#x5EFA;topic">6.1&#x3000;&#x521B;&#x5EFA;topic</h3>

<p>&#x521B;&#x5EFA; topic &#x7684;&#x5E8F;&#x5217;&#x56FE;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164122.png" alt="img"></p>
<p>&#x6D41;&#x7A0B;&#x8BF4;&#x660E;&#xFF1A;</p>
<blockquote>
<pre data-role="codeBlock" data-info class="language-"><code>1&#x3001; controller &#x5728; ZooKeeper &#x7684; /brokers/topics &#x8282;&#x70B9;&#x4E0A;&#x6CE8;&#x518C; watcher&#xFF0C;&#x5F53; topic &#x88AB;&#x521B;&#x5EFA;&#xFF0C;&#x5219; controller &#x4F1A;&#x901A;&#x8FC7; watch &#x5F97;&#x5230;&#x8BE5; topic &#x7684; partition/replica &#x5206;&#x914D;&#x3002;
2&#x3001; controller&#x4ECE; /brokers/ids &#x8BFB;&#x53D6;&#x5F53;&#x524D;&#x6240;&#x6709;&#x53EF;&#x7528;&#x7684; broker &#x5217;&#x8868;&#xFF0C;&#x5BF9;&#x4E8E; set_p &#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x4E2A; partition&#xFF1A;
     2.1&#x3001; &#x4ECE;&#x5206;&#x914D;&#x7ED9;&#x8BE5; partition &#x7684;&#x6240;&#x6709; replica&#xFF08;&#x79F0;&#x4E3A;AR&#xFF09;&#x4E2D;&#x4EFB;&#x9009;&#x4E00;&#x4E2A;&#x53EF;&#x7528;&#x7684; broker &#x4F5C;&#x4E3A;&#x65B0;&#x7684; leader&#xFF0C;&#x5E76;&#x5C06;AR&#x8BBE;&#x7F6E;&#x4E3A;&#x65B0;&#x7684; ISR 
     2.2&#x3001; &#x5C06;&#x65B0;&#x7684; leader &#x548C; ISR &#x5199;&#x5165; /brokers/topics/[topic]/partitions/[partition]/state 
3&#x3001; controller &#x901A;&#x8FC7; RPC &#x5411;&#x76F8;&#x5173;&#x7684; broker &#x53D1;&#x9001; LeaderAndISRRequest&#x3002;
</code></pre></blockquote>
<h3 class="mume-header" id="62-%E5%88%A0%E9%99%A4topic" ebook-toc-level-3 heading="6.2&amp;#x3000;&amp;#x5220;&amp;#x9664;topic">6.2&#x3000;&#x5220;&#x9664;topic</h3>

<p>&#x5220;&#x9664; topic &#x7684;&#x5E8F;&#x5217;&#x56FE;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164126.png" alt="img"></p>
<p>&#x6D41;&#x7A0B;&#x8BF4;&#x660E;&#xFF1A;</p>
<blockquote>
<pre data-role="codeBlock" data-info class="language-"><code>1&#x3001; controller &#x5728; zooKeeper &#x7684; /brokers/topics &#x8282;&#x70B9;&#x4E0A;&#x6CE8;&#x518C; watcher&#xFF0C;&#x5F53; topic &#x88AB;&#x5220;&#x9664;&#xFF0C;&#x5219; controller &#x4F1A;&#x901A;&#x8FC7; watch &#x5F97;&#x5230;&#x8BE5; topic &#x7684; partition/replica &#x5206;&#x914D;&#x3002; 
2&#x3001; &#x82E5; delete.topic.enable=false&#xFF0C;&#x7ED3;&#x675F;&#xFF1B;&#x5426;&#x5219; controller &#x6CE8;&#x518C;&#x5728; /admin/delete_topics &#x4E0A;&#x7684; watch &#x88AB; fire&#xFF0C;controller &#x901A;&#x8FC7;&#x56DE;&#x8C03;&#x5411;&#x5BF9;&#x5E94;&#x7684; broker &#x53D1;&#x9001; StopReplicaRequest&#x3002;
</code></pre></blockquote>
<h2 class="mume-header" id="%E4%B8%83-broker-failover" ebook-toc-level-2 heading="&amp;#x4E03;&amp;#x3001;&lt;strong&gt;broker failover&lt;/strong&gt;">&#x4E03;&#x3001;<strong>broker failover</strong></h2>

<p>kafka broker failover &#x5E8F;&#x5217;&#x56FE;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<p><strong><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164129.png" alt="img"></strong></p>
<p>&#x6D41;&#x7A0B;&#x8BF4;&#x660E;&#xFF1A;</p>
<blockquote>
<pre data-role="codeBlock" data-info class="language-"><code>1&#x3001; controller &#x5728; zookeeper &#x7684; /brokers/ids/[brokerId] &#x8282;&#x70B9;&#x6CE8;&#x518C; Watcher&#xFF0C;&#x5F53; broker &#x5B95;&#x673A;&#x65F6; zookeeper &#x4F1A; fire watch
2&#x3001; controller &#x4ECE; /brokers/ids &#x8282;&#x70B9;&#x8BFB;&#x53D6;&#x53EF;&#x7528;broker 
3&#x3001; controller&#x51B3;&#x5B9A;set_p&#xFF0C;&#x8BE5;&#x96C6;&#x5408;&#x5305;&#x542B;&#x5B95;&#x673A; broker &#x4E0A;&#x7684;&#x6240;&#x6709; partition 
4&#x3001; &#x5BF9; set_p &#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x4E2A; partition 
    4.1&#x3001; &#x4ECE;/brokers/topics/[topic]/partitions/[partition]/state &#x8282;&#x70B9;&#x8BFB;&#x53D6; ISR 
    4.2&#x3001; &#x51B3;&#x5B9A;&#x65B0; leader 
    4.3&#x3001; &#x5C06;&#x65B0; leader&#x3001;ISR&#x3001;controller_epoch &#x548C; leader_epoch &#x7B49;&#x4FE1;&#x606F;&#x5199;&#x5165; state &#x8282;&#x70B9;
5&#x3001; &#x901A;&#x8FC7; RPC &#x5411;&#x76F8;&#x5173; broker &#x53D1;&#x9001; leaderAndISRRequest &#x547D;&#x4EE4;
</code></pre></blockquote>
<h2 class="mume-header" id="%E5%85%AB-controller-failover" ebook-toc-level-2 heading="&amp;#x516B;&amp;#x3001;&lt;strong&gt;controller failover&lt;/strong&gt;">&#x516B;&#x3001;<strong>controller failover</strong></h2>

<p>&#x5F53; controller &#x5B95;&#x673A;&#x65F6;&#x4F1A;&#x89E6;&#x53D1; controller failover&#x3002;&#x6BCF;&#x4E2A; broker &#x90FD;&#x4F1A;&#x5728; zookeeper &#x7684; &quot;/controller&quot; &#x8282;&#x70B9;&#x6CE8;&#x518C; watcher&#xFF0C;&#x5F53; controller &#x5B95;&#x673A;&#x65F6; zookeeper &#x4E2D;&#x7684;&#x4E34;&#x65F6;&#x8282;&#x70B9;&#x6D88;&#x5931;&#xFF0C;&#x6240;&#x6709;&#x5B58;&#x6D3B;&#x7684; broker &#x6536;&#x5230; fire &#x7684;&#x901A;&#x77E5;&#xFF0C;&#x6BCF;&#x4E2A; broker &#x90FD;&#x5C1D;&#x8BD5;&#x521B;&#x5EFA;&#x65B0;&#x7684; controller path&#xFF0C;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x7ADE;&#x9009;&#x6210;&#x529F;&#x5E76;&#x5F53;&#x9009;&#x4E3A; controller&#x3002;</p>
<p>&#x5F53;&#x65B0;&#x7684; controller &#x5F53;&#x9009;&#x65F6;&#xFF0C;&#x4F1A;&#x89E6;&#x53D1; KafkaController.onControllerFailover &#x65B9;&#x6CD5;&#xFF0C;&#x5728;&#x8BE5;&#x65B9;&#x6CD5;&#x4E2D;&#x5B8C;&#x6210;&#x5982;&#x4E0B;&#x64CD;&#x4F5C;&#xFF1A;</p>
<blockquote>
<pre data-role="codeBlock" data-info class="language-"><code>1&#x3001; &#x8BFB;&#x53D6;&#x5E76;&#x589E;&#x52A0; Controller Epoch&#x3002; 
2&#x3001; &#x5728; reassignedPartitions Patch(/admin/reassign_partitions) &#x4E0A;&#x6CE8;&#x518C; watcher&#x3002; 
3&#x3001; &#x5728; preferredReplicaElection Path(/admin/preferred_replica_election) &#x4E0A;&#x6CE8;&#x518C; watcher&#x3002; 
4&#x3001; &#x901A;&#x8FC7; partitionStateMachine &#x5728; broker Topics Patch(/brokers/topics) &#x4E0A;&#x6CE8;&#x518C; watcher&#x3002; 
5&#x3001; &#x82E5; delete.topic.enable=true&#xFF08;&#x9ED8;&#x8BA4;&#x503C;&#x662F; false&#xFF09;&#xFF0C;&#x5219; partitionStateMachine &#x5728; Delete Topic Patch(/admin/delete_topics) &#x4E0A;&#x6CE8;&#x518C; watcher&#x3002; 
6&#x3001; &#x901A;&#x8FC7; replicaStateMachine&#x5728; Broker Ids Patch(/brokers/ids)&#x4E0A;&#x6CE8;&#x518C;Watch&#x3002; 
7&#x3001; &#x521D;&#x59CB;&#x5316; ControllerContext &#x5BF9;&#x8C61;&#xFF0C;&#x8BBE;&#x7F6E;&#x5F53;&#x524D;&#x6240;&#x6709; topic&#xFF0C;&#x201C;&#x6D3B;&#x201D;&#x7740;&#x7684; broker &#x5217;&#x8868;&#xFF0C;&#x6240;&#x6709; partition &#x7684; leader &#x53CA; ISR&#x7B49;&#x3002; 
8&#x3001; &#x542F;&#x52A8; replicaStateMachine &#x548C; partitionStateMachine&#x3002; 
9&#x3001; &#x5C06; brokerState &#x72B6;&#x6001;&#x8BBE;&#x7F6E;&#x4E3A; RunningAsController&#x3002; 
10&#x3001; &#x5C06;&#x6BCF;&#x4E2A; partition &#x7684; Leadership &#x4FE1;&#x606F;&#x53D1;&#x9001;&#x7ED9;&#x6240;&#x6709;&#x201C;&#x6D3B;&#x201D;&#x7740;&#x7684; broker&#x3002; 
11&#x3001; &#x82E5; auto.leader.rebalance.enable=true&#xFF08;&#x9ED8;&#x8BA4;&#x503C;&#x662F;true&#xFF09;&#xFF0C;&#x5219;&#x542F;&#x52A8; partition-rebalance &#x7EBF;&#x7A0B;&#x3002; 
12&#x3001; &#x82E5; delete.topic.enable=true &#x4E14;Delete Topic Patch(/admin/delete_topics)&#x4E2D;&#x6709;&#x503C;&#xFF0C;&#x5219;&#x5220;&#x9664;&#x76F8;&#x5E94;&#x7684;Topic&#x3002;
</code></pre></blockquote>
<h2 class="mume-header" id="%E5%8F%82%E8%80%83-2" ebook-toc-level-2 heading="&amp;#x53C2;&amp;#x8003;">&#x53C2;&#x8003;</h2>

<p><a href="https://www.cnblogs.com/qingyunzong/p/9004703.html">https://www.cnblogs.com/qingyunzong/p/9004703.html</a></p>
<h1 class="mume-header" id="kafka%E7%9A%84%E5%AE%89%E8%A3%85" ebook-toc-level-1 heading="kafka&amp;#x7684;&amp;#x5B89;&amp;#x88C5;">kafka&#x7684;&#x5B89;&#x88C5;</h1>

<h2 class="mume-header" id="%E4%B8%80-%E4%B8%8B%E8%BD%BD" ebook-toc-level-2 heading="&amp;#x4E00;&amp;#x3001;&amp;#x4E0B;&amp;#x8F7D;">&#x4E00;&#x3001;&#x4E0B;&#x8F7D;</h2>

<p>&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#xFF1A;</p>
<p><a href="http://kafka.apache.org/downloads.html">http://kafka.apache.org/downloads.html</a></p>
<p><a href="http://mirrors.hust.edu.cn/apache/">http://mirrors.hust.edu.cn/apache/</a></p>
<p><a href="https://www.cnblogs.com/qingyunzong/p/9005062.html#_labelTop">&#x56DE;&#x5230;&#x9876;&#x90E8;</a></p>
<h2 class="mume-header" id="%E4%BA%8C-%E5%AE%89%E8%A3%85%E5%89%8D%E6%8F%90zookeeper%E5%AE%89%E8%A3%85" ebook-toc-level-2 heading="&amp;#x4E8C;&amp;#x3001;&amp;#x5B89;&amp;#x88C5;&amp;#x524D;&amp;#x63D0;&amp;#xFF08;zookeeper&amp;#x5B89;&amp;#x88C5;&amp;#xFF09;">&#x4E8C;&#x3001;&#x5B89;&#x88C5;&#x524D;&#x63D0;&#xFF08;zookeeper&#x5B89;&#x88C5;&#xFF09;</h2>

<p>&#x53C2;&#x8003;http://www.cnblogs.com/qingyunzong/p/8634335.html#_label4_0</p>
<h2 class="mume-header" id="%E4%B8%89-%E5%AE%89%E8%A3%85" ebook-toc-level-2 heading="&amp;#x4E09;&amp;#x3001;&amp;#x5B89;&amp;#x88C5;">&#x4E09;&#x3001;&#x5B89;&#x88C5;</h2>

<p>&#x6B64;&#x5904;&#x4F7F;&#x7528;&#x7248;&#x672C;&#x4E3A;kafka_2.11-0.8.2.0.tgz</p>
<h3 class="mume-header" id="21-%E4%B8%8A%E4%BC%A0%E8%A7%A3%E5%8E%8B%E7%BC%A9" ebook-toc-level-3 heading="2.1&amp;#x3000;&amp;#x4E0A;&amp;#x4F20;&amp;#x89E3;&amp;#x538B;&amp;#x7F29;">2.1&#x3000;&#x4E0A;&#x4F20;&#x89E3;&#x538B;&#x7F29;</h3>

<pre data-role="codeBlock" data-info class="language-"><code>[hadoop@hadoop1 ~]$ tar -zxvf kafka_2.11-0.8.2.0.tgz -C apps
[hadoop@hadoop1 ~]$ cd apps/
[hadoop@hadoop1 apps]$ ln -s kafka_2.11-0.8.2.0/ kafka
</code></pre><h3 class="mume-header" id="22-%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" ebook-toc-level-3 heading="2.2&amp;#x3000;&amp;#x4FEE;&amp;#x6539;&amp;#x914D;&amp;#x7F6E;&amp;#x6587;&amp;#x4EF6;">2.2&#x3000;&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</h3>

<p>&#x8FDB;&#x5165;kafka&#x7684;&#x5B89;&#x88C5;&#x914D;&#x7F6E;&#x76EE;&#x5F55;</p>
<pre data-role="codeBlock" data-info class="language-"><code>[hadoop@hadoop1 ~]$ cd apps/kafka/config/
</code></pre><p>&#x4E3B;&#x8981;&#x5173;&#x6CE8;&#xFF1A;<strong>server.properties</strong> &#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x5373;&#x53EF;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x5728;&#x76EE;&#x5F55;&#x4E0B;&#xFF1A;</p>
<p>&#x6709;&#x5F88;&#x591A;&#x6587;&#x4EF6;&#xFF0C;&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x6709;Zookeeper&#x6587;&#x4EF6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6839;&#x636E;Kafka&#x5185;&#x5E26;&#x7684;zk&#x96C6;&#x7FA4;&#x6765;&#x542F;&#x52A8;&#xFF0C;&#x4F46;&#x662F;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;&#x72EC;&#x7ACB;&#x7684;zk&#x96C6;&#x7FA4;</p>
<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164012.png" alt="img"></p>
<p>server.properties&#xFF08;<strong>broker.id&#x548C;host.name&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x90FD;&#x4E0D;&#x76F8;&#x540C;</strong>&#xFF09;</p>
<pre data-role="codeBlock" data-info class="language-"><code>//&#x5F53;&#x524D;&#x673A;&#x5668;&#x5728;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x552F;&#x4E00;&#x6807;&#x8BC6;&#xFF0C;&#x548C;zookeeper&#x7684;myid&#x6027;&#x8D28;&#x4E00;&#x6837;
broker.id=0
//&#x5F53;&#x524D;kafka&#x5BF9;&#x5916;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x7684;&#x7AEF;&#x53E3;&#x9ED8;&#x8BA4;&#x662F;9092
port=9092
//&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x9ED8;&#x8BA4;&#x662F;&#x5173;&#x95ED;&#x7684;&#xFF0C;&#x5728;0.8.1&#x6709;&#x4E2A;bug&#xFF0C;DNS&#x89E3;&#x6790;&#x95EE;&#x9898;&#xFF0C;&#x5931;&#x8D25;&#x7387;&#x7684;&#x95EE;&#x9898;&#x3002;
host.name=hadoop1
//&#x8FD9;&#x4E2A;&#x662F;borker&#x8FDB;&#x884C;&#x7F51;&#x7EDC;&#x5904;&#x7406;&#x7684;&#x7EBF;&#x7A0B;&#x6570;
num.network.threads=3
//&#x8FD9;&#x4E2A;&#x662F;borker&#x8FDB;&#x884C;I/O&#x5904;&#x7406;&#x7684;&#x7EBF;&#x7A0B;&#x6570;
num.io.threads=8
//&#x53D1;&#x9001;&#x7F13;&#x51B2;&#x533A;buffer&#x5927;&#x5C0F;&#xFF0C;&#x6570;&#x636E;&#x4E0D;&#x662F;&#x4E00;&#x4E0B;&#x5B50;&#x5C31;&#x53D1;&#x9001;&#x7684;&#xFF0C;&#x5148;&#x56DE;&#x5B58;&#x50A8;&#x5230;&#x7F13;&#x51B2;&#x533A;&#x4E86;&#x5230;&#x8FBE;&#x4E00;&#x5B9A;&#x7684;&#x5927;&#x5C0F;&#x540E;&#x5728;&#x53D1;&#x9001;&#xFF0C;&#x80FD;&#x63D0;&#x9AD8;&#x6027;&#x80FD;
socket.send.buffer.bytes=102400
//kafka&#x63A5;&#x6536;&#x7F13;&#x51B2;&#x533A;&#x5927;&#x5C0F;&#xFF0C;&#x5F53;&#x6570;&#x636E;&#x5230;&#x8FBE;&#x4E00;&#x5B9A;&#x5927;&#x5C0F;&#x540E;&#x5728;&#x5E8F;&#x5217;&#x5316;&#x5230;&#x78C1;&#x76D8;
socket.receive.buffer.bytes=102400
//&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x5411;kafka&#x8BF7;&#x6C42;&#x6D88;&#x606F;&#x6216;&#x8005;&#x5411;kafka&#x53D1;&#x9001;&#x6D88;&#x606F;&#x7684;&#x8BF7;&#x8BF7;&#x6C42;&#x7684;&#x6700;&#x5927;&#x6570;&#xFF0C;&#x8FD9;&#x4E2A;&#x503C;&#x4E0D;&#x80FD;&#x8D85;&#x8FC7;java&#x7684;&#x5806;&#x6808;&#x5927;&#x5C0F;
socket.request.max.bytes=104857600
//&#x6D88;&#x606F;&#x5B58;&#x653E;&#x7684;&#x76EE;&#x5F55;&#xFF0C;&#x8FD9;&#x4E2A;&#x76EE;&#x5F55;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x4E3A;&#x201C;&#xFF0C;&#x201D;&#x9017;&#x53F7;&#x5206;&#x5272;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x4E0A;&#x9762;&#x7684;num.io.threads&#x8981;&#x5927;&#x4E8E;&#x8FD9;&#x4E2A;&#x76EE;&#x5F55;&#x7684;&#x4E2A;&#x6570;&#x8FD9;&#x4E2A;&#x76EE;&#x5F55;&#xFF0C;
//&#x5982;&#x679C;&#x914D;&#x7F6E;&#x591A;&#x4E2A;&#x76EE;&#x5F55;&#xFF0C;&#x65B0;&#x521B;&#x5EFA;&#x7684;topic&#x4ED6;&#x628A;&#x6D88;&#x606F;&#x6301;&#x4E45;&#x5316;&#x7684;&#x5730;&#x65B9;&#x662F;&#xFF0C;&#x5F53;&#x524D;&#x4EE5;&#x9017;&#x53F7;&#x5206;&#x5272;&#x7684;&#x76EE;&#x5F55;&#x4E2D;&#xFF0C;&#x90A3;&#x4E2A;&#x5206;&#x533A;&#x6570;&#x6700;&#x5C11;&#x5C31;&#x653E;&#x90A3;&#x4E00;&#x4E2A;
log.dirs=/home/hadoop/log/kafka-logs
//&#x9ED8;&#x8BA4;&#x7684;&#x5206;&#x533A;&#x6570;&#xFF0C;&#x4E00;&#x4E2A;topic&#x9ED8;&#x8BA4;1&#x4E2A;&#x5206;&#x533A;&#x6570;
num.partitions=1
//&#x6BCF;&#x4E2A;&#x6570;&#x636E;&#x76EE;&#x5F55;&#x7528;&#x6765;&#x65E5;&#x5FD7;&#x6062;&#x590D;&#x7684;&#x7EBF;&#x7A0B;&#x6570;&#x76EE;
num.recovery.threads.per.data.dir=1
//&#x9ED8;&#x8BA4;&#x6D88;&#x606F;&#x7684;&#x6700;&#x5927;&#x6301;&#x4E45;&#x5316;&#x65F6;&#x95F4;&#xFF0C;168&#x5C0F;&#x65F6;&#xFF0C;7&#x5929;
log.retention.hours=168
//&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#xFF1A;&#x56E0;&#x4E3A;kafka&#x7684;&#x6D88;&#x606F;&#x662F;&#x4EE5;&#x8FFD;&#x52A0;&#x7684;&#x5F62;&#x5F0F;&#x843D;&#x5730;&#x5230;&#x6587;&#x4EF6;&#xFF0C;&#x5F53;&#x8D85;&#x8FC7;&#x8FD9;&#x4E2A;&#x503C;&#x7684;&#x65F6;&#x5019;&#xFF0C;kafka&#x4F1A;&#x65B0;&#x8D77;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;
log.segment.bytes=1073741824
//&#x6BCF;&#x9694;300000&#x6BEB;&#x79D2;&#x53BB;&#x68C0;&#x67E5;&#x4E0A;&#x9762;&#x914D;&#x7F6E;&#x7684;log&#x5931;&#x6548;&#x65F6;&#x95F4;
log.retention.check.interval.ms=300000
//&#x662F;&#x5426;&#x542F;&#x7528;log&#x538B;&#x7F29;&#xFF0C;&#x4E00;&#x822C;&#x4E0D;&#x7528;&#x542F;&#x7528;&#xFF0C;&#x542F;&#x7528;&#x7684;&#x8BDD;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x6027;&#x80FD;
log.cleaner.enable=false
//&#x8BBE;&#x7F6E;zookeeper&#x7684;&#x8FDE;&#x63A5;&#x7AEF;&#x53E3;
zookeeper.connect=192.168.123.102:2181,192.168.123.103:2181,192.168.123.104:2181
//&#x8BBE;&#x7F6E;zookeeper&#x7684;&#x8FDE;&#x63A5;&#x8D85;&#x65F6;&#x65F6;&#x95F4;
zookeeper.connection.timeout.ms=6000
</code></pre><p>producer.properties</p>
<pre data-role="codeBlock" data-info class="language-"><code>metadata.broker.list=192.168.123.102:9092,192.168.123.103:9092,192.168.123.104:9092
</code></pre><p>consumer.properties</p>
<pre data-role="codeBlock" data-info class="language-"><code>zookeeper.connect=192.168.123.102:2181,192.168.123.103:2181,192.168.123.104:2181
</code></pre><h3 class="mume-header" id="23-%E5%B0%86kafka%E7%9A%84%E5%AE%89%E8%A3%85%E5%8C%85%E5%88%86%E5%8F%91%E5%88%B0%E5%85%B6%E4%BB%96%E8%8A%82%E7%82%B9" ebook-toc-level-3 heading="2.3&amp;#x3000;&amp;#x5C06;kafka&amp;#x7684;&amp;#x5B89;&amp;#x88C5;&amp;#x5305;&amp;#x5206;&amp;#x53D1;&amp;#x5230;&amp;#x5176;&amp;#x4ED6;&amp;#x8282;&amp;#x70B9;">2.3&#x3000;&#x5C06;kafka&#x7684;&#x5B89;&#x88C5;&#x5305;&#x5206;&#x53D1;&#x5230;&#x5176;&#x4ED6;&#x8282;&#x70B9;</h3>

<pre data-role="codeBlock" data-info class="language-"><code>[hadoop@hadoop1 apps]$ scp -r kafka_2.11-0.8.2.0/ hadoop2:$PWD
[hadoop@hadoop1 apps]$ scp -r kafka_2.11-0.8.2.0/ hadoop3:$PWD
[hadoop@hadoop1 apps]$ scp -r kafka_2.11-0.8.2.0/ hadoop4:$PWD
</code></pre><h3 class="mume-header" id="24-%E5%88%9B%E5%BB%BA%E8%BD%AF%E8%BF%9E%E6%8E%A5" ebook-toc-level-3 heading="2.4&amp;#x3000;&amp;#x521B;&amp;#x5EFA;&amp;#x8F6F;&amp;#x8FDE;&amp;#x63A5;">2.4&#x3000;&#x521B;&#x5EFA;&#x8F6F;&#x8FDE;&#x63A5;</h3>

<pre data-role="codeBlock" data-info class="language-"><code>[hadoop@hadoop1 apps]$ ln -s kafka_2.11-0.8.2.0/ kafka
</code></pre><h3 class="mume-header" id="25-%E4%BF%AE%E6%94%B9%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F" ebook-toc-level-3 heading="2.5&amp;#x3000;&amp;#x4FEE;&amp;#x6539;&amp;#x73AF;&amp;#x5883;&amp;#x53D8;&amp;#x91CF;">2.5&#x3000;&#x4FEE;&#x6539;&#x73AF;&#x5883;&#x53D8;&#x91CF;</h3>

<pre data-role="codeBlock" data-info class="language-"><code>[hadoop@hadoop1 ~]$ vi .bashrc 
#Kafka
export KAFKA_HOME=/home/hadoop/apps/kafka
export PATH=$PATH:$KAFKA_HOME/bin
</code></pre><p>&#x4FDD;&#x5B58;&#x4F7F;&#x5176;&#x7ACB;&#x5373;&#x751F;&#x6548;</p>
<pre data-role="codeBlock" data-info class="language-"><code>[hadoop@hadoop1 ~]$ source ~/.bashrc
</code></pre><h2 class="mume-header" id="%E4%B8%89-%E5%90%AF%E5%8A%A8" ebook-toc-level-2 heading="&amp;#x4E09;&amp;#x3001;&amp;#x542F;&amp;#x52A8;">&#x4E09;&#x3001;&#x542F;&#x52A8;</h2>

<h3 class="mume-header" id="31-%E9%A6%96%E5%85%88%E5%90%AF%E5%8A%A8zookeeper%E9%9B%86%E7%BE%A4" ebook-toc-level-3 heading="3.1&amp;#x3000;&amp;#x9996;&amp;#x5148;&amp;#x542F;&amp;#x52A8;zookeeper&amp;#x96C6;&amp;#x7FA4;">3.1&#x3000;&#x9996;&#x5148;&#x542F;&#x52A8;zookeeper&#x96C6;&#x7FA4;</h3>

<p>&#x6240;&#x6709;zookeeper&#x8282;&#x70B9;&#x90FD;&#x9700;&#x8981;&#x6267;&#x884C;</p>
<pre data-role="codeBlock" data-info class="language-"><code>[hadoop@hadoop1 ~]$ zkServer.sh start
</code></pre><h3 class="mume-header" id="32-%E5%90%AF%E5%8A%A8kafka%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1" ebook-toc-level-3 heading="3.2&amp;#x3000;&amp;#x542F;&amp;#x52A8;Kafka&amp;#x96C6;&amp;#x7FA4;&amp;#x670D;&amp;#x52A1;">3.2&#x3000;&#x542F;&#x52A8;Kafka&#x96C6;&#x7FA4;&#x670D;&#x52A1;</h3>

<pre data-role="codeBlock" data-info class="language-"><code>[hadoop@hadoop1 kafka]$ bin/kafka-server-start.sh config/server.properties
</code></pre><p>hadoop1</p>
<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164017.png" alt="img"></p>
<p>Hadoop2</p>
<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164020.png" alt="img"></p>
<p>hadoop3</p>
<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164023.png" alt="img"></p>
<p>hadoop4</p>
<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164025.png" alt="img"></p>
<h3 class="mume-header" id="33-%E5%88%9B%E5%BB%BA%E7%9A%84topic" ebook-toc-level-3 heading="3.3&amp;#x3000;&amp;#x521B;&amp;#x5EFA;&amp;#x7684;topic">3.3&#x3000;&#x521B;&#x5EFA;&#x7684;topic</h3>

<pre data-role="codeBlock" data-info class="language-"><code>[hadoop@hadoop1 kafka]$ bin/kafka-topics.sh --create --zookeeper hadoop1:2181 --replication-factor 3 --partitions 3 --topic topic2
</code></pre><p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164028.png" alt="img"></p>
<h3 class="mume-header" id="34-%E6%9F%A5%E7%9C%8Btopic%E5%89%AF%E6%9C%AC%E4%BF%A1%E6%81%AF" ebook-toc-level-3 heading="3.4&amp;#x3000;&amp;#x67E5;&amp;#x770B;topic&amp;#x526F;&amp;#x672C;&amp;#x4FE1;&amp;#x606F;">3.4&#x3000;&#x67E5;&#x770B;topic&#x526F;&#x672C;&#x4FE1;&#x606F;</h3>

<pre data-role="codeBlock" data-info class="language-"><code>[hadoop@hadoop1 kafka]$ bin/kafka-topics.sh --describe --zookeeper hadoop1:2181 --topic topic2
</code></pre><p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210526133049.png" alt="img"></p>
<h3 class="mume-header" id="35-%E6%9F%A5%E7%9C%8B%E5%B7%B2%E7%BB%8F%E5%88%9B%E5%BB%BA%E7%9A%84topic%E4%BF%A1%E6%81%AF" ebook-toc-level-3 heading="3.5&amp;#x3000;&amp;#x67E5;&amp;#x770B;&amp;#x5DF2;&amp;#x7ECF;&amp;#x521B;&amp;#x5EFA;&amp;#x7684;topic&amp;#x4FE1;&amp;#x606F;">3.5&#x3000;&#x67E5;&#x770B;&#x5DF2;&#x7ECF;&#x521B;&#x5EFA;&#x7684;topic&#x4FE1;&#x606F;</h3>

<pre data-role="codeBlock" data-info class="language-"><code>[hadoop@hadoop1 kafka]$ bin/kafka-topics.sh --list --zookeeper hadoop1:2181
</code></pre><p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164032.png" alt="img"></p>
<h3 class="mume-header" id="36-%E7%94%9F%E4%BA%A7%E8%80%85%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF" ebook-toc-level-3 heading="3.6&amp;#x3000;&amp;#x751F;&amp;#x4EA7;&amp;#x8005;&amp;#x53D1;&amp;#x9001;&amp;#x6D88;&amp;#x606F;">3.6&#x3000;&#x751F;&#x4EA7;&#x8005;&#x53D1;&#x9001;&#x6D88;&#x606F;</h3>

<pre data-role="codeBlock" data-info class="language-"><code>[hadoop@hadoop1 kafka]$ bin/kafka-console-producer.sh --broker-list hadoop1:9092 --topic topic2
</code></pre><p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164036.png" alt="img"></p>
<p>hadoop1&#x663E;&#x793A;&#x63A5;&#x6536;&#x5230;&#x6D88;&#x606F;</p>
<h3 class="mume-header" id="37-%E6%B6%88%E8%B4%B9%E8%80%85%E6%B6%88%E8%B4%B9%E6%B6%88%E6%81%AF" ebook-toc-level-3 heading="3.7&amp;#x3000;&amp;#x6D88;&amp;#x8D39;&amp;#x8005;&amp;#x6D88;&amp;#x8D39;&amp;#x6D88;&amp;#x606F;">3.7&#x3000;&#x6D88;&#x8D39;&#x8005;&#x6D88;&#x8D39;&#x6D88;&#x606F;</h3>

<p>&#x5728;hadoop2&#x4E0A;&#x6D88;&#x8D39;&#x6D88;&#x606F;</p>
<pre data-role="codeBlock" data-info class="language-"><code>[hadoop@hadoop2 kafka]$ bin/kafka-console-consumer.sh --zookeeper hadoop1:2181 --from-beginning --topic topic2
</code></pre><p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164039.png" alt="img"></p>
<h2 class="mume-header" id="%E5%8F%82%E8%80%83-3" ebook-toc-level-2 heading="&amp;#x53C2;&amp;#x8003;">&#x53C2;&#x8003;</h2>

<p><a href="https://www.cnblogs.com/qingyunzong/p/9005062.html">https://www.cnblogs.com/qingyunzong/p/9005062.html</a></p>
<h1 class="mume-header" id="kafka%E5%9C%A8zookeeper%E4%B8%AD%E5%AD%98%E5%82%A8" ebook-toc-level-1 heading="Kafka&amp;#x5728;zookeeper&amp;#x4E2D;&amp;#x5B58;&amp;#x50A8;">Kafka&#x5728;zookeeper&#x4E2D;&#x5B58;&#x50A8;</h1>

<h2 class="mume-header" id="%E4%B8%80-kafka%E5%9C%A8zookeeper%E4%B8%AD%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84%E5%9B%BE" ebook-toc-level-2 heading="&amp;#x4E00;&amp;#x3001;Kafka&amp;#x5728;zookeeper&amp;#x4E2D;&amp;#x5B58;&amp;#x50A8;&amp;#x7ED3;&amp;#x6784;&amp;#x56FE;">&#x4E00;&#x3001;Kafka&#x5728;zookeeper&#x4E2D;&#x5B58;&#x50A8;&#x7ED3;&#x6784;&#x56FE;</h2>

<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164331.png" alt="img"></p>
<h2 class="mume-header" id="%E4%BA%8C-%E5%88%86%E6%9E%90" ebook-toc-level-2 heading="&amp;#x4E8C;&amp;#x3001;&amp;#x5206;&amp;#x6790;">&#x4E8C;&#x3001;&#x5206;&#x6790;</h2>

<h3 class="mume-header" id="21-topic%E6%B3%A8%E5%86%8C%E4%BF%A1%E6%81%AF" ebook-toc-level-3 heading="2.1&amp;#x3000;topic&amp;#x6CE8;&amp;#x518C;&amp;#x4FE1;&amp;#x606F;">2.1&#x3000;topic&#x6CE8;&#x518C;&#x4FE1;&#x606F;</h3>

<p>/brokers/topics/[topic] :</p>
<p>&#x5B58;&#x50A8;&#x67D0;&#x4E2A;topic&#x7684;partitions&#x6240;&#x6709;&#x5206;&#x914D;&#x4FE1;&#x606F;</p>
<pre data-role="codeBlock" data-info class="language-"><code>[zk: localhost:2181(CONNECTED) 1] get /brokers/topics/topic2
</code></pre><p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164337.png" alt="img"></p>
<pre data-role="codeBlock" data-info class="language-"><code>Schema:
{
    &quot;version&quot;: &quot;&#x7248;&#x672C;&#x7F16;&#x53F7;&#x76EE;&#x524D;&#x56FA;&#x5B9A;&#x4E3A;&#x6570;&#x5B57;1&quot;,
    &quot;partitions&quot;: {
        &quot;partitionId&#x7F16;&#x53F7;&quot;: [
            &#x540C;&#x6B65;&#x526F;&#x672C;&#x7EC4;brokerId&#x5217;&#x8868;
        ],
        &quot;partitionId&#x7F16;&#x53F7;&quot;: [
            &#x540C;&#x6B65;&#x526F;&#x672C;&#x7EC4;brokerId&#x5217;&#x8868;
        ],
        .......
    }
}
Example:
{
&quot;version&quot;: 1,
&quot;partitions&quot;: {
&quot;2&quot;: [1, 2, 3],
&quot;1&quot;: [0, 1, 2],
&quot;0&quot;: [3, 0, 1],
}
}
</code></pre><h3 class="mume-header" id="22-partition%E7%8A%B6%E6%80%81%E4%BF%A1%E6%81%AF" ebook-toc-level-3 heading="2.2&amp;#x3000;partition&amp;#x72B6;&amp;#x6001;&amp;#x4FE1;&amp;#x606F;">2.2&#x3000;partition&#x72B6;&#x6001;&#x4FE1;&#x606F;</h3>

<p>/brokers/topics/[topic]/partitions/[0...N]  &#x5176;&#x4E2D;[0..N]&#x8868;&#x793A;partition&#x7D22;&#x5F15;&#x53F7;</p>
<p>/brokers/topics/[topic]/partitions/[partitionId]/state</p>
<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164340.png" alt="img"></p>
<pre data-role="codeBlock" data-info class="language-"><code>Schema:
{
&quot;controller_epoch&quot;: &#x8868;&#x793A;kafka&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x4E2D;&#x592E;&#x63A7;&#x5236;&#x5668;&#x9009;&#x4E3E;&#x6B21;&#x6570;,
&quot;leader&quot;: &#x8868;&#x793A;&#x8BE5;partition&#x9009;&#x4E3E;leader&#x7684;brokerId,
&quot;version&quot;: &#x7248;&#x672C;&#x7F16;&#x53F7;&#x9ED8;&#x8BA4;&#x4E3A;1,
&quot;leader_epoch&quot;: &#x8BE5;partition leader&#x9009;&#x4E3E;&#x6B21;&#x6570;,
&quot;isr&quot;: [&#x540C;&#x6B65;&#x526F;&#x672C;&#x7EC4;brokerId&#x5217;&#x8868;]
}
 
Example:
{
&quot;controller_epoch&quot;: 1,
&quot;leader&quot;: 3,
&quot;version&quot;: 1,
&quot;leader_epoch&quot;: 0,
&quot;isr&quot;: [3, 0, 1]
}
</code></pre><h3 class="mume-header" id="23-broker%E6%B3%A8%E5%86%8C%E4%BF%A1%E6%81%AF" ebook-toc-level-3 heading="2.3&amp;#x3000;Broker&amp;#x6CE8;&amp;#x518C;&amp;#x4FE1;&amp;#x606F;">2.3&#x3000;Broker&#x6CE8;&#x518C;&#x4FE1;&#x606F;</h3>

<p>/brokers/ids/[0...N]</p>
<p>&#x6BCF;&#x4E2A;broker&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x90FD;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x6570;&#x5B57;&#x7C7B;&#x578B;&#x7684;id(&#x5168;&#x5C40;&#x4E0D;&#x53EF;&#x91CD;&#x590D;),&#x6B64;&#x8282;&#x70B9;&#x4E3A;&#x4E34;&#x65F6;znode(EPHEMERAL)</p>
<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164343.png" alt="img"></p>
<pre data-role="codeBlock" data-info class="language-"><code>Schema:
{
&quot;jmx_port&quot;: jmx&#x7AEF;&#x53E3;&#x53F7;,
&quot;timestamp&quot;: kafka broker&#x521D;&#x59CB;&#x542F;&#x52A8;&#x65F6;&#x7684;&#x65F6;&#x95F4;&#x6233;,
&quot;host&quot;: &#x4E3B;&#x673A;&#x540D;&#x6216;ip&#x5730;&#x5740;,
&quot;version&quot;: &#x7248;&#x672C;&#x7F16;&#x53F7;&#x9ED8;&#x8BA4;&#x4E3A;1,
&quot;port&quot;: kafka broker&#x7684;&#x670D;&#x52A1;&#x7AEF;&#x7AEF;&#x53E3;&#x53F7;,&#x7531;server.properties&#x4E2D;&#x53C2;&#x6570;port&#x786E;&#x5B9A;
}
 
Example:
{
&quot;jmx_port&quot;: -1,
&quot;timestamp&quot;:&quot;1525741823119&quot;
&quot;version&quot;: 1,
&quot;host&quot;: &quot;hadoop1&quot;,
&quot;port&quot;: 9092
}
</code></pre><h3 class="mume-header" id="24-controller-epoch" ebook-toc-level-3 heading="2.4&amp;#x3000;Controller epoch">2.4&#x3000;Controller epoch</h3>

<p>/controller_epoch --&gt; int (epoch)</p>
<p>&#x6B64;&#x503C;&#x4E3A;&#x4E00;&#x4E2A;&#x6570;&#x5B57;,kafka&#x96C6;&#x7FA4;&#x4E2D;&#x7B2C;&#x4E00;&#x4E2A;broker&#x7B2C;&#x4E00;&#x6B21;&#x542F;&#x52A8;&#x65F6;&#x4E3A;1&#xFF0C;&#x4EE5;&#x540E;&#x53EA;&#x8981;&#x96C6;&#x7FA4;&#x4E2D;center controller&#x4E2D;&#x592E;&#x63A7;&#x5236;&#x5668;&#x6240;&#x5728;broker&#x53D8;&#x66F4;&#x6216;&#x6302;&#x6389;&#xFF0C;&#x5C31;&#x4F1A;&#x91CD;&#x65B0;&#x9009;&#x4E3E;&#x65B0;&#x7684;center controller&#xFF0C;&#x6BCF;&#x6B21;center controller&#x53D8;&#x66F4;controller_epoch&#x503C;&#x5C31;&#x4F1A; + 1;</p>
<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164346.png" alt="img"></p>
<h3 class="mume-header" id="25-controller%E6%B3%A8%E5%86%8C%E4%BF%A1%E6%81%AF" ebook-toc-level-3 heading="2.5&amp;#x3000;Controller&amp;#x6CE8;&amp;#x518C;&amp;#x4FE1;&amp;#x606F;">2.5&#x3000;Controller&#x6CE8;&#x518C;&#x4FE1;&#x606F;</h3>

<p>/controller -&gt; int (broker id of the controller)  &#x5B58;&#x50A8;center controller&#x4E2D;&#x592E;&#x63A7;&#x5236;&#x5668;&#x6240;&#x5728;kafka broker&#x7684;&#x4FE1;&#x606F;</p>
<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164349.png" alt="img"></p>
<pre data-role="codeBlock" data-info class="language-"><code>Schema:
{
&quot;version&quot;: &#x7248;&#x672C;&#x7F16;&#x53F7;&#x9ED8;&#x8BA4;&#x4E3A;1,
&quot;brokerid&quot;: kafka&#x96C6;&#x7FA4;&#x4E2D;broker&#x552F;&#x4E00;&#x7F16;&#x53F7;,
&quot;timestamp&quot;: kafka broker&#x4E2D;&#x592E;&#x63A7;&#x5236;&#x5668;&#x53D8;&#x66F4;&#x65F6;&#x7684;&#x65F6;&#x95F4;&#x6233;
}
 
Example:
{
&quot;version&quot;: 1,
&quot;brokerid&quot;: 0,
&quot;timestamp&quot;: &quot;1525741822769&quot;
}
</code></pre><h3 class="mume-header" id="26-%E8%A1%A5%E5%85%85consumer-and-consumer-group" ebook-toc-level-3 heading="2.6&amp;#x3000;&amp;#x8865;&amp;#x5145;Consumer and Consumer group">2.6&#x3000;&#x8865;&#x5145;Consumer and Consumer group</h3>

<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164352.png" alt="img"></p>
<p><strong>a.&#x6BCF;&#x4E2A;consumer&#x5BA2;&#x6237;&#x7AEF;&#x88AB;&#x521B;&#x5EFA;&#x65F6;,&#x4F1A;&#x5411;zookeeper&#x6CE8;&#x518C;&#x81EA;&#x5DF1;&#x7684;&#x4FE1;&#x606F;;</strong><br>
<strong>b.&#x6B64;&#x4F5C;&#x7528;&#x4E3B;&#x8981;&#x662F;&#x4E3A;&#x4E86;&quot;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&quot;.</strong><br>
<strong>c.&#x540C;&#x4E00;&#x4E2A;Consumer Group&#x4E2D;&#x7684;Consumers&#xFF0C;Kafka&#x5C06;&#x76F8;&#x5E94;Topic&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x6D88;&#x606F;&#x53EA;&#x53D1;&#x9001;&#x7ED9;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;Consumer&#x3002;</strong><br>
<strong>d.Consumer Group&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;Consumer&#x8BFB;&#x53D6;Topic&#x7684;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;Partitions&#xFF0C;&#x5E76;&#x4E14;&#x662F;&#x552F;&#x4E00;&#x7684;Consumer&#xFF1B;</strong><br>
<strong>e.&#x4E00;&#x4E2A;Consumer group&#x7684;&#x591A;&#x4E2A;consumer&#x7684;&#x6240;&#x6709;&#x7EBF;&#x7A0B;&#x4F9D;&#x6B21;&#x6709;&#x5E8F;&#x5730;&#x6D88;&#x8D39;&#x4E00;&#x4E2A;topic&#x7684;&#x6240;&#x6709;partitions,&#x5982;&#x679C;Consumer group&#x4E2D;&#x6240;&#x6709;consumer&#x603B;&#x7EBF;&#x7A0B;&#x5927;&#x4E8E;partitions&#x6570;&#x91CF;&#xFF0C;&#x5219;&#x4F1A;&#x51FA;&#x73B0;&#x7A7A;&#x95F2;&#x60C5;&#x51B5;;</strong></p>
<blockquote>
<p><strong>&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;&#xFF1A;</strong></p>
</blockquote>
<blockquote>
<p><strong>kafka&#x96C6;&#x7FA4;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;topic&#x4E3A;report-log  4 partitions &#x7D22;&#x5F15;&#x7F16;&#x53F7;&#x4E3A;0,1,2,3</strong></p>
</blockquote>
<blockquote>
<p><strong>&#x5047;&#x5982;&#x6709;&#x76EE;&#x524D;&#x6709;&#x4E09;&#x4E2A;&#x6D88;&#x8D39;&#x8005;node&#xFF1A;&#x6CE8;&#x610F;--&gt;&#x4E00;&#x4E2A;consumer&#x4E2D;&#x4E00;&#x4E2A;&#x6D88;&#x8D39;&#x7EBF;&#x7A0B;&#x53EF;&#x4EE5;&#x6D88;&#x8D39;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;partition.</strong></p>
</blockquote>
<blockquote>
<p><strong>&#x5982;&#x679C;&#x6BCF;&#x4E2A;consumer&#x521B;&#x5EFA;&#x4E00;&#x4E2A;consumer thread&#x7EBF;&#x7A0B;,&#x5404;&#x4E2A;node&#x6D88;&#x8D39;&#x60C5;&#x51B5;&#x5982;&#x4E0B;&#xFF0C;node1&#x6D88;&#x8D39;&#x7D22;&#x5F15;&#x7F16;&#x53F7;&#x4E3A;0,1&#x5206;&#x533A;&#xFF0C;node2&#x8D39;&#x7D22;&#x5F15;&#x7F16;&#x53F7;&#x4E3A;2,node3&#x8D39;&#x7D22;&#x5F15;&#x7F16;&#x53F7;&#x4E3A;3</strong></p>
</blockquote>
<blockquote>
<p><strong>&#x5982;&#x679C;&#x6BCF;&#x4E2A;consumer&#x521B;&#x5EFA;2&#x4E2A;consumer thread&#x7EBF;&#x7A0B;&#xFF0C;&#x5404;&#x4E2A;node&#x6D88;&#x8D39;&#x60C5;&#x51B5;&#x5982;&#x4E0B;(&#x662F;&#x4ECE;consumer node&#x5148;&#x540E;&#x542F;&#x52A8;&#x72B6;&#x6001;&#x6765;&#x786E;&#x5B9A;&#x7684;)&#xFF0C;node1&#x6D88;&#x8D39;&#x7D22;&#x5F15;&#x7F16;&#x53F7;&#x4E3A;0,1&#x5206;&#x533A;&#xFF1B;node2&#x8D39;&#x7D22;&#x5F15;&#x7F16;&#x53F7;&#x4E3A;2,3&#xFF1B;node3&#x4E3A;&#x7A7A;&#x95F2;&#x72B6;&#x6001;</strong></p>
</blockquote>
<p><strong>&#x603B;&#x7ED3;&#xFF1A;</strong><br>
<strong>&#x4ECE;&#x4EE5;&#x4E0A;&#x53EF;&#x77E5;&#xFF0C;Consumer Group&#x4E2D;&#x5404;&#x4E2A;consumer&#x662F;&#x6839;&#x636E;&#x5148;&#x540E;&#x542F;&#x52A8;&#x7684;&#x987A;&#x5E8F;&#x6709;&#x5E8F;&#x6D88;&#x8D39;&#x4E00;&#x4E2A;topic&#x7684;&#x6240;&#x6709;partitions&#x7684;&#x3002;</strong></p>
<p><strong>&#x5982;&#x679C;Consumer Group&#x4E2D;&#x6240;&#x6709;consumer&#x7684;&#x603B;&#x7EBF;&#x7A0B;&#x6570;&#x5927;&#x4E8E;partitions&#x6570;&#x91CF;&#xFF0C;&#x5219;&#x53EF;&#x80FD;consumer thread&#x6216;consumer&#x4F1A;&#x51FA;&#x73B0;&#x7A7A;&#x95F2;&#x72B6;&#x6001;</strong>&#x3002;</p>
<h3 class="mume-header" id="27-consumer%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95" ebook-toc-level-3 heading="2.7&amp;#x3000;Consumer&amp;#x5747;&amp;#x8861;&amp;#x7B97;&amp;#x6CD5;">2.7&#x3000;Consumer&#x5747;&#x8861;&#x7B97;&#x6CD5;</h3>

<p><strong>&#x5F53;&#x4E00;&#x4E2A;group&#x4E2D;,&#x6709;consumer&#x52A0;&#x5165;&#x6216;&#x8005;&#x79BB;&#x5F00;&#x65F6;,&#x4F1A;&#x89E6;&#x53D1;partitions&#x5747;&#x8861;.&#x5747;&#x8861;&#x7684;&#x6700;&#x7EC8;&#x76EE;&#x7684;,&#x662F;&#x63D0;&#x5347;topic&#x7684;&#x5E76;&#x53D1;&#x6D88;&#x8D39;&#x80FD;&#x529B;.</strong><br>
<strong>1) &#x5047;&#x5982;topic1,&#x5177;&#x6709;&#x5982;&#x4E0B;partitions: P0,P1,P2,P3</strong><br>
<strong>2) &#x52A0;&#x5165;group&#x4E2D;,&#x6709;&#x5982;&#x4E0B;consumer: C0,C1</strong><br>
<strong>3) &#x9996;&#x5148;&#x6839;&#x636E;partition&#x7D22;&#x5F15;&#x53F7;&#x5BF9;partitions&#x6392;&#x5E8F;: P0,P1,P2,P3</strong><br>
<strong>4) &#x6839;&#x636E;(<a href="http://consumer.id">consumer.id</a> + &apos;-&apos;+ thread&#x5E8F;&#x53F7;)&#x6392;&#x5E8F;: C0,C1</strong><br>
<strong>5) &#x8BA1;&#x7B97;&#x500D;&#x6570;: M = [P0,P1,P2,P3].size / [C0,C1].size,&#x672C;&#x4F8B;&#x503C;M=2(&#x5411;&#x4E0A;&#x53D6;&#x6574;)</strong><br>
<strong>6) &#x7136;&#x540E;&#x4F9D;&#x6B21;&#x5206;&#x914D;partitions: C0 = [P0,P1],C1=[P2,P3],&#x5373;Ci = [P(i * M),P((i + 1) * M -1)]</strong></p>
<h3 class="mume-header" id="28-consumer%E6%B3%A8%E5%86%8C%E4%BF%A1%E6%81%AF" ebook-toc-level-3 heading="2.8&amp;#x3000;Consumer&amp;#x6CE8;&amp;#x518C;&amp;#x4FE1;&amp;#x606F;">2.8&#x3000;Consumer&#x6CE8;&#x518C;&#x4FE1;&#x606F;</h3>

<p>&#x6BCF;&#x4E2A;consumer&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x552F;&#x4E00;&#x7684;ID(consumerId&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x6307;&#x5B9A;,&#x4E5F;&#x53EF;&#x4EE5;&#x7531;&#x7CFB;&#x7EDF;&#x751F;&#x6210;),&#x6B64;id&#x7528;&#x6765;&#x6807;&#x8BB0;&#x6D88;&#x8D39;&#x8005;&#x4FE1;&#x606F;.</p>
<p>/consumers/[groupId]/ids/[consumerIdString]</p>
<p>&#x662F;&#x4E00;&#x4E2A;&#x4E34;&#x65F6;&#x7684;znode,&#x6B64;&#x8282;&#x70B9;&#x7684;&#x503C;&#x4E3A;&#x8BF7;&#x770B;consumerIdString&#x4EA7;&#x751F;&#x89C4;&#x5219;,&#x5373;&#x8868;&#x793A;&#x6B64;consumer&#x76EE;&#x524D;&#x6240;&#x6D88;&#x8D39;&#x7684;topic + partitions&#x5217;&#x8868;.</p>
<p>consumerId&#x4EA7;&#x751F;&#x89C4;&#x5219;&#xFF1A;</p>
<blockquote>
<p>StringconsumerUuid = null;<br>
if(config.consumerId!=null &amp;&amp; config.consumerId)<br>
consumerUuid = consumerId;<br>
else {<br>
String uuid = UUID.randomUUID()<br>
consumerUuid = &quot;%s-%d-%s&quot;.format(<br>
InetAddress.getLocalHost.getHostName, System.currentTimeMillis,<br>
uuid.getMostSignificantBits().toHexString.substring(0,8));</p>
<p>}<br>
String consumerIdString = config.groupId + &quot;_&quot; + consumerUuid;</p>
</blockquote>
<pre data-role="codeBlock" data-info class="language-"><code>[zk: localhost:2181(CONNECTED) 11] get /consumers/console-consumer-2304/ids/console-consumer-2304_hadoop2-1525747915241-6b48ff32
</code></pre><p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164356.png" alt="img"></p>
<pre data-role="codeBlock" data-info class="language-"><code>Schema:
{
&quot;version&quot;: &#x7248;&#x672C;&#x7F16;&#x53F7;&#x9ED8;&#x8BA4;&#x4E3A;1,
&quot;subscription&quot;: { //&#x8BA2;&#x9605;topic&#x5217;&#x8868;
&quot;topic&#x540D;&#x79F0;&quot;: consumer&#x4E2D;topic&#x6D88;&#x8D39;&#x8005;&#x7EBF;&#x7A0B;&#x6570;
},
&quot;pattern&quot;: &quot;static&quot;,
&quot;timestamp&quot;: &quot;consumer&#x542F;&#x52A8;&#x65F6;&#x7684;&#x65F6;&#x95F4;&#x6233;&quot;
}
 
Example:
{
&quot;version&quot;: 1,
&quot;subscription&quot;: {
&quot;topic2&quot;: 1
},
&quot;pattern&quot;: &quot;white_list&quot;,
&quot;timestamp&quot;: &quot;1525747915336&quot;
}
</code></pre><h3 class="mume-header" id="29-consumer-owner" ebook-toc-level-3 heading="2.9&amp;#x3000;Consumer owner">2.9&#x3000;Consumer owner</h3>

<p>/consumers/[groupId]/owners/[topic]/[partitionId] -&gt; consumerIdString + threadId&#x7D22;&#x5F15;&#x7F16;&#x53F7;</p>
<p>a) &#x9996;&#x5148;&#x8FDB;&#x884C;&quot;Consumer Id&#x6CE8;&#x518C;&quot;;</p>
<p>b) &#x7136;&#x540E;&#x5728;&quot;Consumer id &#x6CE8;&#x518C;&quot;&#x8282;&#x70B9;&#x4E0B;&#x6CE8;&#x518C;&#x4E00;&#x4E2A;watch&#x7528;&#x6765;&#x76D1;&#x542C;&#x5F53;&#x524D;group&#x4E2D;&#x5176;&#x4ED6;consumer&#x7684;&quot;&#x9000;&#x51FA;&quot;&#x548C;&quot;&#x52A0;&#x5165;&quot;;&#x53EA;&#x8981;&#x6B64;znode path&#x4E0B;&#x8282;&#x70B9;&#x5217;&#x8868;&#x53D8;&#x66F4;,&#x90FD;&#x4F1A;&#x89E6;&#x53D1;&#x6B64;group&#x4E0B;consumer&#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;.(&#x6BD4;&#x5982;&#x4E00;&#x4E2A;consumer&#x5931;&#x6548;,&#x90A3;&#x4E48;&#x5176;&#x4ED6;consumer&#x63A5;&#x7BA1;partitions).</p>
<p>c) &#x5728;&quot;Broker id &#x6CE8;&#x518C;&quot;&#x8282;&#x70B9;&#x4E0B;,&#x6CE8;&#x518C;&#x4E00;&#x4E2A;watch&#x7528;&#x6765;&#x76D1;&#x542C;broker&#x7684;&#x5B58;&#x6D3B;&#x60C5;&#x51B5;;&#x5982;&#x679C;broker&#x5217;&#x8868;&#x53D8;&#x66F4;,&#x5C06;&#x4F1A;&#x89E6;&#x53D1;&#x6240;&#x6709;&#x7684;groups&#x4E0B;&#x7684;consumer&#x91CD;&#x65B0;balance.</p>
<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164359.png" alt="img"></p>
<h3 class="mume-header" id="210-consumer-offset" ebook-toc-level-3 heading="2.10&amp;#x3000;Consumer offset">2.10&#x3000;Consumer offset</h3>

<p>/consumers/[groupId]/offsets/[topic]/[partitionId] -&gt; long (offset)</p>
<p>&#x7528;&#x6765;&#x8DDF;&#x8E2A;&#x6BCF;&#x4E2A;consumer&#x76EE;&#x524D;&#x6240;&#x6D88;&#x8D39;&#x7684;partition&#x4E2D;&#x6700;&#x5927;&#x7684;offset</p>
<p>&#x6B64;znode&#x4E3A;&#x6301;&#x4E45;&#x8282;&#x70B9;,&#x53EF;&#x4EE5;&#x770B;&#x51FA;offset&#x8DDF;group_id&#x6709;&#x5173;,&#x4EE5;&#x8868;&#x660E;&#x5F53;&#x6D88;&#x8D39;&#x8005;&#x7EC4;(consumer group)&#x4E2D;&#x4E00;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x5931;&#x6548;,</p>
<p>&#x91CD;&#x65B0;&#x89E6;&#x53D1;balance,&#x5176;&#x4ED6;consumer&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x6D88;&#x8D39;.</p>
<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164402.png" alt="img"></p>
<h3 class="mume-header" id="211-re-assign-partitions" ebook-toc-level-3 heading="2.11&amp;#x3000;Re-assign partitions">2.11&#x3000;Re-assign partitions</h3>

<p>/admin/reassign_partitions</p>
<pre data-role="codeBlock" data-info class="language-"><code>{
   &quot;fields&quot;:[
      {
         &quot;name&quot;:&quot;version&quot;,
         &quot;type&quot;:&quot;int&quot;,
         &quot;doc&quot;:&quot;version id&quot;
      },
      {
         &quot;name&quot;:&quot;partitions&quot;,
         &quot;type&quot;:{
            &quot;type&quot;:&quot;array&quot;,
            &quot;items&quot;:{
               &quot;fields&quot;:[
                  {
                     &quot;name&quot;:&quot;topic&quot;,
                     &quot;type&quot;:&quot;string&quot;,
                     &quot;doc&quot;:&quot;topic of the partition to be reassigned&quot;
                  },
                  {
                     &quot;name&quot;:&quot;partition&quot;,
                     &quot;type&quot;:&quot;int&quot;,
                     &quot;doc&quot;:&quot;the partition to be reassigned&quot;
                  },
                  {
                     &quot;name&quot;:&quot;replicas&quot;,
                     &quot;type&quot;:&quot;array&quot;,
                     &quot;items&quot;:&quot;int&quot;,
                     &quot;doc&quot;:&quot;a list of replica ids&quot;
                  }
               ],
            }
            &quot;doc&quot;:&quot;an array of partitions to be reassigned to new replicas&quot;
         }
      }
   ]
}
 
Example:
{
  &quot;version&quot;: 1,
  &quot;partitions&quot;:
     [
        {
            &quot;topic&quot;: &quot;Foo&quot;,
            &quot;partition&quot;: 1,
            &quot;replicas&quot;: [0, 1, 3]
        }
     ]            
}
</code></pre><h3 class="mume-header" id="212-preferred-replication-election" ebook-toc-level-3 heading="2.12&amp;#x3000;Preferred replication election">2.12&#x3000;Preferred replication election</h3>

<p>/admin/preferred_replica_election</p>
<pre data-role="codeBlock" data-info class="language-"><code>{
   &quot;fields&quot;:[
      {
         &quot;name&quot;:&quot;version&quot;,
         &quot;type&quot;:&quot;int&quot;,
         &quot;doc&quot;:&quot;version id&quot;
      },
      {
         &quot;name&quot;:&quot;partitions&quot;,
         &quot;type&quot;:{
            &quot;type&quot;:&quot;array&quot;,
            &quot;items&quot;:{
               &quot;fields&quot;:[
                  {
                     &quot;name&quot;:&quot;topic&quot;,
                     &quot;type&quot;:&quot;string&quot;,
                     &quot;doc&quot;:&quot;topic of the partition for which preferred replica election should be triggered&quot;
                  },
                  {
                     &quot;name&quot;:&quot;partition&quot;,
                     &quot;type&quot;:&quot;int&quot;,
                     &quot;doc&quot;:&quot;the partition for which preferred replica election should be triggered&quot;
                  }
               ],
            }
            &quot;doc&quot;:&quot;an array of partitions for which preferred replica election should be triggered&quot;
         }
      }
   ]
}
 
&#x4F8B;&#x5B50;:
 
{
  &quot;version&quot;: 1,
  &quot;partitions&quot;:
     [
        {
            &quot;topic&quot;: &quot;Foo&quot;,
            &quot;partition&quot;: 1         
        },
        {
            &quot;topic&quot;: &quot;Bar&quot;,
            &quot;partition&quot;: 0         
        }
     ]            
}
</code></pre><h3 class="mume-header" id="213-%E5%88%A0%E9%99%A4topics" ebook-toc-level-3 heading="2.13&amp;#x3000;&amp;#x5220;&amp;#x9664;topics">2.13&#x3000;&#x5220;&#x9664;topics</h3>

<p>/admin/delete_topics</p>
<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164408.png" alt="img"></p>
<pre data-role="codeBlock" data-info class="language-"><code>Schema:
{ &quot;fields&quot;:
    [ {&quot;name&quot;: &quot;version&quot;, &quot;type&quot;: &quot;int&quot;, &quot;doc&quot;: &quot;version id&quot;},
      {&quot;name&quot;: &quot;topics&quot;,
       &quot;type&quot;: { &quot;type&quot;: &quot;array&quot;, &quot;items&quot;: &quot;string&quot;, &quot;doc&quot;: &quot;an array of topics to be deleted&quot;}
      } ]
}
 
&#x4F8B;&#x5B50;:
{
  &quot;version&quot;: 1,
  &quot;topics&quot;: [&quot;foo&quot;, &quot;bar&quot;]
}
</code></pre><h3 class="mume-header" id="24-topic%E9%85%8D%E7%BD%AE" ebook-toc-level-3 heading="2.4&amp;#x3000;Topic&amp;#x914D;&amp;#x7F6E;">2.4&#x3000;Topic&#x914D;&#x7F6E;</h3>

<p>/config/topics/[topic_name]</p>
<p><img src="https://typoralim.oss-cn-beijing.aliyuncs.com/img/20210219164410.png" alt="img"></p>
<h2 class="mume-header" id="%E5%8F%82%E8%80%83-4" ebook-toc-level-2 heading="&amp;#x53C2;&amp;#x8003;">&#x53C2;&#x8003;</h2>

<p><a href="https://www.cnblogs.com/qingyunzong/p/9007107.html">https://www.cnblogs.com/qingyunzong/p/9007107.html</a></p>
</div></body></html>
    </div>
  </body>
</html>
